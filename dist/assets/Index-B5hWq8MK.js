import{i as z,d as R,k as b,c as V,m as B,g as M,B as D,C as I,a as u,o as l,v as N,l as w,w as _,b as s,e as n,h as v,f as i,s as T,F as S,n as $,t as h,q as A,p as F}from"./index-aDw82BAL.js";import"./index-Cx72w7ih.js";import{i as H,g as L}from"./install-w9194OeT.js";import{_ as C}from"./EmptyState.vue_vue_type_script_setup_true_lang-CuoVhcgr.js";import{I as f}from"./iconify-BqGZZF46.js";import{_ as O}from"./Button.vue_vue_type_script_setup_true_lang-CFb8t8J1.js";import"./index-BCqgpTI_.js";import{a as E}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-ByYDymtQ.js";import{u as P}from"./projects-BQEszSKk.js";import"./index-DBtfm7ou.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q=async()=>z.get("/projects/stats/day"),U=R({__name:"EventsChart",props:{data:{},slug:{}},setup(k){const p=M(),m=k,r=b(null),c=b(null),t=V(()=>{const x=new Date().getHours(),g=[];for(let a=-4;a<=4;a++){const o=(x+a+24)%24;g.push({hour:`${o.toString().padStart(2,"0")}:00`,count:0})}return g.map(a=>{const o=m.data.find(y=>y.hour===a.hour);return o?{...a,count:o.count}:a})});B(()=>{if(r.value){const e=H(r.value);d(e),e.on("click","series",()=>{p.push(`/projects/${m.slug}/events`)}),c.value=new ResizeObserver(()=>{e.resize()}),c.value.observe(r.value)}}),D(()=>{if(r.value){const e=L(r.value);e&&(e.off("click"),e.dispose()),c.value&&(c.value.disconnect(),c.value=null)}}),I(()=>m.data,()=>{if(r.value){const e=L(r.value);e&&d(e)}});function d(e){const x=Math.max(...m.data.map(o=>o.count)),g=Math.ceil(x*1.2),a={grid:{top:10,right:10,bottom:20,left:40},xAxis:{type:"category",data:t.value.map(o=>o.hour),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{fontSize:10,color:"#6b7280"}},yAxis:{type:"value",max:g,splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{fontSize:10,color:"#6b7280"},min:0},series:[{data:t.value.map(o=>o.count),type:"bar",barWidth:"80%",itemStyle:{color:"#818cf8"},emphasis:{itemStyle:{color:"#4f46e5"}}}],tooltip:{trigger:"axis",formatter:o=>{const y=o[0];return`${y.axisValue}: ${y.value} событий`}}};e.setOption(a)}return(e,x)=>(l(),u("div",{ref_key:"chartRef",ref:r,class:"w-full h-full"},null,512))}}),W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},G={class:"flex justify-between items-center mb-6"},J={class:"bg-white shadow rounded-lg overflow-hidden"},K={key:0,class:"divide-y divide-gray-200"},Q={key:2,class:"divide-y divide-gray-200"},X={class:"flex flex-col space-y-4"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center space-x-4"},j={class:"flex-shrink-0 h-10 w-10 rounded-md bg-indigo-100 flex items-center justify-center"},ss={class:"text-sm text-gray-500 mt-1"},es={class:"flex items-center space-x-4"},ts={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},os={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},as={class:"flex items-center space-x-3"},ns={class:"p-2 rounded-lg bg-indigo-50 text-indigo-600"},is={class:"text-xl font-bold text-gray-900"},rs={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},ls={class:"flex items-center space-x-3"},ds={class:"p-2 rounded-lg bg-red-50 text-red-600"},cs={class:"text-xl font-bold text-gray-900"},us={key:0,class:"text-xs font-normal ml-1","?:class":`\r
														project.stats.errors_last_day > 0\r
															? 'text-red-500'\r
															: 'text-green-500'\r
													`},ms={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},xs={class:"flex items-center space-x-3"},gs={class:"p-2 rounded-lg bg-purple-50 text-purple-600"},fs={class:"text-xl font-bold text-gray-900"},hs={class:"flex justify-center mb-2"},ps={key:0,class:"h-42"},Bs=R({__name:"Index",setup(k){const p=b([]),{isLoading:m}=N(P()),r=c=>{var d;const t=(d=c.stats)==null?void 0:d.avg_response_time;return t?t<200?"good":"warning":"undefined"};return B(async()=>{p.value=await q()}),(c,t)=>{const d=T("RouterLink");return l(),w(E,null,{default:_(()=>[s("div",W,[s("div",G,[t[1]||(t[1]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Проекты",-1)),n(d,{to:"/projects/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:_(()=>[n(i(f),{icon:"heroicons:plus",class:"-ml-1 mr-2 h-5 w-5"}),t[0]||(t[0]=v(" Создать проект "))]),_:1})]),s("div",J,[i(m)?(l(),u("div",K,[(l(),u(S,null,$(5,e=>s("div",{key:`project-skeleton-${e}`,class:"px-4 py-4 sm:px-6"},t[2]||(t[2]=[s("div",{class:"flex items-center justify-between animate-pulse"},[s("div",{class:"flex items-center space-x-4"},[s("div",{class:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200"}),s("div",{class:"space-y-2"},[s("div",{class:"h-4 bg-gray-200 rounded w-32"}),s("div",{class:"h-3 bg-gray-100 rounded w-24"})])]),s("div",{class:"h-5 w-5 bg-gray-200 rounded"})],-1)]))),64))])):!p.value.length&&!i(m)?(l(),w(i(C),{key:1,title:"Нет проектов",icon:"heroicons:folder",description:"Создайте свой первый проект."})):(l(),u("div",Q,[(l(!0),u(S,null,$(p.value,e=>{var x,g,a,o;return l(),u("div",{key:e.id,class:"px-4 py-4 sm:px-6"},[s("div",X,[s("div",Y,[s("div",Z,[s("div",j,[n(i(f),{icon:"heroicons:folder",class:"h-6 w-6 text-indigo-600"})]),s("div",null,[n(d,{to:`/projects/${e.slug}`,class:"text-sm font-medium text-indigo-600 hover:text-indigo-900"},{default:_(()=>[v(h(e.name),1)]),_:2},1032,["to"]),s("p",ss,h(e.platform),1)])]),s("div",es,[n(d,{to:`projects/${e.slug}/settings/general`,class:"text-gray-400 hover:text-gray-500"},{default:_(()=>[n(i(f),{icon:"heroicons:cog-6-tooth",class:"h-5 w-5"})]),_:2},1032,["to"])])]),s("div",ts,[s("div",os,[s("div",as,[s("div",ns,[n(i(f),{icon:"heroicons:chart-bar",class:"h-5 w-5"})]),s("div",null,[t[3]||(t[3]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Всего событий ",-1)),s("p",is,h((x=e==null?void 0:e.stats)==null?void 0:x.total_events.toLocaleString()),1)])])]),s("div",rs,[s("div",ls,[s("div",ds,[n(i(f),{icon:"heroicons:exclamation-triangle",class:"h-5 w-5"})]),s("div",null,[t[4]||(t[4]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ошибки (24ч) ",-1)),s("p",cs,[v(h((g=e==null?void 0:e.stats)==null?void 0:g.errors_last_day.toLocaleString())+" ",1),e.stats!==void 0?(l(),u("span",us,h(Math.abs(e.stats.error_rate_change))+"% ",1)):A("",!0)])])])]),s("div",ms,[s("div",xs,[s("div",gs,[n(i(f),{icon:"heroicons:clock",class:"h-5 w-5"})]),s("div",null,[t[5]||(t[5]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Время ответа ",-1)),s("p",fs,[v(h((a=e.stats)==null?void 0:a.avg_response_time.toFixed(2))+"ms ",1),s("span",{class:F(["text-xs font-normal ml-1",r(e)==="good"?"text-green-500":"text-yellow-500"])},[n(i(f),{icon:r(e)==="good"?"heroicons:check-badge":"heroicons:exclamation-circle",class:"h-3 w-3 inline"},null,8,["icon"])],2)])])])])]),s("div",hs,[n(i(O),{to:`projects/${e.slug}/events`},{default:_(()=>t[6]||(t[6]=[v(" Посмотреть все события ")])),_:2},1032,["to"])]),(o=e.events_last_day)!=null&&o.length?(l(),u("div",ps,[n(U,{data:e.events_last_day,slug:e.slug},null,8,["data","slug"])])):(l(),w(i(C),{key:1,title:"События отсутствуют",icon:"heroicons:arrow-trending-up",description:"Пока что никаких событий не поступало..."}))])])}),128))]))])])]),_:1})}}});export{Bs as default};
