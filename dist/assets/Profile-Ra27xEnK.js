import{d as Q,u as W,v as X,k as m,c as Y,m as Z,l as v,w as c,i as U,o as u,b as e,e as r,t as d,f as t,h as f,a as h,q as R,n as S,s as ee,F as B,K as A}from"./index-B605mWSS.js";import{R as se}from"./types-CpYKjTMI.js";import{_ as T}from"./EmptyState.vue_vue_type_script_setup_true_lang-6tWArOav.js";import{I as j}from"./iconify-e9sR0ZFq.js";import{S as x}from"./StatCard-B-ZXmqgC.js";import{_ as y}from"./Badge.vue_vue_type_script_setup_true_lang-BJ0lmBAF.js";import{_ as L}from"./Button.vue_vue_type_script_setup_true_lang-BvWJDmF7.js";import"./StacktraceViewer.vue_vue_type_style_index_0_scoped_8568d111_lang-OogGfIpQ.js";import{_ as b}from"./InputField.vue_vue_type_script_setup_true_lang-DBN7DNb5.js";import{a as te,M as oe}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BKjXbmz5.js";import{p as P,f as ae,b as re,o as ie,s as k,m as ne,_ as le}from"./TheForm.vue_vue_type_script_setup_true_lang-CCNSZ3Rc.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-p83CCQy-.js";import"./projects-DhOs14FM.js";const ce=P(ie({current_password:k(),password:P(k(),ne(8)),password_confirmation:k()}),ae(re([["password"],["password_confirmation"]],g=>g.password===g.password_confirmation,"Пароли не совпадают"),["password_confirmation"])),ue={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},pe={class:"flex flex-col sm:flex-row gap-8 mb-8"},me={class:"flex-shrink-0"},fe={class:"h-32 w-32 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white text-5xl font-bold shadow-lg"},_e={class:"flex-1"},ve={class:"flex justify-between items-start"},ge={class:"text-2xl font-bold text-gray-900"},we={class:"text-gray-600 mt-1"},he={class:"mt-2"},xe={class:"grid grid-cols-3 gap-4 mt-6"},ye={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8"},be={class:"divide-y divide-gray-100"},ke={class:"flex items-center space-x-4"},Ve={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-medium"},Ce={class:"text-sm font-medium text-gray-900"},$e={class:"text-sm text-gray-500"},Ie={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Ue={class:"divide-y divide-gray-100"},Re={class:"flex items-start space-x-4"},Se={class:"flex-shrink-0 pt-1"},Be={class:"flex-1 min-w-0"},Ae={class:"text-sm font-medium text-gray-900 truncate"},Te={class:"mt-1 flex items-center space-x-3"},je={class:"text-xs text-gray-500"},Le={class:"flex justify-end gap-3"},Pe=Q({__name:"Profile",setup(g){const E=W(),{currentUser:i}=X(E),_=m({teams:0,open_issues:0,resolved_issues:0}),F=m(null),p=m(!1),w=m(!1),n=m({current_password:"",password:"",password_confirmation:""}),M={open:"primary",in_progress:"warning",resolved:"success",closed:"secondary"},N={error:"danger",warning:"warning",info:"info"},q={open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"},D=Y(()=>i.value.name?i.value.name.charAt(0).toUpperCase():""),G=a=>a?a.charAt(0).toUpperCase():"",K=a=>M[a]||"default",O=a=>N[a]||"default",z=a=>q[a]||a,H=async()=>{try{const a=await U.get("/users/profile");i.value=a.user,_.value=a.stats}catch(a){console.error("Error fetching profile:",a)}},J=async()=>{w.value=!0;try{await U.post("/users/profile/password",n.value),p.value=!1,n.value={current_password:"",new_password:"",new_password_confirmation:""},A.success("Пароль успешно обновлен")}catch(a){A.error("Ошибка обновления пароля",{description:a.data.message})}finally{w.value=!1}};return Z(async()=>{await H()}),(a,o)=>{const V=ee("RouterLink");return u(),v(te,null,{default:c(()=>{var C,$,I;return[e("div",ue,[e("div",pe,[e("div",me,[e("div",fe,d(D.value),1)]),e("div",_e,[e("div",ve,[e("div",null,[e("h1",ge,d(t(i).name),1),e("p",we,d(t(i).email),1),e("div",he,[r(t(y),{variant:((C=t(i).role)==null?void 0:C.title)===t(se).Maintainer?"primary":"secondary"},{default:c(()=>{var s;return[f(d((s=t(i).role)==null?void 0:s.title),1)]}),_:1},8,["variant"])])]),e("button",{onClick:o[0]||(o[0]=s=>p.value=!0),class:"inline-flex items-center cursor-pointer px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"},[r(t(j),{icon:"heroicons:lock-closed",class:"mr-2 h-4 w-4"}),o[6]||(o[6]=f(" Сменить пароль "))])]),e("div",xe,[r(x,{title:"Команд",value:_.value.teams,icon:"heroicons:user-group",class:"bg-white"},null,8,["value"]),r(x,{title:"Активных задач",value:_.value.open_issues,icon:"heroicons:exclamation-triangle",variant:"warning",class:"bg-white"},null,8,["value"]),r(x,{title:"Решенных задач",value:_.value.resolved_issues,icon:"heroicons:check-badge",variant:"success",class:"bg-white"},null,8,["value"])])])]),e("div",ye,[o[7]||(o[7]=e("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Мои команды")],-1)),e("div",be,[(u(!0),h(B,null,S(t(i).teams,s=>(u(),v(V,{key:s.id,to:`/teams/${s.slug}`,class:"block p-5 hover:bg-gray-50 transition-colors duration-150"},{default:c(()=>[e("div",ke,[e("div",Ve,d(G(s.name)),1),e("div",null,[e("p",Ce,d(s.name),1),e("p",$e,d(s.members_count)+" участников",1)])])]),_:2},1032,["to"]))),128)),($=t(i).teams)!=null&&$.length?R("",!0):(u(),v(t(T),{key:0,title:"Нет команд",icon:"heroicons:user-group",description:"Вы не состоите ни в одной команде",class:"p-8"}))])]),e("div",Ie,[o[8]||(o[8]=e("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Мои задачи")],-1)),e("div",Ue,[(u(!0),h(B,null,S(t(i).assignments,s=>{var l;return u(),h("div",{key:s.id,class:"p-5 hover:bg-gray-50 transition-colors duration-150"},[e("div",Re,[e("div",Se,[r(t(y),{variant:K(s.issue.status),text:z(s.issue.status)},null,8,["variant","text"])]),e("div",Be,[e("p",Ae,[f(d(s.issue.title)+" ",1),r(t(y),{variant:O(s.issue.event.level),text:s.issue.event.level},null,8,["variant","text"])]),e("div",Te,[e("span",je," Проект: "+d((l=s.issue.project)==null?void 0:l.name),1)])]),r(V,{to:`/issues/${s.issue.id}`,class:"text-gray-400 hover:text-gray-500"},{default:c(()=>[r(t(j),{icon:"heroicons:chevron-right",class:"h-5 w-5"})]),_:2},1032,["to"])])])}),128)),(I=t(i).assignments)!=null&&I.length?R("",!0):(u(),v(t(T),{key:0,title:"Нет задач",icon:"heroicons:check-badge",description:"Вам не назначено ни одной задачи",class:"p-8",small:""}))])])]),r(t(oe),{"is-open":p.value,onClose:o[5]||(o[5]=s=>p.value=!1),title:"Смена пароля"},{content:c(()=>[r(t(le),{class:"space-y-3",schema:t(ce),data:n.value,submit:J,ref_key:"passwordFormRef",ref:F},{default:c(({errors:s})=>[r(t(b),{modelValue:n.value.current_password,"onUpdate:modelValue":o[1]||(o[1]=l=>n.value.current_password=l),label:"Текущий пароль",type:"password",required:"",icon:"heroicons:lock-closed",id:"current-password",placeholder:"Текущий пароль",error:s==null?void 0:s.current_password},null,8,["modelValue","error"]),r(t(b),{modelValue:n.value.password,"onUpdate:modelValue":o[2]||(o[2]=l=>n.value.password=l),label:"Новый пароль",type:"password",required:"",icon:"heroicons:key",id:"password",placeholder:"••••••••",error:s==null?void 0:s.password},null,8,["modelValue","error"]),r(t(b),{modelValue:n.value.password_confirmation,"onUpdate:modelValue":o[3]||(o[3]=l=>n.value.password_confirmation=l),label:"Подтверждение пароля",type:"password",required:"",icon:"heroicons:key",id:"password-confirmation",placeholder:"••••••••",error:s==null?void 0:s.password_confirmation},null,8,["modelValue","error"]),e("div",Le,[r(t(L),{variant:"secondary",onClick:o[4]||(o[4]=l=>p.value=!1)},{default:c(()=>o[9]||(o[9]=[f(" Отмена ")])),_:1}),r(t(L),{type:"submit","is-loading":w.value},{default:c(()=>o[10]||(o[10]=[f(" Сохранить ")])),_:1},8,["is-loading"])])]),_:1},8,["schema","data"])]),_:1},8,["is-open"])]}),_:1})}}}),Xe=de(Pe,[["__scopeId","data-v-417b9a31"]]);export{Xe as default};
