import{i as U,d as I,c as A,a as d,o as r,p as P,t as h,l as E,f as u,k as _,m as J,B as ge,C as te,b as e,e as v,a4 as he,w as j,q as b,F as M,n as L,a5 as ue,j as de,a6 as ie,a7 as ce,a8 as xe,h as B,a9 as se,aa as me,g as _e,R as be}from"./index-DmyUZq0U.js";import{u as ae}from"./issues-B4uNFoVp.js";import{c as we,_ as le,M as $e,a as ke}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BwL1_S68.js";import{I as Z}from"./types-Cl0W0wgk.js";import{I as S}from"./iconify-DK_FkkOf.js";import{_ as ne}from"./Button.vue_vue_type_script_setup_true_lang-BZBZpZNp.js";import{M as pe}from"./index-BCqgpTI_.js";import{S as De,_ as Ce}from"./JsonViewer.vue_vue_type_script_setup_true_lang-COd7F0Cz.js";import{u as Se}from"./index-DCK61lqv.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ee}from"./SelectField.vue_vue_type_script_setup_true_lang-DpHE4pZ1.js";import{_ as Y}from"./Badge.vue_vue_type_script_setup_true_lang-BCFXyg7k.js";import{_ as Ie}from"./Pagination.vue_vue_type_script_setup_true_lang-Bj4RuecX.js";import{f as re}from"./index-FUb4nFco.js";import{_ as Me}from"./EmptyState.vue_vue_type_script_setup_true_lang-ybUaClyj.js";import"./projects-Deqezav3.js";import"./form-BhL115Ha.js";const ye={async get(y){return U.get(`/issues/${y}`)},async updateStatus(y,c){await U.patch(`/issues/${y}/status`,{status:c})},async updatePriority(y,c){await U.patch(`/issues/${y}/priority`,{priority:c})},async updateDueDate(y,c){await U.patch(`/issues/${y}/due-date`,{due_date:c})},async addAssignee(y,c,t){await U.post(`/issues/${y}/assignees`,{type:c,id:t})},async removeAssignee(y,c,t){await U.delete(`/issues/${y}/assignees`,{data:{type:c,id:t}})},async addComment(y,c){await U.post(`/issues/${y}/comments`,{text:c})}},Te=I({__name:"StatusBadge",props:{status:{}},setup(y){const c=y,t=A(()=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[c.status]),l=A(()=>({closed:"bg-red-100 text-red-800",resolved:"bg-green-100 text-green-800",open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800"})[c.status]);return(s,a)=>(r(),d("span",{class:P(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",l.value])},h(t.value),3))}}),Ve=I({__name:"PriorityBadge",props:{priority:{}},setup(y){const c=A(()=>({low:"Низкий",medium:"Средний",high:"Высокий",critical:"Критический"})[y.priority]),t=A(()=>({low:"bg-gray-100 text-gray-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"})[y.priority]);return(l,s)=>(r(),d("span",{class:P(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t.value])},h(c.value),3))}}),Le=I({__name:"PrioritySelect",props:{modelValue:{}},emits:["update:modelValue","change"],setup(y,{emit:c}){const t=c,l=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],s=a=>{t("update:modelValue",a),t("change",a)};return(a,i)=>(r(),E(u(ee),{options:l,"option-label":"label","option-value":"value",modelValue:a.modelValue,placeholder:"Выберите приоритет","onUpdate:modelValue":s},null,8,["modelValue"]))}}),Ae={class:"relative"},Ee={class:"flex items-center"},Fe=["value","placeholder"],Ue={key:0,class:"absolute z-10 mt-1 w-auto bg-white rounded-md shadow-lg p-4 border border-gray-200 min-w-60"},je={class:"flex justify-between items-center mb-4"},Pe={class:"text-sm font-medium text-gray-900"},Re={class:"grid grid-cols-7 gap-1 mb-2"},ze={class:"grid grid-cols-7 gap-1"},Be=["onClick"],Ne=I({__name:"DatePicker",props:{modelValue:{type:String,default:null},placeholder:{type:String,default:"Выберите дату"}},emits:["update:modelValue","change"],setup(y,{emit:c}){const t=y,l=c,s=_(!1),a=_(new Date),i=_(null);t.modelValue&&(i.value=new Date(t.modelValue));const m=n=>n?n.toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"",k=A(()=>m(i.value)),g=A(()=>a.value.getFullYear()),w=A(()=>a.value.getMonth()),V=A(()=>a.value.toLocaleString("default",{month:"long"})),x=A(()=>{const n=g.value,o=w.value,p=new Date(n,o,1),C=new Date(n,o+1,0),R=p.getDay(),K=6-C.getDay(),z=[],O=new Date(n,o,0).getDate();for(let T=R-1;T>=0;T--){const N=O-T;z.push({day:N,date:new Date(n,o-1,N),isCurrentMonth:!1,isToday:D(new Date(n,o-1,N)),isSelected:f(new Date(n,o-1,N))})}const fe=C.getDate();for(let T=1;T<=fe;T++){const N=new Date(n,o,T);z.push({day:T,date:N,isCurrentMonth:!0,isToday:D(N),isSelected:f(N)})}for(let T=1;T<=K;T++)z.push({day:T,date:new Date(n,o+1,T),isCurrentMonth:!1,isToday:D(new Date(n,o+1,T)),isSelected:f(new Date(n,o+1,T))});return z}),D=n=>{const o=new Date;return n.getDate()===o.getDate()&&n.getMonth()===o.getMonth()&&n.getFullYear()===o.getFullYear()},f=n=>i.value?n.getDate()===i.value.getDate()&&n.getMonth()===i.value.getMonth()&&n.getFullYear()===i.value.getFullYear():!1,$=()=>{s.value=!s.value},F=()=>{a.value=new Date(g.value,w.value-1,1)},Q=()=>{a.value=new Date(g.value,w.value+1,1)},X=n=>{if(!n.isCurrentMonth)return;i.value=n.date,a.value=new Date(n.date);const o=G(n.date);l("update:modelValue",o),l("change",o),s.value=!1},oe=()=>{const n=new Date;n.setHours(0,0,0,0),i.value=n,a.value=new Date(n);const o=G(n);l("update:modelValue",o),l("change",o),s.value=!1},G=n=>{if(!n)return null;const o=n.getFullYear(),p=String(n.getMonth()+1).padStart(2,"0"),C=String(n.getDate()).padStart(2,"0");return`${o}-${p}-${C}`},W=()=>{i.value=null,l("update:modelValue",null),s.value=!1},H=n=>{n.target.closest(".relative")||(s.value=!1)},q=n=>{if(!n)return null;try{const o=new Date(n);return isNaN(o.getTime())?(console.error("Invalid date:",n),null):o}catch(o){return console.error("Error parsing date:",o),null}};return J(()=>{t.modelValue&&(i.value=q(t.modelValue),i.value&&(a.value=new Date(i.value))),document.addEventListener("click",H)}),ge(()=>{document.removeEventListener("click",H)}),te(()=>t.modelValue,n=>{const o=q(n);if(o){const p=new Date(o.getFullYear(),o.getMonth(),o.getDate()),C=i.value?new Date(i.value.getFullYear(),i.value.getMonth(),i.value.getDate()):null;(!C||p.getTime()!==C.getTime())&&(i.value=o,a.value=new Date(o))}else i.value=null},{immediate:!0}),(n,o)=>(r(),d("div",Ae,[e("div",Ee,[e("input",{type:"text",value:k.value,onClick:$,readonly:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:y.placeholder},null,8,Fe),e("button",{type:"button",onClick:$,class:"absolute right-0 px-3 py-2 text-gray-400 hover:text-gray-500"},[v(u(S),{icon:"mdi:calendar",class:"h-5 w-5"})])]),v(he,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:j(()=>[s.value?(r(),d("div",Ue,[e("div",je,[e("button",{onClick:F,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[v(u(S),{icon:"mdi:chevron-left",class:"h-5 w-5"})]),e("span",Pe,h(V.value)+" "+h(g.value),1),e("button",{onClick:Q,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[v(u(S),{icon:"mdi:chevron-right",class:"h-5 w-5"})])]),e("div",Re,[(r(),d(M,null,L(["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],p=>e("div",{key:p,class:"text-xs text-center text-gray-500"},h(p),1)),64))]),e("div",ze,[(r(!0),d(M,null,L(x.value,p=>(r(),d("div",{key:p.date,onClick:C=>X(p),class:P(["text-center py-1 text-sm rounded-full",{"text-gray-400":!p.isCurrentMonth,"hover:bg-gray-100 cursor-pointer":p.isCurrentMonth,"bg-indigo-100 text-indigo-700 font-medium":p.isSelected,"bg-indigo-600 text-white font-medium":p.isToday&&p.isSelected}])},h(p.day),11,Be))),128))]),e("div",{class:"mt-4 flex justify-between"},[e("button",{onClick:oe,type:"button",class:"text-xs text-indigo-600 cursor-pointer hover:text-indigo-900"}," Сегодня "),e("button",{onClick:W,type:"button",class:"text-xs text-gray-500 cursor-pointer hover:text-gray-700"}," Очистить ")])])):b("",!0)]),_:1})]))}}),Ye=["onKeydown"],He={class:"border-b border-gray-200"},Oe={class:"-mb-px flex space-x-8"},qe=["onClick"],Ke={class:"relative"},Je={class:"overflow-hidden rounded-lg shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-indigo-500 transition-all duration-200"},Qe={key:0,class:"absolute z-10 mt-1 w-64 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-gray-300 ring-opacity-5 focus:outline-none sm:text-sm"},Xe=["onClick"],Ge={class:"flex items-center"},We={class:"ml-3 block truncate text-gray-700 font-medium"},Ze={key:0,class:"px-4 py-2 text-gray-500 text-sm"},et={class:"absolute inset-x-0 bottom-0 flex justify-between items-center py-2 pl-3 pr-2 bg-gray-50 border-t border-gray-200"},tt={class:"flex items-center space-x-2"},st={class:"prose prose-sm max-w-none p-4 rounded-lg border border-gray-200"},nt=["innerHTML"],at={key:1,class:"text-gray-400 italic"},ot={class:"flex justify-end"},it={key:0,class:"flex items-center"},rt={key:1,class:"flex items-center"},lt=I({__name:"CommentForm",props:{isLoading:{type:Boolean},initialValue:{}},emits:["submit"],setup(y,{emit:c}){const t=y,l=c,s=_("write"),a=_(t.initialValue||""),i=_(null),m=_(!1),k=_([]),g=_(0),w=_(""),V=_(-1),x=[{name:"write",label:"Редактор"},{name:"preview",label:"Превью"}],D=new pe({html:!0,linkify:!0,typographer:!0,highlight:function(n,o){if(o&&se.getLanguage(o))try{return se.highlight(n,{language:o}).value}catch{}return""}}),f=A(()=>a.value.trim()?D.render(a.value):null),$=()=>{a.value.trim()&&(l("submit",a.value.trim()),a.value="")},F=(n,o)=>{if(!i.value)return;const p=i.value.selectionStart,C=i.value.selectionEnd,R=a.value.substring(p,C),K=a.value.substring(0,p),z=a.value.substring(C);a.value=K+n+R+o+z,me(()=>{if(!i.value)return;i.value.focus();const O=p+n.length;i.value.setSelectionRange(O,R?O+R.length:O)})},Q=()=>{const o=(x.findIndex(p=>p.name===s.value)-1+x.length)%x.length;s.value=x[o].name},X=()=>{const o=(x.findIndex(p=>p.name===s.value)+1)%x.length;s.value=x[o].name},oe=Se(async n=>{try{k.value=await U.get(`/api/users/search?q=${n}`)}catch(o){console.error("Ошибка при поиске пользователей:",o),k.value=[]}},300),G=()=>{const n=i.value.selectionStart,o=a.value.substring(0,n),p=o.lastIndexOf("@");if(Math.abs(n-p)!==1)if(p>=0&&(p===0||/\s/.test(o[p-1]))){const C=o.substring(p+1);if(!C.trim()||/\s/.test(C))return;V.value=p,w.value=o.substring(p+1),m.value=!0,g.value=0,oe(w.value)}else m.value=!1},W=n=>{if(!i.value)return;const o=i.value,p=V.value,C=o.selectionStart,R=a.value.substring(0,p),K=a.value.substring(C);a.value=R+`@${n.name} `+K,m.value=!1,me(()=>{o.focus();const z=p+n.name.length+2;o.setSelectionRange(z,z)})},H=n=>{m.value&&(n.key==="ArrowDown"?(n.preventDefault(),g.value=Math.min(g.value+1,k.value.length-1)):n.key==="ArrowUp"?(n.preventDefault(),g.value=Math.max(g.value-1,0)):n.key==="Enter"?(n.preventDefault(),k.value[g.value]&&W(k.value[g.value])):n.key==="Escape"&&(n.preventDefault(),m.value=!1)),n.altKey&&(n.key==="ArrowLeft"?(n.preventDefault(),Q()):n.key==="ArrowRight"&&(n.preventDefault(),X()))},q=n=>{i.value&&!i.value.contains(n.target)&&(m.value=!1)};return J(()=>{window.addEventListener("keydown",H),document.addEventListener("click",q)}),ge(()=>{window.removeEventListener("keydown",H),document.removeEventListener("click",q)}),te(()=>t.initialValue,n=>{n&&(a.value=n)}),(n,o)=>(r(),d("div",{class:"space-y-4",onKeydown:[ue(de(Q,["alt","stop"]),["left"]),ue(de(X,["alt","stop"]),["right"])]},[e("div",He,[e("nav",Oe,[(r(),d(M,null,L(x,p=>e("button",{key:p.name,onClick:C=>s.value=p.name,class:P([s.value===p.name?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},h(p.label),11,qe)),64))])]),ie(e("div",Ke,[e("div",Je,[ie(e("textarea",{ref_key:"textareaRef",ref:i,id:"comment","onUpdate:modelValue":o[0]||(o[0]=p=>a.value=p),rows:"8",class:"block w-full focus:outline-none resize-none border-0 bg-transparent py-3 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6 font-mono",placeholder:"Напишите ваш комментарий (поддерживается Markdown)...",onKeydown:H,onInput:G},null,544),[[xe,a.value]]),m.value?(r(),d("div",Qe,[(r(!0),d(M,null,L(k.value,(p,C)=>(r(),d("div",{key:p.id,onClick:R=>W(p),class:P(["relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-indigo-50",{"bg-indigo-100":g.value===C}])},[e("div",Ge,[e("span",We,h(p.name),1)])],10,Xe))),128)),k.value.length===0?(r(),d("div",Ze," Пользователи не найдены ")):b("",!0)])):b("",!0),e("div",et,[e("div",tt,[e("button",{type:"button",onClick:o[1]||(o[1]=p=>F("**","**")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Жирный текст"},[v(u(S),{icon:"mdi:format-bold",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[2]||(o[2]=p=>F("*","*")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Курсив"},[v(u(S),{icon:"mdi:format-italic",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[3]||(o[3]=p=>F("[","](url)")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Ссылка"},[v(u(S),{icon:"mdi:link-variant",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[4]||(o[4]=p=>F("```\n","\n```")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Блок кода"},[v(u(S),{icon:"mdi:code-tags",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[5]||(o[5]=p=>F("- ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Список"},[v(u(S),{icon:"mdi:format-list-bulleted",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[6]||(o[6]=p=>F("> ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Цитата"},[v(u(S),{icon:"mdi:format-quote-open",class:"h-5 w-5"})])]),o[7]||(o[7]=e("div",{class:"text-xs text-gray-500"}," Поддерживается Markdown. Ctrl+Enter для отправки ",-1))])])],512),[[ce,s.value==="write"]]),ie(e("div",st,[f.value?(r(),d("div",{key:0,innerHTML:f.value},null,8,nt)):(r(),d("div",at," Превью будет отображаться здесь... "))],512),[[ce,s.value==="preview"]]),e("div",ot,[v(u(ne),{type:"button",onClick:$,disabled:n.isLoading||!a.value.trim()},{default:j(()=>[n.isLoading?(r(),d("span",it,[v(u(S),{icon:"mdi:loading",class:"h-4 w-4 animate-spin mr-2"}),o[8]||(o[8]=B(" Отправка... "))])):(r(),d("span",rt,[v(u(S),{icon:"mdi:send",class:"h-4 w-4 mr-2"}),o[9]||(o[9]=B(" Отправить "))]))]),_:1},8,["disabled"])])],40,Ye))}}),ut=ve(lt,[["__scopeId","data-v-8b816cc4"]]),dt={class:"border-b border-gray-200 pb-4"},ct={class:"flex items-start justify-between"},mt={class:"text-2xl font-bold text-gray-900"},gt={class:"text-gray-500"},pt={class:"mt-2 flex items-center space-x-4"},vt={class:"flex space-x-3"},yt=I({__name:"IssueHeader",props:{issue:{}},setup(y){const c=y,t=_e(),l=ae(),s=[{icon:"heroicons:lock-closed",iconClass:"text-gray-700",key:"lock",label:"Закрыть",handler:async()=>{await l.updateIssueStatus(c.issue.id,Z.Closed)},visible:()=>c.issue.status!==Z.Closed},{icon:"heroicons:trash",iconClass:"text-red-500",key:"delete",label:"Удалить",handler:async()=>{await l.deleteIssue(c.issue.id),await t.push(be.ISSUE.INDEX)}}];return(a,i)=>(r(),d("div",dt,[e("div",ct,[e("div",null,[e("h1",mt,[B(h(a.issue.title)+" ",1),e("span",gt,"#"+h(a.issue.id),1)]),e("div",pt,[v(u(Te),{status:a.issue.status},null,8,["status"]),v(u(Ve),{priority:a.issue.priority},null,8,["priority"])])]),e("div",vt,[a.issue.status!==u(Z).Resolved?(r(),E(u(ne),{key:0,variant:"secondary",onClick:i[0]||(i[0]=m=>u(l).updateIssueStatus(a.issue.id,u(Z).Resolved))},{default:j(()=>i[1]||(i[1]=[B(" Решить ")])),_:1})):b("",!0),v(u(we),{actions:s})])])]))}}),ft={class:"bg-white shadow rounded-lg overflow-hidden"},ht={class:"px-4 py-5 sm:p-6"},xt={class:"mb-4"},_t={class:"text-sm text-gray-700"},bt={key:0,class:"mb-4"},wt={key:1,class:"mb-4"},$t=I({__name:"IssueDescription",props:{event:{}},setup(y){return(c,t)=>(r(),d("div",ft,[t[3]||(t[3]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Детали ошибки")],-1)),e("div",ht,[e("div",xt,[t[0]||(t[0]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Сообщение",-1)),e("p",_t,h(c.event.message),1)]),c.event.metadata.stacktrace?(r(),d("div",bt,[t[1]||(t[1]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Стектрейс",-1)),v(u(De),{stacktrace:c.event.metadata.stacktrace},null,8,["stacktrace"])])):b("",!0),c.event.metadata.context?(r(),d("div",wt,[t[2]||(t[2]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Контекст",-1)),v(u(Ce),{data:c.event.metadata.context},null,8,["data"])])):b("",!0)])]))}}),kt={class:"space-y-4 mb-2"},Dt={class:"flex space-x-3"},Ct={class:"flex-shrink-0"},St={class:"flex-1 min-w-0"},It={class:"flex items-center space-x-2 text-sm"},Mt={class:"font-medium text-gray-900"},Tt={class:"text-gray-500"},Vt={class:"mt-1 flex items-center text-sm text-gray-700"},Lt={class:"text-gray-500"},At=["innerHTML"],Et=I({__name:"IssueComments",props:{comments:{},showParentReferences:{type:Boolean,default:!1}},emits:["submit-reply"],setup(y,{emit:c}){_(""),_(null);const t=new pe({html:!0,linkify:!0,typographer:!0,highlight:function(a,i){if(i&&se.getLanguage(i))try{return se.highlight(a,{language:i}).value}catch{}return""}}),l=a=>t.render(a.trim()),s=a=>new Date(a).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(a,i)=>(r(),d("div",kt,[(r(!0),d(M,null,L(a.comments,m=>(r(),d("div",{key:m.id,class:"relative"},[e("div",Dt,[e("div",Ct,[v(u(le),{name:m.user.name,size:"sm"},null,8,["name"])]),e("div",St,[e("div",It,[e("span",Mt,h(m.user.name),1),e("span",Tt,h(s(m.created_at)),1)]),e("div",Vt,[m.parent&&a.showParentReferences?(r(),d(M,{key:0},[e("span",Lt,"@"+h(m.parent.user.name),1),i[0]||(i[0]=e("span",{class:"text-gray-300 mx-1"},"•",-1))],64)):b("",!0),e("span",{innerHTML:l(m.text)},null,8,At)])])])]))),128))]))}}),Ft={class:"bg-white shadow rounded-lg overflow-hidden"},Ut={class:"px-4 py-5 sm:p-6"},jt=I({__name:"IssueCommentsTab",props:{issueId:{},comments:{}},emits:["comment-added"],setup(y,{emit:c}){const t=y,l=c,s=_(!1),a=async i=>{s.value=!0;try{await ye.addComment(t.issueId,i),l("comment-added")}catch(m){console.error("Error adding comment:",m)}finally{s.value=!1}};return(i,m)=>(r(),d("div",Ft,[m[0]||(m[0]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Комментарии")],-1)),e("div",Ut,[v(Et,{comments:i.comments,"show-parent-references":""},null,8,["comments"]),v(u(ut),{onSubmit:a,"is-loading":s.value},null,8,["is-loading"])])]))}}),Pt={class:"space-y-4"},Rt={class:"bg-white shadow rounded-lg p-4"},zt={class:"space-y-3"},Bt=I({__name:"IssueSidebar",props:{issue:{}},emits:["priority-changed","due-date-changed"],setup(y,{emit:c}){const t=ae();return(l,s)=>{var a,i;return r(),d("div",Pt,[e("div",Rt,[s[8]||(s[8]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Детали",-1)),e("div",zt,[e("div",null,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Приоритет",-1)),v(u(Le),{modelValue:l.issue.priority,"onUpdate:modelValue":s[0]||(s[0]=m=>l.issue.priority=m),onChange:s[1]||(s[1]=m=>u(t).updateIssue(l.issue.id,{priority:m}))},null,8,["modelValue"])]),e("div",null,[s[5]||(s[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Дата дедлайна",-1)),v(u(Ne),{modelValue:l.issue.due_date,"onUpdate:modelValue":s[2]||(s[2]=m=>l.issue.due_date=m),onChange:s[3]||(s[3]=m=>u(t).updateIssue(l.issue.id,{due_date:m}))},null,8,["modelValue"])]),s[6]||(s[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Среда",-1)),v(u(Y),{variant:"info",text:(a=l.issue.event)==null?void 0:a.environment},null,8,["text"]),s[7]||(s[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Релиз",-1)),v(u(Y),{variant:"light",text:((i=l.issue.event)==null?void 0:i.release)??"Не указан"},null,8,["text"])])])])}}}),Nt={class:"border-b border-gray-200"},Yt={class:"-mb-px flex space-x-8"},Ht=["onClick"],Ot={class:"flex items-center"},qt={key:0,class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Kt=I({__name:"IssueTabs",props:{activeTab:{},eventCount:{}},emits:["tab-change"],setup(y,{emit:c}){const t=y,l=c,s=[{name:"comments",label:"Комментарии",icon:"mdi:comment-text-multiple"},{name:"activities",label:"Активность",icon:"mdi:history"},{name:"events",label:"События",icon:"mdi:alert-circle",count:t.eventCount}];return(a,i)=>(r(),d("div",Nt,[e("nav",Yt,[(r(),d(M,null,L(s,m=>e("button",{key:m.name,onClick:k=>l("tab-change",m.name),class:P([m.name===a.activeTab?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},[e("span",Ot,[v(u(S),{icon:m.icon,class:"mr-2 h-5 w-5"},null,8,["icon"]),B(" "+h(m.label)+" ",1),m.count!==void 0?(r(),d("span",qt,h(m.count),1)):b("",!0)])],10,Ht)),64))])]))}}),Jt={class:"bg-white shadow rounded-lg overflow-hidden"},Qt={class:"px-4 py-5 sm:p-6"},Xt={key:0,class:"flex justify-center py-8"},Gt={key:1,class:"text-center py-8 text-gray-500"},Wt={key:2,class:"divide-y divide-gray-200"},Zt={class:"flex items-center space-x-4"},es={class:"flex-shrink-0"},ts={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center"},ss={class:"flex-1 min-w-0"},ns={class:"text-sm font-medium text-gray-900 truncate"},as={class:"text-sm text-gray-500 truncate"},os=I({__name:"IssueEvents",props:{issueId:{}},setup(y){const c=y,t=_([]),l=_(!0),s=_({currentPage:1,perPage:10,total:0}),a=async()=>{try{l.value=!0;const m=await ye.getEvents(c.issueId,s.value.currentPage,s.value.perPage);t.value=m.events,s.value.total=m.total}catch(m){console.error("Error fetching events:",m)}finally{l.value=!1}},i=m=>{s.value.currentPage=m,a()};return J(()=>{a()}),(m,k)=>(r(),d("div",Jt,[k[1]||(k[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"События"),e("p",{class:"mt-1 text-sm text-gray-500"}," Все события, связанные с этой проблемой ")],-1)),e("div",Qt,[l.value?(r(),d("div",Xt," Загрузка ")):t.value.length===0?(r(),d("div",Gt," События не найдены ")):(r(),d("ul",Wt,[(r(!0),d(M,null,L(t.value,g=>(r(),d("li",{key:g.id,class:"py-4"},[e("div",Zt,[e("div",es,[e("span",ts,[v(u(S),{icon:"mdi:alert-circle",class:"h-5 w-5 text-gray-600"})])]),e("div",ss,[e("p",ns,h(g.message),1),e("p",as,h(u(re)(g.created_at))+" · "+h(g.environment),1)]),k[0]||(k[0]=e("div",null,[e("button",{type:"button",class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," View ")],-1))])]))),128))])),t.value.length?(r(),E(u(Ie),{key:3,class:"mt-6",onPageChanged:i,pagination:s.value,text:"событий"},null,8,["pagination"])):b("",!0)])]))}}),is={class:"bg-white shadow rounded-lg p-4 mt-4"},rs={class:"flex items-center justify-between mb-3"},ls={class:"space-y-3"},us={key:0},ds={class:"space-y-2"},cs={class:"flex items-center"},ms={class:"text-sm font-medium text-gray-900"},gs=["onClick"],ps={key:1},vs={class:"space-y-2"},ys={class:"flex items-center"},fs={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center mr-3"},hs={class:"text-sm font-medium text-gray-900"},xs=["onClick"],_s={key:2,class:"text-sm text-gray-500"},bs={class:"space-y-4"},ws={key:0},$s={key:1},ks={class:"flex gap-2"},Ds=I({__name:"IssueAssignees",props:{assignees:{}},emits:["assignee-added","assignee-removed"],setup(y,{emit:c}){const t=ae(),l=_(!1),s=_("user"),a=_([]),i=_([]),m=_([]),k=_([]),g=()=>{s.value==="user"?t.addAssignee(t.issue.id,"user",a.value):t.addAssignee(t.issue.id,"team",i.value),l.value=!1},w=()=>{a.value=null,i.value=null},V=async D=>{try{m.value=(await U.post("/users/available",{query:{q:D},issue_id:t.issue.id})).users}catch(f){console.error("Error fetching users:",f)}},x=async D=>{try{k.value=(await U.get("/teams/available",{query:{q:D},issue_id:t.issue.id})).teams}catch(f){console.error("Error fetching teams:",f)}};return J(async()=>{t.issue.id&&(await V(),await x())}),te(l,D=>{D?s.value==="user"?V():x():w()}),te(s,D=>{D==="user"?V():x(),w()}),(D,f)=>(r(),d("div",is,[e("div",rs,[f[6]||(f[6]=e("h3",{class:"text-sm font-medium text-gray-900"},"Назначенные",-1)),e("button",{onClick:f[0]||(f[0]=$=>l.value=!0),class:"text-sm text-indigo-600 hover:text-indigo-900 cursor-pointer"}," Добавить ")]),e("div",ls,[D.assignees.users.length>0?(r(),d("div",us,[f[7]||(f[7]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Пользователи",-1)),e("ul",ds,[(r(!0),d(M,null,L(D.assignees.users,$=>(r(),d("li",{key:`user-${$.id}`,class:"flex items-center justify-between"},[e("div",cs,[v(u(le),{class:"mr-3",size:"sm",name:$.name},null,8,["name"]),e("span",ms,h($.name),1)]),e("button",{onClick:F=>u(t).removeAssignee(u(t).issue.id,"user",$.id),class:"text-gray-400 hover:text-gray-500"},[v(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,gs)]))),128))])])):b("",!0),D.assignees.teams.length>0?(r(),d("div",ps,[f[8]||(f[8]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Команды",-1)),e("ul",vs,[(r(!0),d(M,null,L(D.assignees.teams,$=>(r(),d("li",{key:`team-${$.id}`,class:"flex items-center justify-between"},[e("div",ys,[e("span",fs,[v(u(S),{icon:"mdi:account-group",class:"h-5 w-5 text-gray-600"})]),e("span",hs,h($.name),1)]),e("button",{onClick:F=>u(t).removeAssignee(u(t).issue.id,"team",$.id),class:"text-gray-400 hover:text-gray-500"},[v(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,xs)]))),128))])])):b("",!0),D.assignees.users.length===0&&D.assignees.teams.length===0?(r(),d("p",_s,[v(u(Me),{title:"Назначенные отсутствуют",description:"Добавьте ответственных за эту задачу",icon:"heroicons:user-group"})])):b("",!0)]),v(u($e),{"is-open":l.value,onClose:f[5]||(f[5]=$=>l.value=!1)},{title:j(()=>f[9]||(f[9]=[B("Добавить ответственного")])),content:j(()=>[e("div",bs,[f[12]||(f[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Тип",-1)),v(u(ee),{options:[{value:"user",label:"Пользователь"},{value:"team",label:"Команда"}],"option-label":"label","option-value":"value",modelValue:s.value,"onUpdate:modelValue":f[1]||(f[1]=$=>s.value=$)},null,8,["modelValue"]),s.value==="user"?(r(),d("div",ws,[f[10]||(f[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выбрать пользователей",-1)),v(u(ee),{onSearch:V,options:m.value,"option-label":"name","option-value":"id",modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=$=>a.value=$),multiple:"",searchable:"",placeholder:"Выберите пользователей"},null,8,["options","modelValue"])])):(r(),d("div",$s,[f[11]||(f[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выберите команды",-1)),v(u(ee),{onSearch:x,options:k.value,"option-label":"name","option-value":"id",modelValue:i.value,"onUpdate:modelValue":f[3]||(f[3]=$=>i.value=$),multiple:"",searchable:"",placeholder:"Выберите команды"},null,8,["options","modelValue"])]))])]),footer:j(()=>[e("div",ks,[v(u(ne),{variant:"secondary",onClick:f[4]||(f[4]=$=>l.value=!1)},{default:j(()=>f[13]||(f[13]=[B(" Отмена ")])),_:1}),v(u(ne),{onClick:g},{default:j(()=>f[14]||(f[14]=[B(" Добавить ")])),_:1})])]),_:1},8,["is-open"])]))}}),Cs={class:"bg-white shadow rounded-lg p-4 mt-4"},Ss={class:"space-y-3"},Is={class:"flex justify-between"},Ms={class:"text-sm text-gray-900"},Ts={class:"flex justify-between"},Vs={class:"text-sm text-gray-900"},Ls={class:"flex justify-between"},As={class:"text-sm text-gray-900"},Es={class:"flex justify-between"},Fs={class:"text-sm text-gray-900"},Us={class:"flex justify-between"},js={class:"text-sm text-gray-900 text-right font-mono"},Ps={class:"flex justify-between"},Rs={class:"flex justify-between"},zs=I({__name:"IssueMeta",props:{issue:{}},setup(y){const c=A(()=>{var l,s;const t=(l=y.issue)==null?void 0:l.event.type.split("\\");return t.length>1?t[t.length-1]:(s=y.issue)==null?void 0:s.event.type});return(t,l)=>{var s,a,i;return r(),d("div",Cs,[l[7]||(l[7]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Все метаданные",-1)),e("div",Ss,[e("div",Is,[l[0]||(l[0]=e("span",{class:"text-xs font-medium text-gray-500"},"Создана",-1)),e("span",Ms,h(u(re)((s=t.issue)==null?void 0:s.created_at)),1)]),e("div",Ts,[l[1]||(l[1]=e("span",{class:"text-xs font-medium text-gray-500"},"Обновлена",-1)),e("span",Vs,h(u(re)((a=t.issue)==null?void 0:a.updated_at)),1)]),e("div",Ls,[l[2]||(l[2]=e("span",{class:"text-xs font-medium text-gray-500"},"Среда",-1)),e("span",As,h((i=t.issue.event)==null?void 0:i.environment),1)]),e("div",Es,[l[3]||(l[3]=e("span",{class:"text-xs font-medium text-gray-500"},"Релиз",-1)),e("span",Fs,h(t.issue.event.release||"Not specified"),1)]),e("div",Us,[l[4]||(l[4]=e("span",{class:"text-xs font-medium text-gray-500"},"Айди события",-1)),e("span",js,h(t.issue.event.event_id),1)]),e("div",Ps,[l[5]||(l[5]=e("span",{class:"text-xs font-medium text-gray-500"},"Тип события",-1)),v(Y,{variant:"default"},{default:j(()=>[B(h(c.value),1)]),_:1})]),e("div",Rs,[l[6]||(l[6]=e("span",{class:"text-xs font-medium text-gray-500"},"Уровень события",-1)),t.issue.event.level==="error"?(r(),E(Y,{key:0,variant:"danger",text:t.issue.event.level},null,8,["text"])):b("",!0),t.issue.event.level==="warning"?(r(),E(Y,{key:1,variant:"warning",text:t.issue.event.level},null,8,["text"])):b("",!0),t.issue.event.level==="info"?(r(),E(Y,{key:2,variant:"info",text:t.issue.event.level},null,8,["text"])):b("",!0),t.issue.event.level==="debug"?(r(),E(Y,{key:3,variant:"info",text:t.issue.event.level},null,8,["text"])):b("",!0)])])])}}}),Bs={class:"space-y-2"},Ns={key:0,class:"space-y-2"},Ys={key:0,class:"flex items-start space-x-2"},Hs={class:"text-gray-500 capitalize"},Os={class:"text-sm font-medium"},qs={key:1,class:"flex items-center space-x-2"},Ks={key:2,class:"flex items-center space-x-2"},Js={class:"text-sm text-gray-600"},Qs={key:0,class:"flex items-start space-x-2"},Xs={class:"text-gray-500 capitalize"},Gs={class:"flex-1"},Ws={class:"flex items-center space-x-2"},Zs={class:"text-sm text-gray-600 line-through"},en={class:"text-sm font-medium"},tn=I({__name:"IssueActivityChanges",props:{activity:{}},setup(y){const c=["updated_at","created_at"],t=g=>!c.includes(g),l=g=>({title:"Название",priority:"Приоритет",culprit:"Виновник",due_date:"Дедлайн",status:"Статус"})[g]||g,s=(g,w)=>w==null?"Не установлено":g==="due_date"?m(w):w,a=g=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[g]||g,i=g=>({open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",closed:"bg-purple-100 text-purple-800"})[g]||"bg-gray-100 text-gray-800",m=g=>g?new Date(g).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):null,k=g=>g?new Date(g)<new Date:!1;return(g,w)=>(r(),d("div",Bs,[g.activity.type==="created_issue"?(r(),d("div",Ns,[(r(!0),d(M,null,L(g.activity.changes.after,(V,x)=>(r(),d("div",{key:x,class:"space-y-1"},[t(x)?(r(),d("div",Ys,[e("span",Hs,h(l(x))+":",1),e("span",Os,h(s(x,V)),1)])):b("",!0)]))),128))])):g.activity.type==="status_changed"?(r(),d("div",qs,[w[0]||(w[0]=e("span",{class:"text-gray-500"},"Статус:",-1)),g.activity.changes.before?(r(),d(M,{key:0},[e("span",{class:P(["px-2 py-0.5 rounded text-xs line-through",i(g.activity.changes.before.status)])},h(a(g.activity.changes.before.status)),3),v(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):b("",!0),e("span",{class:P(["px-2 py-0.5 rounded text-xs",i(g.activity.changes.after.status)])},h(a(g.activity.changes.after.status)),3)])):g.activity.type==="due_date_changed"?(r(),d("div",Ks,[w[1]||(w[1]=e("span",{class:"text-gray-500"},"Дедлайн:",-1)),g.activity.changes.before?(r(),d(M,{key:0},[e("span",Js,h(m(g.activity.changes.before.due_date)||"Не установлен"),1),v(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):b("",!0),e("span",{class:P(["text-sm font-medium",{"text-red-600":k(g.activity.changes.after.due_date)}])},h(m(g.activity.changes.after.due_date)||"Не установлен"),3)])):(r(!0),d(M,{key:3},L(g.activity.changes.after,(V,x)=>(r(),d("div",{key:x,class:"space-y-1"},[t(x)&&(!g.activity.changes.before||g.activity.changes.before[x]!==V)?(r(),d("div",Qs,[e("span",Xs,h(l(x))+":",1),e("div",Gs,[e("div",Ws,[g.activity.changes.before?(r(),d(M,{key:0},[e("span",Zs,h(s(x,g.activity.changes.before[x])),1),v(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):b("",!0),e("span",en,h(s(x,V)),1)])])])):b("",!0)]))),128))]))}}),sn=ve(tn,[["__scopeId","data-v-e15e07a4"]]),nn={class:"bg-white shadow rounded-lg overflow-hidden"},an={class:"space-y-4 px-4 py-5"},on={class:"flex-shrink-0"},rn={class:"flex-1 min-w-0"},ln={class:"flex items-center space-x-2 text-sm"},un={class:"font-medium text-gray-900"},dn={class:"text-gray-500"},cn={class:"mt-1 text-sm"},mn={key:0,class:"text-center py-4 text-gray-500"},gn=I({__name:"IssueActivityFeed",props:{activities:{}},setup(y){const c={created_issue:"bg-green-100 text-green-800",updated_issue:"bg-blue-100 text-blue-800",status_changed:"bg-purple-100 text-purple-800",due_date_changed:"bg-yellow-100 text-yellow-800",comment_added:"bg-indigo-100 text-indigo-800"},t=s=>({created_issue:"Создана",updated_issue:"Обновлена",status_changed:"Статус изменён",due_date_changed:"Дедлайн изменён",comment_added:"Комментарий добавлен"})[s]||s,l=s=>new Date(s).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(s,a)=>(r(),d("div",nn,[a[1]||(a[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"История изменений")],-1)),e("div",an,[(r(!0),d(M,null,L(s.activities,i=>(r(),d("div",{key:i.id,class:"flex items-start space-x-3"},[e("div",on,[v(u(le),{name:i.user.name,size:"sm"},null,8,["name"])]),e("div",rn,[e("div",ln,[e("span",un,h(i.user.name),1),e("span",dn,h(l(i.created_at)),1),a[0]||(a[0]=e("span",{class:"text-gray-400"},"•",-1)),e("span",{class:P(["text-xs px-2 py-0.5 rounded-full",c[i.type]||"bg-gray-100 text-gray-800"])},h(t(i.type)),3)]),e("div",cn,[v(sn,{activity:i},null,8,["activity"])])])]))),128)),s.activities.length?b("",!0):(r(),d("div",mn," Нет записей об изменениях "))])]))}}),pn={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},vn={key:0,class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},yn={class:"lg:col-span-2 space-y-6"},fn={class:"lg:col-span-1"},Fn=I({__name:"Show",props:{id:{}},setup(y){const c=ae(),t=_("comments"),l=s=>{t.value=s};return J(async()=>{await c.fetchIssue(y.id)}),(s,a)=>(r(),E(ke,null,{default:j(()=>{var i,m;return[e("div",pn,[v(yt,{issue:u(c).issue},null,8,["issue"]),(i=u(c).issue)!=null&&i.id?(r(),d("div",vn,[e("div",yn,[v($t,{event:u(c).issue.event},null,8,["event"]),v(Kt,{"active-tab":t.value,onTabChange:l},null,8,["active-tab"]),t.value==="comments"?(r(),E(jt,{key:0,"issue-id":u(c).issue.id,comments:(m=u(c).issue)==null?void 0:m.comments,onCommentAdded:a[0]||(a[0]=k=>u(c).fetchIssue(u(c).issue.id))},null,8,["issue-id","comments"])):t.value==="activities"?(r(),E(gn,{key:1,activities:u(c).issue.activities},null,8,["activities"])):t.value==="events"?(r(),E(os,{key:2,"issue-id":u(c).issue.id},null,8,["issue-id"])):b("",!0)]),e("div",fn,[v(Bt,{issue:u(c).issue},null,8,["issue"]),v(Ds,{assignees:u(c).issue.assignees},null,8,["assignees"]),v(zs,{issue:u(c).issue},null,8,["issue"])])])):b("",!0)])]}),_:1}))}});export{Fn as default};
