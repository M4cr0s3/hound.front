import{i as U,d as S,c as L,a as d,o as r,p as j,t as h,l as z,f as u,k as $,m as ne,B as ge,C as ee,b as e,e as p,a4 as fe,w as R,q as _,F as T,n as A,a5 as le,j as ue,a6 as ie,a7 as de,a8 as he,h as B,a9 as te,aa as ce,g as xe,R as be}from"./index-Bae0tEEm.js";import{u as ae}from"./issues-VCH5-FJB.js";import{c as _e,_ as re,M as we,a as $e}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DOHDoK6a.js";import{I as W}from"./types-Cl0W0wgk.js";import{I as C}from"./iconify-B6ijirIO.js";import{_ as se}from"./Button.vue_vue_type_script_setup_true_lang-Ij7bq6AL.js";import{M as pe}from"./index-BCqgpTI_.js";import{S as ke,_ as De}from"./JsonViewer.vue_vue_type_script_setup_true_lang-CghwlgEX.js";import{u as Ce}from"./index-DMFhRu4i.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Z}from"./SelectField.vue_vue_type_script_setup_true_lang-CkoF-QKR.js";import{_ as Y}from"./Badge.vue_vue_type_script_setup_true_lang-DQha9Emq.js";import{_ as Se}from"./EmptyState.vue_vue_type_script_setup_true_lang-DWsZobwZ.js";import{f as me}from"./index-FUb4nFco.js";import"./projects-DlZkTUBl.js";import"./form-D1RenkPA.js";const Ie={async get(f){return U.get(`/issues/${f}`)},async updateStatus(f,c){await U.patch(`/issues/${f}/status`,{status:c})},async updatePriority(f,c){await U.patch(`/issues/${f}/priority`,{priority:c})},async updateDueDate(f,c){await U.patch(`/issues/${f}/due-date`,{due_date:c})},async addAssignee(f,c,n){await U.post(`/issues/${f}/assignees`,{type:c,id:n})},async removeAssignee(f,c,n){await U.delete(`/issues/${f}/assignees`,{data:{type:c,id:n}})},async addComment(f,c){await U.post(`/issues/${f}/comments`,{text:c})}},Me=S({__name:"StatusBadge",props:{status:{}},setup(f){const c=f,n=L(()=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[c.status]),l=L(()=>({closed:"bg-red-100 text-red-800",resolved:"bg-green-100 text-green-800",open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800"})[c.status]);return(a,i)=>(r(),d("span",{class:j(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",l.value])},h(n.value),3))}}),Te=S({__name:"PriorityBadge",props:{priority:{}},setup(f){const c=L(()=>({low:"Низкий",medium:"Средний",high:"Высокий",critical:"Критический"})[f.priority]),n=L(()=>({low:"bg-gray-100 text-gray-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"})[f.priority]);return(l,a)=>(r(),d("span",{class:j(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",n.value])},h(c.value),3))}}),Ve=S({__name:"PrioritySelect",props:{modelValue:{}},emits:["update:modelValue","change"],setup(f,{emit:c}){const n=c,l=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],a=i=>{n("update:modelValue",i),n("change",i)};return(i,t)=>(r(),z(u(Z),{options:l,"option-label":"label","option-value":"value",modelValue:i.modelValue,placeholder:"Выберите приоритет","onUpdate:modelValue":a},null,8,["modelValue"]))}}),Le={class:"relative"},Ae={class:"flex items-center"},Fe=["value","placeholder"],Ue={key:0,class:"absolute z-10 mt-1 w-auto bg-white rounded-md shadow-lg p-4 border border-gray-200 min-w-60"},Re={class:"flex justify-between items-center mb-4"},je={class:"text-sm font-medium text-gray-900"},Ee={class:"grid grid-cols-7 gap-1 mb-2"},Pe={class:"grid grid-cols-7 gap-1"},ze=["onClick"],Be=S({__name:"DatePicker",props:{modelValue:{type:String,default:null},placeholder:{type:String,default:"Выберите дату"}},emits:["update:modelValue","change"],setup(f,{emit:c}){const n=f,l=c,a=$(!1),i=$(new Date),t=$(null);n.modelValue&&(t.value=new Date(n.modelValue));const v=s=>s?s.toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"",I=L(()=>v(t.value)),g=L(()=>i.value.getFullYear()),b=L(()=>i.value.getMonth()),V=L(()=>i.value.toLocaleString("default",{month:"long"})),x=L(()=>{const s=g.value,o=b.value,m=new Date(s,o,1),D=new Date(s,o+1,0),E=m.getDay(),K=6-D.getDay(),P=[],O=new Date(s,o,0).getDate();for(let M=E-1;M>=0;M--){const N=O-M;P.push({day:N,date:new Date(s,o-1,N),isCurrentMonth:!1,isToday:k(new Date(s,o-1,N)),isSelected:y(new Date(s,o-1,N))})}const ye=D.getDate();for(let M=1;M<=ye;M++){const N=new Date(s,o,M);P.push({day:M,date:N,isCurrentMonth:!0,isToday:k(N),isSelected:y(N)})}for(let M=1;M<=K;M++)P.push({day:M,date:new Date(s,o+1,M),isCurrentMonth:!1,isToday:k(new Date(s,o+1,M)),isSelected:y(new Date(s,o+1,M))});return P}),k=s=>{const o=new Date;return s.getDate()===o.getDate()&&s.getMonth()===o.getMonth()&&s.getFullYear()===o.getFullYear()},y=s=>t.value?s.getDate()===t.value.getDate()&&s.getMonth()===t.value.getMonth()&&s.getFullYear()===t.value.getFullYear():!1,w=()=>{a.value=!a.value},F=()=>{i.value=new Date(g.value,b.value-1,1)},J=()=>{i.value=new Date(g.value,b.value+1,1)},Q=s=>{if(!s.isCurrentMonth)return;t.value=s.date,i.value=new Date(s.date);const o=X(s.date);l("update:modelValue",o),l("change",o),a.value=!1},oe=()=>{const s=new Date;s.setHours(0,0,0,0),t.value=s,i.value=new Date(s);const o=X(s);l("update:modelValue",o),l("change",o),a.value=!1},X=s=>{if(!s)return null;const o=s.getFullYear(),m=String(s.getMonth()+1).padStart(2,"0"),D=String(s.getDate()).padStart(2,"0");return`${o}-${m}-${D}`},G=()=>{t.value=null,l("update:modelValue",null),a.value=!1},H=s=>{s.target.closest(".relative")||(a.value=!1)},q=s=>{if(!s)return null;try{const o=new Date(s);return isNaN(o.getTime())?(console.error("Invalid date:",s),null):o}catch(o){return console.error("Error parsing date:",o),null}};return ne(()=>{n.modelValue&&(t.value=q(n.modelValue),t.value&&(i.value=new Date(t.value))),document.addEventListener("click",H)}),ge(()=>{document.removeEventListener("click",H)}),ee(()=>n.modelValue,s=>{const o=q(s);if(o){const m=new Date(o.getFullYear(),o.getMonth(),o.getDate()),D=t.value?new Date(t.value.getFullYear(),t.value.getMonth(),t.value.getDate()):null;(!D||m.getTime()!==D.getTime())&&(t.value=o,i.value=new Date(o))}else t.value=null},{immediate:!0}),(s,o)=>(r(),d("div",Le,[e("div",Ae,[e("input",{type:"text",value:I.value,onClick:w,readonly:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:f.placeholder},null,8,Fe),e("button",{type:"button",onClick:w,class:"absolute right-0 px-3 py-2 text-gray-400 hover:text-gray-500"},[p(u(C),{icon:"mdi:calendar",class:"h-5 w-5"})])]),p(fe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:R(()=>[a.value?(r(),d("div",Ue,[e("div",Re,[e("button",{onClick:F,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[p(u(C),{icon:"mdi:chevron-left",class:"h-5 w-5"})]),e("span",je,h(V.value)+" "+h(g.value),1),e("button",{onClick:J,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[p(u(C),{icon:"mdi:chevron-right",class:"h-5 w-5"})])]),e("div",Ee,[(r(),d(T,null,A(["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],m=>e("div",{key:m,class:"text-xs text-center text-gray-500"},h(m),1)),64))]),e("div",Pe,[(r(!0),d(T,null,A(x.value,m=>(r(),d("div",{key:m.date,onClick:D=>Q(m),class:j(["text-center py-1 text-sm rounded-full",{"text-gray-400":!m.isCurrentMonth,"hover:bg-gray-100 cursor-pointer":m.isCurrentMonth,"bg-indigo-100 text-indigo-700 font-medium":m.isSelected,"bg-indigo-600 text-white font-medium":m.isToday&&m.isSelected}])},h(m.day),11,ze))),128))]),e("div",{class:"mt-4 flex justify-between"},[e("button",{onClick:oe,type:"button",class:"text-xs text-indigo-600 cursor-pointer hover:text-indigo-900"}," Сегодня "),e("button",{onClick:G,type:"button",class:"text-xs text-gray-500 cursor-pointer hover:text-gray-700"}," Очистить ")])])):_("",!0)]),_:1})]))}}),Ne=["onKeydown"],Ye={class:"border-b border-gray-200"},He={class:"-mb-px flex space-x-8"},Oe=["onClick"],qe={class:"relative"},Ke={class:"overflow-hidden rounded-lg shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-indigo-500 transition-all duration-200"},Je={key:0,class:"absolute z-10 mt-1 w-64 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-gray-300 ring-opacity-5 focus:outline-none sm:text-sm"},Qe=["onClick"],Xe={class:"flex items-center"},Ge={class:"ml-3 block truncate text-gray-700 font-medium"},We={key:0,class:"px-4 py-2 text-gray-500 text-sm"},Ze={class:"absolute inset-x-0 bottom-0 flex justify-between items-center py-2 pl-3 pr-2 bg-gray-50 border-t border-gray-200"},et={class:"flex items-center space-x-2"},tt={class:"prose prose-sm max-w-none p-4 rounded-lg border border-gray-200"},st=["innerHTML"],nt={key:1,class:"text-gray-400 italic"},at={class:"flex justify-end"},ot={key:0,class:"flex items-center"},it={key:1,class:"flex items-center"},rt=S({__name:"CommentForm",props:{isLoading:{type:Boolean},initialValue:{}},emits:["submit"],setup(f,{emit:c}){const n=f,l=c,a=$("write"),i=$(n.initialValue||""),t=$(null),v=$(!1),I=$([]),g=$(0),b=$(""),V=$(-1),x=[{name:"write",label:"Редактор"},{name:"preview",label:"Превью"}],k=new pe({html:!0,linkify:!0,typographer:!0,highlight:function(s,o){if(o&&te.getLanguage(o))try{return te.highlight(s,{language:o}).value}catch{}return""}}),y=L(()=>i.value.trim()?k.render(i.value):null),w=()=>{i.value.trim()&&(l("submit",i.value.trim()),i.value="")},F=(s,o)=>{if(!t.value)return;const m=t.value.selectionStart,D=t.value.selectionEnd,E=i.value.substring(m,D),K=i.value.substring(0,m),P=i.value.substring(D);i.value=K+s+E+o+P,ce(()=>{if(!t.value)return;t.value.focus();const O=m+s.length;t.value.setSelectionRange(O,E?O+E.length:O)})},J=()=>{const o=(x.findIndex(m=>m.name===a.value)-1+x.length)%x.length;a.value=x[o].name},Q=()=>{const o=(x.findIndex(m=>m.name===a.value)+1)%x.length;a.value=x[o].name},oe=Ce(async s=>{try{I.value=await U.get(`/api/users/search?q=${s}`)}catch(o){console.error("Ошибка при поиске пользователей:",o),I.value=[]}},300),X=()=>{const s=t.value.selectionStart,o=i.value.substring(0,s),m=o.lastIndexOf("@");if(Math.abs(s-m)!==1)if(m>=0&&(m===0||/\s/.test(o[m-1]))){const D=o.substring(m+1);if(!D.trim()||/\s/.test(D))return;V.value=m,b.value=o.substring(m+1),v.value=!0,g.value=0,oe(b.value)}else v.value=!1},G=s=>{if(!t.value)return;const o=t.value,m=V.value,D=o.selectionStart,E=i.value.substring(0,m),K=i.value.substring(D);i.value=E+`@${s.name} `+K,v.value=!1,ce(()=>{o.focus();const P=m+s.name.length+2;o.setSelectionRange(P,P)})},H=s=>{v.value&&(s.key==="ArrowDown"?(s.preventDefault(),g.value=Math.min(g.value+1,I.value.length-1)):s.key==="ArrowUp"?(s.preventDefault(),g.value=Math.max(g.value-1,0)):s.key==="Enter"?(s.preventDefault(),I.value[g.value]&&G(I.value[g.value])):s.key==="Escape"&&(s.preventDefault(),v.value=!1)),s.altKey&&(s.key==="ArrowLeft"?(s.preventDefault(),J()):s.key==="ArrowRight"&&(s.preventDefault(),Q()))},q=s=>{t.value&&!t.value.contains(s.target)&&(v.value=!1)};return ne(()=>{window.addEventListener("keydown",H),document.addEventListener("click",q)}),ge(()=>{window.removeEventListener("keydown",H),document.removeEventListener("click",q)}),ee(()=>n.initialValue,s=>{s&&(i.value=s)}),(s,o)=>(r(),d("div",{class:"space-y-4",onKeydown:[le(ue(J,["alt","stop"]),["left"]),le(ue(Q,["alt","stop"]),["right"])]},[e("div",Ye,[e("nav",He,[(r(),d(T,null,A(x,m=>e("button",{key:m.name,onClick:D=>a.value=m.name,class:j([a.value===m.name?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},h(m.label),11,Oe)),64))])]),ie(e("div",qe,[e("div",Ke,[ie(e("textarea",{ref_key:"textareaRef",ref:t,id:"comment","onUpdate:modelValue":o[0]||(o[0]=m=>i.value=m),rows:"8",class:"block w-full focus:outline-none resize-none border-0 bg-transparent py-3 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6 font-mono",placeholder:"Напишите ваш комментарий (поддерживается Markdown)...",onKeydown:H,onInput:X},null,544),[[he,i.value]]),v.value?(r(),d("div",Je,[(r(!0),d(T,null,A(I.value,(m,D)=>(r(),d("div",{key:m.id,onClick:E=>G(m),class:j(["relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-indigo-50",{"bg-indigo-100":g.value===D}])},[e("div",Xe,[e("span",Ge,h(m.name),1)])],10,Qe))),128)),I.value.length===0?(r(),d("div",We," Пользователи не найдены ")):_("",!0)])):_("",!0),e("div",Ze,[e("div",et,[e("button",{type:"button",onClick:o[1]||(o[1]=m=>F("**","**")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Жирный текст"},[p(u(C),{icon:"mdi:format-bold",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[2]||(o[2]=m=>F("*","*")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Курсив"},[p(u(C),{icon:"mdi:format-italic",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[3]||(o[3]=m=>F("[","](url)")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Ссылка"},[p(u(C),{icon:"mdi:link-variant",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[4]||(o[4]=m=>F("```\n","\n```")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Блок кода"},[p(u(C),{icon:"mdi:code-tags",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[5]||(o[5]=m=>F("- ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Список"},[p(u(C),{icon:"mdi:format-list-bulleted",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[6]||(o[6]=m=>F("> ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Цитата"},[p(u(C),{icon:"mdi:format-quote-open",class:"h-5 w-5"})])]),o[7]||(o[7]=e("div",{class:"text-xs text-gray-500"}," Поддерживается Markdown. Ctrl+Enter для отправки ",-1))])])],512),[[de,a.value==="write"]]),ie(e("div",tt,[y.value?(r(),d("div",{key:0,innerHTML:y.value},null,8,st)):(r(),d("div",nt," Превью будет отображаться здесь... "))],512),[[de,a.value==="preview"]]),e("div",at,[p(u(se),{type:"button",onClick:w,disabled:s.isLoading||!i.value.trim()},{default:R(()=>[s.isLoading?(r(),d("span",ot,[p(u(C),{icon:"mdi:loading",class:"h-4 w-4 animate-spin mr-2"}),o[8]||(o[8]=B(" Отправка... "))])):(r(),d("span",it,[p(u(C),{icon:"mdi:send",class:"h-4 w-4 mr-2"}),o[9]||(o[9]=B(" Отправить "))]))]),_:1},8,["disabled"])])],40,Ne))}}),lt=ve(rt,[["__scopeId","data-v-8b816cc4"]]),ut={class:"border-b border-gray-200 pb-4"},dt={class:"flex items-start justify-between"},ct={class:"text-2xl font-bold text-gray-900"},mt={class:"text-gray-500"},gt={class:"mt-2 flex items-center space-x-4"},pt={class:"flex space-x-3"},vt=S({__name:"IssueHeader",props:{issue:{}},setup(f){const c=f,n=xe(),l=ae(),a=[{icon:"heroicons:lock-closed",iconClass:"text-gray-700",key:"lock",label:"Закрыть",handler:async()=>{await l.updateIssueStatus(c.issue.id,W.Closed)},visible:()=>c.issue.status!==W.Closed},{icon:"heroicons:trash",iconClass:"text-red-500",key:"delete",label:"Удалить",handler:async()=>{await l.deleteIssue(c.issue.id),await n.push(be.ISSUE.INDEX)}}];return(i,t)=>(r(),d("div",ut,[e("div",dt,[e("div",null,[e("h1",ct,[B(h(i.issue.title)+" ",1),e("span",mt,"#"+h(i.issue.id),1)]),e("div",gt,[p(u(Me),{status:i.issue.status},null,8,["status"]),p(u(Te),{priority:i.issue.priority},null,8,["priority"])])]),e("div",pt,[i.issue.status!==u(W).Resolved?(r(),z(u(se),{key:0,variant:"secondary",onClick:t[0]||(t[0]=v=>u(l).updateIssueStatus(i.issue.id,u(W).Resolved))},{default:R(()=>t[1]||(t[1]=[B(" Решить ")])),_:1})):_("",!0),p(u(_e),{actions:a})])])]))}}),yt={class:"bg-white shadow rounded-lg overflow-hidden"},ft={class:"px-4 py-5 sm:p-6"},ht={class:"mb-4"},xt={class:"text-sm text-gray-700"},bt={key:0,class:"mb-4"},_t={key:1,class:"mb-4"},wt=S({__name:"IssueDescription",props:{event:{}},setup(f){return(c,n)=>(r(),d("div",yt,[n[3]||(n[3]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Детали ошибки")],-1)),e("div",ft,[e("div",ht,[n[0]||(n[0]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Сообщение",-1)),e("p",xt,h(c.event.message),1)]),c.event.metadata.stacktrace?(r(),d("div",bt,[n[1]||(n[1]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Стектрейс",-1)),p(u(ke),{stacktrace:c.event.metadata.stacktrace},null,8,["stacktrace"])])):_("",!0),c.event.metadata.context?(r(),d("div",_t,[n[2]||(n[2]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Контекст",-1)),p(u(De),{data:c.event.metadata.context},null,8,["data"])])):_("",!0)])]))}}),$t={class:"space-y-4 mb-2"},kt={class:"flex space-x-3"},Dt={class:"flex-shrink-0"},Ct={class:"flex-1 min-w-0"},St={class:"flex items-center space-x-2 text-sm"},It={class:"font-medium text-gray-900"},Mt={class:"text-gray-500"},Tt={class:"mt-1 flex items-center text-sm text-gray-700"},Vt={class:"text-gray-500"},Lt=["innerHTML"],At=S({__name:"IssueComments",props:{comments:{},showParentReferences:{type:Boolean,default:!1}},emits:["submit-reply"],setup(f,{emit:c}){$(""),$(null);const n=new pe({html:!0,linkify:!0,typographer:!0,highlight:function(i,t){if(t&&te.getLanguage(t))try{return te.highlight(i,{language:t}).value}catch{}return""}}),l=i=>n.render(i.trim()),a=i=>new Date(i).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(i,t)=>(r(),d("div",$t,[(r(!0),d(T,null,A(i.comments,v=>(r(),d("div",{key:v.id,class:"relative"},[e("div",kt,[e("div",Dt,[p(u(re),{name:v.user.name,size:"sm"},null,8,["name"])]),e("div",Ct,[e("div",St,[e("span",It,h(v.user.name),1),e("span",Mt,h(a(v.created_at)),1)]),e("div",Tt,[v.parent&&i.showParentReferences?(r(),d(T,{key:0},[e("span",Vt,"@"+h(v.parent.user.name),1),t[0]||(t[0]=e("span",{class:"text-gray-300 mx-1"},"•",-1))],64)):_("",!0),e("span",{innerHTML:l(v.text)},null,8,Lt)])])])]))),128))]))}}),Ft={class:"bg-white shadow rounded-lg overflow-hidden"},Ut={class:"px-4 py-5 sm:p-6"},Rt=S({__name:"IssueCommentsTab",props:{issueId:{},comments:{}},emits:["comment-added"],setup(f,{emit:c}){const n=f,l=c,a=$(!1),i=async t=>{a.value=!0;try{await Ie.addComment(n.issueId,t),l("comment-added")}catch(v){console.error("Error adding comment:",v)}finally{a.value=!1}};return(t,v)=>(r(),d("div",Ft,[v[0]||(v[0]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Комментарии")],-1)),e("div",Ut,[p(At,{comments:t.comments,"show-parent-references":""},null,8,["comments"]),p(u(lt),{onSubmit:i,"is-loading":a.value},null,8,["is-loading"])])]))}}),jt={class:"space-y-4"},Et={class:"bg-white shadow rounded-lg p-4"},Pt={class:"space-y-3"},zt=S({__name:"IssueSidebar",props:{issue:{}},emits:["priority-changed","due-date-changed"],setup(f,{emit:c}){const n=ae();return(l,a)=>{var i,t;return r(),d("div",jt,[e("div",Et,[a[8]||(a[8]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Детали",-1)),e("div",Pt,[e("div",null,[a[4]||(a[4]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Приоритет",-1)),p(u(Ve),{modelValue:l.issue.priority,"onUpdate:modelValue":a[0]||(a[0]=v=>l.issue.priority=v),onChange:a[1]||(a[1]=v=>u(n).updateIssue(l.issue.id,{priority:v}))},null,8,["modelValue"])]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Дата дедлайна",-1)),p(u(Be),{modelValue:l.issue.due_date,"onUpdate:modelValue":a[2]||(a[2]=v=>l.issue.due_date=v),onChange:a[3]||(a[3]=v=>u(n).updateIssue(l.issue.id,{due_date:v}))},null,8,["modelValue"])]),a[6]||(a[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Среда",-1)),p(u(Y),{variant:"info",text:(i=l.issue.event)==null?void 0:i.environment},null,8,["text"]),a[7]||(a[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Релиз",-1)),p(u(Y),{variant:"light",text:((t=l.issue.event)==null?void 0:t.release)??"Не указан"},null,8,["text"])])])])}}}),Bt={class:"border-b border-gray-200"},Nt={class:"-mb-px flex space-x-8"},Yt=["onClick"],Ht={class:"flex items-center"},Ot={key:0,class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},qt=S({__name:"IssueTabs",props:{activeTab:{},eventCount:{}},emits:["tab-change"],setup(f,{emit:c}){const n=c,l=[{name:"comments",label:"Комментарии",icon:"heroicons:chat-bubble-oval-left"},{name:"activities",label:"Активность",icon:"mdi:history"}];return(a,i)=>(r(),d("div",Bt,[e("nav",Nt,[(r(),d(T,null,A(l,t=>e("button",{key:t.name,onClick:v=>n("tab-change",t.name),class:j([t.name===a.activeTab?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},[e("span",Ht,[p(u(C),{icon:t.icon,class:"mr-2 h-5 w-5"},null,8,["icon"]),B(" "+h(t.label)+" ",1),t.count!==void 0?(r(),d("span",Ot,h(t.count),1)):_("",!0)])],10,Yt)),64))])]))}}),Kt={class:"bg-white shadow rounded-lg p-4 mt-4"},Jt={class:"flex items-center justify-between mb-3"},Qt={class:"space-y-3"},Xt={key:0},Gt={class:"space-y-2"},Wt={class:"flex items-center"},Zt={class:"text-sm font-medium text-gray-900"},es=["onClick"],ts={key:1},ss={class:"space-y-2"},ns={class:"flex items-center"},as={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center mr-3"},os={class:"text-sm font-medium text-gray-900"},is=["onClick"],rs={key:2,class:"text-sm text-gray-500"},ls={class:"space-y-4"},us={key:0},ds={key:1},cs={class:"flex gap-2"},ms=S({__name:"IssueAssignees",props:{assignees:{}},emits:["assignee-added","assignee-removed"],setup(f,{emit:c}){const n=ae(),l=$(!1),a=$("user"),i=$([]),t=$([]),v=$([]),I=$([]),g=()=>{a.value==="user"?n.addAssignee(n.issue.id,"user",i.value):n.addAssignee(n.issue.id,"team",t.value),l.value=!1},b=()=>{i.value=null,t.value=null},V=async k=>{try{v.value=(await U.post("/users/available",{query:{q:k},issue_id:n.issue.id})).users}catch(y){console.error("Error fetching users:",y)}},x=async k=>{try{I.value=(await U.get("/teams/available",{query:{q:k},issue_id:n.issue.id})).teams}catch(y){console.error("Error fetching teams:",y)}};return ne(async()=>{n.issue.id&&(await V(),await x())}),ee(l,k=>{k?a.value==="user"?V():x():b()}),ee(a,k=>{k==="user"?V():x(),b()}),(k,y)=>(r(),d("div",Kt,[e("div",Jt,[y[6]||(y[6]=e("h3",{class:"text-sm font-medium text-gray-900"},"Назначенные",-1)),e("button",{onClick:y[0]||(y[0]=w=>l.value=!0),class:"text-sm text-indigo-600 hover:text-indigo-900 cursor-pointer"}," Добавить ")]),e("div",Qt,[k.assignees.users.length>0?(r(),d("div",Xt,[y[7]||(y[7]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Пользователи",-1)),e("ul",Gt,[(r(!0),d(T,null,A(k.assignees.users,w=>(r(),d("li",{key:`user-${w.id}`,class:"flex items-center justify-between"},[e("div",Wt,[p(u(re),{class:"mr-3",size:"sm",name:w.name},null,8,["name"]),e("span",Zt,h(w.name),1)]),e("button",{onClick:F=>u(n).removeAssignee(u(n).issue.id,"user",w.id),class:"text-gray-400 hover:text-gray-500"},[p(u(C),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,es)]))),128))])])):_("",!0),k.assignees.teams.length>0?(r(),d("div",ts,[y[8]||(y[8]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Команды",-1)),e("ul",ss,[(r(!0),d(T,null,A(k.assignees.teams,w=>(r(),d("li",{key:`team-${w.id}`,class:"flex items-center justify-between"},[e("div",ns,[e("span",as,[p(u(C),{icon:"mdi:account-group",class:"h-5 w-5 text-gray-600"})]),e("span",os,h(w.name),1)]),e("button",{onClick:F=>u(n).removeAssignee(u(n).issue.id,"team",w.id),class:"text-gray-400 hover:text-gray-500"},[p(u(C),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,is)]))),128))])])):_("",!0),k.assignees.users.length===0&&k.assignees.teams.length===0?(r(),d("p",rs,[p(u(Se),{title:"Назначенные отсутствуют",description:"Добавьте ответственных за эту задачу",icon:"heroicons:user-group"})])):_("",!0)]),p(u(we),{"is-open":l.value,onClose:y[5]||(y[5]=w=>l.value=!1)},{title:R(()=>y[9]||(y[9]=[B("Добавить ответственного")])),content:R(()=>[e("div",ls,[y[12]||(y[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Тип",-1)),p(u(Z),{options:[{value:"user",label:"Пользователь"},{value:"team",label:"Команда"}],"option-label":"label","option-value":"value",modelValue:a.value,"onUpdate:modelValue":y[1]||(y[1]=w=>a.value=w)},null,8,["modelValue"]),a.value==="user"?(r(),d("div",us,[y[10]||(y[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выбрать пользователей",-1)),p(u(Z),{onSearch:V,options:v.value,"option-label":"name","option-value":"id",modelValue:i.value,"onUpdate:modelValue":y[2]||(y[2]=w=>i.value=w),multiple:"",searchable:"",placeholder:"Выберите пользователей"},null,8,["options","modelValue"])])):(r(),d("div",ds,[y[11]||(y[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выберите команды",-1)),p(u(Z),{onSearch:x,options:I.value,"option-label":"name","option-value":"id",modelValue:t.value,"onUpdate:modelValue":y[3]||(y[3]=w=>t.value=w),multiple:"",searchable:"",placeholder:"Выберите команды"},null,8,["options","modelValue"])]))])]),footer:R(()=>[e("div",cs,[p(u(se),{variant:"secondary",onClick:y[4]||(y[4]=w=>l.value=!1)},{default:R(()=>y[13]||(y[13]=[B(" Отмена ")])),_:1}),p(u(se),{onClick:g},{default:R(()=>y[14]||(y[14]=[B(" Добавить ")])),_:1})])]),_:1},8,["is-open"])]))}}),gs={class:"bg-white shadow rounded-lg p-4 mt-4"},ps={class:"space-y-3"},vs={class:"flex justify-between"},ys={class:"text-sm text-gray-900"},fs={class:"flex justify-between"},hs={class:"text-sm text-gray-900"},xs={class:"flex justify-between"},bs={class:"text-sm text-gray-900"},_s={class:"flex justify-between"},ws={class:"text-sm text-gray-900"},$s={class:"flex justify-between"},ks={class:"text-sm text-gray-900 text-right font-mono"},Ds={class:"flex justify-between"},Cs={class:"flex justify-between"},Ss=S({__name:"IssueMeta",props:{issue:{}},setup(f){const c=L(()=>{var l,a;const n=(l=f.issue)==null?void 0:l.event.type.split("\\");return n.length>1?n[n.length-1]:(a=f.issue)==null?void 0:a.event.type});return(n,l)=>{var a,i,t;return r(),d("div",gs,[l[7]||(l[7]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Все метаданные",-1)),e("div",ps,[e("div",vs,[l[0]||(l[0]=e("span",{class:"text-xs font-medium text-gray-500"},"Создана",-1)),e("span",ys,h(u(me)((a=n.issue)==null?void 0:a.created_at)),1)]),e("div",fs,[l[1]||(l[1]=e("span",{class:"text-xs font-medium text-gray-500"},"Обновлена",-1)),e("span",hs,h(u(me)((i=n.issue)==null?void 0:i.updated_at)),1)]),e("div",xs,[l[2]||(l[2]=e("span",{class:"text-xs font-medium text-gray-500"},"Среда",-1)),e("span",bs,h((t=n.issue.event)==null?void 0:t.environment),1)]),e("div",_s,[l[3]||(l[3]=e("span",{class:"text-xs font-medium text-gray-500"},"Релиз",-1)),e("span",ws,h(n.issue.event.release||"Not specified"),1)]),e("div",$s,[l[4]||(l[4]=e("span",{class:"text-xs font-medium text-gray-500"},"Айди события",-1)),e("span",ks,h(n.issue.event.event_id),1)]),e("div",Ds,[l[5]||(l[5]=e("span",{class:"text-xs font-medium text-gray-500"},"Тип события",-1)),p(Y,{variant:"default"},{default:R(()=>[B(h(c.value),1)]),_:1})]),e("div",Cs,[l[6]||(l[6]=e("span",{class:"text-xs font-medium text-gray-500"},"Уровень события",-1)),n.issue.event.level==="error"?(r(),z(Y,{key:0,variant:"danger",text:n.issue.event.level},null,8,["text"])):_("",!0),n.issue.event.level==="warning"?(r(),z(Y,{key:1,variant:"warning",text:n.issue.event.level},null,8,["text"])):_("",!0),n.issue.event.level==="info"?(r(),z(Y,{key:2,variant:"info",text:n.issue.event.level},null,8,["text"])):_("",!0),n.issue.event.level==="debug"?(r(),z(Y,{key:3,variant:"info",text:n.issue.event.level},null,8,["text"])):_("",!0)])])])}}}),Is={class:"space-y-2"},Ms={key:0,class:"space-y-2"},Ts={key:0,class:"flex items-start space-x-2"},Vs={class:"text-gray-500 capitalize"},Ls={class:"text-sm font-medium"},As={key:1,class:"flex items-center space-x-2"},Fs={key:2,class:"flex items-center space-x-2"},Us={class:"text-sm text-gray-600"},Rs={key:0,class:"flex items-start space-x-2"},js={class:"text-gray-500 capitalize"},Es={class:"flex-1"},Ps={class:"flex items-center space-x-2"},zs={class:"text-sm text-gray-600 line-through"},Bs={class:"text-sm font-medium"},Ns=S({__name:"IssueActivityChanges",props:{activity:{}},setup(f){const c=["updated_at","created_at"],n=g=>!c.includes(g),l=g=>({title:"Название",priority:"Приоритет",culprit:"Виновник",due_date:"Дедлайн",status:"Статус"})[g]||g,a=(g,b)=>b==null?"Не установлено":g==="due_date"?v(b):b,i=g=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[g]||g,t=g=>({open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",closed:"bg-purple-100 text-purple-800"})[g]||"bg-gray-100 text-gray-800",v=g=>g?new Date(g).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):null,I=g=>g?new Date(g)<new Date:!1;return(g,b)=>(r(),d("div",Is,[g.activity.type==="created_issue"?(r(),d("div",Ms,[(r(!0),d(T,null,A(g.activity.changes.after,(V,x)=>(r(),d("div",{key:x,class:"space-y-1"},[n(x)?(r(),d("div",Ts,[e("span",Vs,h(l(x))+":",1),e("span",Ls,h(a(x,V)),1)])):_("",!0)]))),128))])):g.activity.type==="status_changed"?(r(),d("div",As,[b[0]||(b[0]=e("span",{class:"text-gray-500"},"Статус:",-1)),g.activity.changes.before?(r(),d(T,{key:0},[e("span",{class:j(["px-2 py-0.5 rounded text-xs line-through",t(g.activity.changes.before.status)])},h(i(g.activity.changes.before.status)),3),p(u(C),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):_("",!0),e("span",{class:j(["px-2 py-0.5 rounded text-xs",t(g.activity.changes.after.status)])},h(i(g.activity.changes.after.status)),3)])):g.activity.type==="due_date_changed"?(r(),d("div",Fs,[b[1]||(b[1]=e("span",{class:"text-gray-500"},"Дедлайн:",-1)),g.activity.changes.before?(r(),d(T,{key:0},[e("span",Us,h(v(g.activity.changes.before.due_date)||"Не установлен"),1),p(u(C),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):_("",!0),e("span",{class:j(["text-sm font-medium",{"text-red-600":I(g.activity.changes.after.due_date)}])},h(v(g.activity.changes.after.due_date)||"Не установлен"),3)])):(r(!0),d(T,{key:3},A(g.activity.changes.after,(V,x)=>(r(),d("div",{key:x,class:"space-y-1"},[n(x)&&(!g.activity.changes.before||g.activity.changes.before[x]!==V)?(r(),d("div",Rs,[e("span",js,h(l(x))+":",1),e("div",Es,[e("div",Ps,[g.activity.changes.before?(r(),d(T,{key:0},[e("span",zs,h(a(x,g.activity.changes.before[x])),1),p(u(C),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):_("",!0),e("span",Bs,h(a(x,V)),1)])])])):_("",!0)]))),128))]))}}),Ys=ve(Ns,[["__scopeId","data-v-e15e07a4"]]),Hs={class:"bg-white shadow rounded-lg overflow-hidden"},Os={class:"space-y-4 px-4 py-5"},qs={class:"flex-shrink-0"},Ks={class:"flex-1 min-w-0"},Js={class:"flex items-center space-x-2 text-sm"},Qs={class:"font-medium text-gray-900"},Xs={class:"text-gray-500"},Gs={class:"mt-1 text-sm"},Ws={key:0,class:"text-center py-4 text-gray-500"},Zs=S({__name:"IssueActivityFeed",props:{activities:{}},setup(f){const c={created_issue:"bg-green-100 text-green-800",updated_issue:"bg-blue-100 text-blue-800",status_changed:"bg-purple-100 text-purple-800",due_date_changed:"bg-yellow-100 text-yellow-800",comment_added:"bg-indigo-100 text-indigo-800"},n=a=>({created_issue:"Создана",updated_issue:"Обновлена",status_changed:"Статус изменён",due_date_changed:"Дедлайн изменён",comment_added:"Комментарий добавлен"})[a]||a,l=a=>new Date(a).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(a,i)=>(r(),d("div",Hs,[i[1]||(i[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"История изменений")],-1)),e("div",Os,[(r(!0),d(T,null,A(a.activities,t=>(r(),d("div",{key:t.id,class:"flex items-start space-x-3"},[e("div",qs,[p(u(re),{name:t.user.name,size:"sm"},null,8,["name"])]),e("div",Ks,[e("div",Js,[e("span",Qs,h(t.user.name),1),e("span",Xs,h(l(t.created_at)),1),i[0]||(i[0]=e("span",{class:"text-gray-400"},"•",-1)),e("span",{class:j(["text-xs px-2 py-0.5 rounded-full",c[t.type]||"bg-gray-100 text-gray-800"])},h(n(t.type)),3)]),e("div",Gs,[p(Ys,{activity:t},null,8,["activity"])])])]))),128)),a.activities.length?_("",!0):(r(),d("div",Ws," Нет записей об изменениях "))])]))}}),en={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},tn={key:0,class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},sn={class:"lg:col-span-2 space-y-6"},nn={class:"lg:col-span-1"},_n=S({__name:"Show",props:{id:{}},setup(f){const c=ae(),n=$("comments"),l=a=>{n.value=a};return ne(async()=>{await c.fetchIssue(f.id)}),(a,i)=>(r(),z($e,null,{default:R(()=>{var t,v;return[e("div",en,[p(vt,{issue:u(c).issue},null,8,["issue"]),(t=u(c).issue)!=null&&t.id?(r(),d("div",tn,[e("div",sn,[p(wt,{event:u(c).issue.event},null,8,["event"]),p(qt,{"active-tab":n.value,onTabChange:l},null,8,["active-tab"]),n.value==="comments"?(r(),z(Rt,{key:0,"issue-id":u(c).issue.id,comments:(v=u(c).issue)==null?void 0:v.comments,onCommentAdded:i[0]||(i[0]=I=>u(c).fetchIssue(u(c).issue.id))},null,8,["issue-id","comments"])):n.value==="activities"?(r(),z(Zs,{key:1,activities:u(c).issue.activities},null,8,["activities"])):_("",!0)]),e("div",nn,[p(zt,{issue:u(c).issue},null,8,["issue"]),p(ms,{assignees:u(c).issue.assignees},null,8,["assignees"]),p(Ss,{issue:u(c).issue},null,8,["issue"])])])):_("",!0)])]}),_:1}))}});export{_n as default};
