import{i as V,d as B,k as b,c as M,m as z,g as D,B as I,C as N,a as u,o as l,v as T,l as w,w as v,b as e,e as n,h as y,f as i,s as A,F as S,n as $,t as _,q as F,p as L}from"./index-B52tdAFx.js";import"./index-Cx72w7ih.js";import{i as H,g as C}from"./install-w9194OeT.js";import{_ as R}from"./EmptyState.vue_vue_type_script_setup_true_lang-C3kzaHip.js";import{I as h}from"./iconify-CsbjDS1d.js";import{_ as O}from"./Button.vue_vue_type_script_setup_true_lang-DRgtyZdA.js";import"./index-BCqgpTI_.js";import{a as E}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BHQCpG9L.js";import{u as P}from"./projects-DY7Of87O.js";import"./index-C2dpklE6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q=async()=>V.get("/projects/stats/day"),U=B({__name:"EventsChart",props:{data:{},slug:{}},setup(k){const p=D(),m=k,r=b(null),c=b(null),t=M(()=>{const x=new Date().getHours(),g=[];for(let a=-4;a<=4;a++){const o=(x+a+24)%24;g.push({hour:`${o.toString().padStart(2,"0")}:00`,count:0})}return g.map(a=>{const o=m.data.find(f=>f.hour===a.hour);return o?{...a,count:o.count}:a})});z(()=>{if(r.value){const s=H(r.value);d(s),s.on("click","series",()=>{p.push(`/projects/${m.slug}/events`)}),c.value=new ResizeObserver(()=>{s.resize()}),c.value.observe(r.value)}}),I(()=>{if(r.value){const s=C(r.value);s&&(s.off("click"),s.dispose()),c.value&&(c.value.disconnect(),c.value=null)}}),N(()=>m.data,()=>{if(r.value){const s=C(r.value);s&&d(s)}});function d(s){const x=Math.max(...m.data.map(o=>o.count)),g=Math.ceil(x*1.2),a={grid:{top:10,right:10,bottom:20,left:40},xAxis:{type:"category",data:t.value.map(o=>o.hour),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{fontSize:10,color:"#6b7280"}},yAxis:{type:"value",max:g,splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{fontSize:10,color:"#6b7280"},min:0},series:[{data:t.value.map(o=>o.count),type:"bar",barWidth:"80%",itemStyle:{color:"#818cf8"},emphasis:{itemStyle:{color:"#4f46e5"}}}],tooltip:{trigger:"axis",formatter:o=>{const f=o[0];return`${f.axisValue}: ${f.value} событий`}}};s.setOption(a)}return(s,x)=>(l(),u("div",{ref_key:"chartRef",ref:r,class:"w-full h-full"},null,512))}}),W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},G={class:"flex justify-between items-center mb-6"},J={class:"bg-white shadow rounded-lg overflow-hidden"},K={key:0,class:"divide-y divide-gray-200"},Q={key:2,class:"divide-y divide-gray-200"},X={class:"flex flex-col space-y-4"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center space-x-4"},j={class:"flex-shrink-0 h-10 w-10 rounded-md bg-indigo-100 flex items-center justify-center"},ss={class:"text-sm text-gray-500 mt-1"},es={class:"flex items-center space-x-4"},ts={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},os={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},as={class:"flex items-center space-x-3"},ns={class:"p-2 rounded-lg bg-indigo-50 text-indigo-600"},is={class:"text-xl font-bold text-gray-900"},rs={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},ls={class:"flex items-center space-x-3"},ds={class:"p-2 rounded-lg bg-red-50 text-red-600"},cs={class:"text-xl font-bold text-gray-900"},us={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},ms={class:"flex items-center space-x-3"},xs={class:"p-2 rounded-lg bg-purple-50 text-purple-600"},gs={class:"text-xl font-bold text-gray-900"},fs={class:"flex justify-center mb-2"},hs={key:0,class:"h-42"},Rs=B({__name:"Index",setup(k){const p=b([]),{isLoading:m}=T(P()),r=c=>{var d;const t=(d=c.stats)==null?void 0:d.avg_response_time;return t?t<200?"good":"warning":"undefined"};return z(async()=>{p.value=await q()}),(c,t)=>{const d=A("RouterLink");return l(),w(E,null,{default:v(()=>[e("div",W,[e("div",G,[t[1]||(t[1]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Проекты",-1)),n(d,{to:"/projects/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:v(()=>[n(i(h),{icon:"heroicons:plus",class:"-ml-1 mr-2 h-5 w-5"}),t[0]||(t[0]=y(" Создать проект "))]),_:1})]),e("div",J,[i(m)?(l(),u("div",K,[(l(),u(S,null,$(5,s=>e("div",{key:`project-skeleton-${s}`,class:"px-4 py-4 sm:px-6"},t[2]||(t[2]=[e("div",{class:"flex items-center justify-between animate-pulse"},[e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200"}),e("div",{class:"space-y-2"},[e("div",{class:"h-4 bg-gray-200 rounded w-32"}),e("div",{class:"h-3 bg-gray-100 rounded w-24"})])]),e("div",{class:"h-5 w-5 bg-gray-200 rounded"})],-1)]))),64))])):!p.value.length&&!i(m)?(l(),w(i(R),{key:1,title:"Нет проектов",icon:"heroicons:folder",description:"Создайте свой первый проект."})):(l(),u("div",Q,[(l(!0),u(S,null,$(p.value,s=>{var x,g,a,o,f;return l(),u("div",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",X,[e("div",Y,[e("div",Z,[e("div",j,[n(i(h),{icon:"heroicons:folder",class:"h-6 w-6 text-indigo-600"})]),e("div",null,[n(d,{to:`/projects/${s.slug}`,class:"text-sm font-medium text-indigo-600 hover:text-indigo-900"},{default:v(()=>[y(_(s.name),1)]),_:2},1032,["to"]),e("p",ss,_(s.platform),1)])]),e("div",es,[n(d,{to:`projects/${s.slug}/settings/general`,class:"text-gray-400 hover:text-gray-500"},{default:v(()=>[n(i(h),{icon:"heroicons:cog-6-tooth",class:"h-5 w-5"})]),_:2},1032,["to"])])]),e("div",ts,[e("div",os,[e("div",as,[e("div",ns,[n(i(h),{icon:"heroicons:chart-bar",class:"h-5 w-5"})]),e("div",null,[t[3]||(t[3]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Всего событий ",-1)),e("p",is,_((x=s==null?void 0:s.stats)==null?void 0:x.total_events.toLocaleString()),1)])])]),e("div",rs,[e("div",ls,[e("div",ds,[n(i(h),{icon:"heroicons:exclamation-triangle",class:"h-5 w-5"})]),e("div",null,[t[4]||(t[4]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ошибки (24ч) ",-1)),e("p",cs,[y(_((g=s==null?void 0:s.stats)==null?void 0:g.errors_last_day.toLocaleString())+" ",1),s.stats!==void 0?(l(),u("span",{key:0,class:L(["text-xs font-normal ml-1",((a=s==null?void 0:s.stats)==null?void 0:a.errors_last_day)>0?"text-red-500":"text-green-500"])},_(Math.abs(s.stats.error_rate_change))+"% ",3)):F("",!0)])])])]),e("div",us,[e("div",ms,[e("div",xs,[n(i(h),{icon:"heroicons:clock",class:"h-5 w-5"})]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Время ответа ",-1)),e("p",gs,[y(_((o=s.stats)==null?void 0:o.avg_response_time.toFixed(2))+"ms ",1),e("span",{class:L(["text-xs font-normal ml-1",r(s)==="good"?"text-green-500":"text-yellow-500"])},[n(i(h),{icon:r(s)==="good"?"heroicons:check-badge":"heroicons:exclamation-circle",class:"h-3 w-3 inline"},null,8,["icon"])],2)])])])])]),e("div",fs,[n(i(O),{to:`projects/${s.slug}/events`},{default:v(()=>t[6]||(t[6]=[y(" Посмотреть все события ")])),_:2},1032,["to"])]),(f=s.events_last_day)!=null&&f.length?(l(),u("div",hs,[n(U,{data:s.events_last_day,slug:s.slug},null,8,["data","slug"])])):(l(),w(i(R),{key:1,title:"События отсутствуют",icon:"heroicons:arrow-trending-up",description:"Пока что никаких событий не поступало..."}))])])}),128))]))])])]),_:1})}}});export{Rs as default};
