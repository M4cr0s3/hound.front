import{d as G,k as n,m as H,l as K,w as l,o as m,b as s,e as o,f as a,j as R,h as f,a as _,F as A,n as J,t as p,K as V}from"./index-B605mWSS.js";import{a as P,T as g,M as W}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BKjXbmz5.js";import{_ as w}from"./Button.vue_vue_type_script_setup_true_lang-BvWJDmF7.js";import"./StacktraceViewer.vue_vue_type_style_index_0_scoped_8568d111_lang-OogGfIpQ.js";import{I as d}from"./iconify-e9sR0ZFq.js";import{_ as D}from"./InputField.vue_vue_type_script_setup_true_lang-DBN7DNb5.js";import{_ as X}from"./SelectField.vue_vue_type_script_setup_true_lang-Dsjyj-fN.js";import{_ as Y}from"./EmptyState.vue_vue_type_script_setup_true_lang-6tWArOav.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-p83CCQy-.js";import"./projects-DhOs14FM.js";const ee={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8"},se={class:"flex items-center space-x-4"},te={class:"p-3 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl shadow-md"},ae={class:"space-y-6"},oe={class:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"},re={class:"space-y-5"},le={class:"pt-4 flex justify-end gap-x-3 border-t border-gray-100"},ie={class:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"},ne={class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white flex items-center justify-between"},de={class:"divide-y divide-gray-100"},ce={key:0,class:"p-6"},ue={class:"space-y-4"},me={class:"flex items-center space-x-4"},pe={class:"relative"},ve={class:"h-10 w-10 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center text-white font-medium shadow-sm"},fe={class:"text-base font-medium text-gray-900"},ge={class:"text-sm text-gray-500"},xe=["onClick"],ye={class:"flex items-center space-x-2"},he={class:"flex items-center space-x-3"},be={class:"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-medium"},_e={class:"text-sm font-medium text-gray-900"},we={class:"text-xs text-gray-500"},ke={class:"flex justify-end gap-3"},Ue=G({__name:"Edit",props:{slug:{}},setup(O){const i=n({}),c=n({name:"",slug:""}),x=n({}),k=n(!1),C=n([]),y=n(!1),h=n(!1),M=n({}),u=n([]),S=n(""),U=async()=>{try{const t=await g.get(O.slug);i.value=t,c.value={name:t.name,slug:t.slug}}catch(t){console.error("Ошибка загрузки команды:",t)}},$=async()=>{try{C.value=(await g.getAvailableUsers(i.value.id,S.value)).users}catch(t){console.error("Ошибка загрузки пользователей:",t)}},I=async()=>{var t;k.value=!0,x.value={};try{await g.update(i.value.id,c.value),await U(),V.success("Команда успешно обновлена")}catch(e){(t=e==null?void 0:e.data)!=null&&t.errors&&(x.value=e.data.errors),console.error("Ошибка обновления команды:",e)}finally{k.value=!1}},Q=async t=>{S.value=t;try{C.value=(await g.getAvailableUsers(i.value.id,t)).users}catch(e){console.error("Ошибка поиска пользователей:",e)}},q=()=>{i.value&&(c.value={name:i.value.name,slug:i.value.slug}),x.value={}},B=async()=>{var t,e;if(u.value.length!==0){h.value=!0,M.value={};try{await g.addMembers(i.value.id,{user_ids:u.value}),await U(),u.value=[],await $(),y.value=!1,V.success("Участник(и) успешно добавлены")}catch(v){(e=(t=v.response)==null?void 0:t.data)!=null&&e.errors&&(M.value=v.response.data.errors),console.error("Ошибка добавления участников:",v)}finally{h.value=!1}}},z=async t=>{try{await g.removeMember(i.value.id,t),await U(),await $(),V.success("Участник успешно удален")}catch{V.error("Ошибка при удалении участника")}},E=t=>t.split(" ").map(e=>e[0]).join("").toUpperCase();return H(async()=>{await U(),await $()}),(t,e)=>(m(),K(P,null,{default:l(()=>{var v,T,F,L,N;return[s("div",ee,[s("div",se,[s("div",te,[o(a(d),{icon:"heroicons:user-group",class:"h-8 w-8 text-white"})]),e[6]||(e[6]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900"},"Редактирование команды"),s("p",{class:"text-sm text-gray-500"},"Обновите информацию о команде и управляйте участниками")],-1))]),s("div",ae,[s("div",oe,[e[9]||(e[9]=s("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[s("h2",{class:"text-lg font-semibold text-gray-900"},"Основные настройки")],-1)),s("form",{onSubmit:R(I,["prevent"]),class:"p-6 space-y-6"},[s("div",re,[o(a(D),{id:"name",label:"Название команды",modelValue:c.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>c.value.name=r),error:(v=x.value)==null?void 0:v.name,required:"",placeholder:"Введите название команды"},{icon:l(()=>[o(a(d),{icon:"heroicons:tag",class:"h-5 w-5 text-gray-400"})]),_:1},8,["modelValue","error"]),o(a(D),{id:"slug",label:"URL-идентификатор",modelValue:c.value.slug,"onUpdate:modelValue":e[1]||(e[1]=r=>c.value.slug=r),error:(T=x.value)==null?void 0:T.slug,description:"Уникальный идентификатор команды в URL. Можно оставить пустым для автоматической генерации.",placeholder:"team-identifier"},{icon:l(()=>[o(a(d),{icon:"heroicons:link",class:"h-5 w-5 text-gray-400"})]),_:1},8,["modelValue","error"])]),s("div",le,[o(a(w),{variant:"secondary",onClick:q,class:"px-4 py-2"},{default:l(()=>[o(a(d),{icon:"heroicons:arrow-path",class:"mr-2 h-4 w-4"}),e[7]||(e[7]=f(" Сбросить "))]),_:1}),o(a(w),{onClick:I,"is-loading":k.value,"loading-text":"Сохранение...",disabled:k.value,class:"px-4 py-2"},{default:l(()=>[o(a(d),{icon:"heroicons:check",class:"mr-2 h-4 w-4"}),e[8]||(e[8]=f(" Сохранить изменения "))]),_:1},8,["is-loading","disabled"])])],32)]),s("div",ie,[s("div",ne,[e[11]||(e[11]=s("div",null,[s("h2",{class:"text-lg font-semibold text-gray-900"},"Участники команды"),s("p",{class:"text-sm text-gray-500 mt-1"},"Управляйте составом вашей команды")],-1)),o(a(w),{onClick:e[2]||(e[2]=r=>y.value=!0),variant:"outline",class:"text-sm px-4 py-2"},{default:l(()=>[o(a(d),{icon:"heroicons:plus",class:"mr-2 h-4 w-4"}),e[10]||(e[10]=f(" Добавить участника "))]),_:1})]),s("div",de,[(L=(F=i.value)==null?void 0:F.members)!=null&&L.length?(m(),_("div",ce,[s("ul",ue,[(m(!0),_(A,null,J((N=i.value)==null?void 0:N.members,r=>(m(),_("li",{key:r.id,class:"group flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors duration-150"},[s("div",me,[s("div",pe,[s("div",ve,p(E(r.name)),1)]),s("div",null,[s("p",fe,p(r.name),1),s("p",ge,p(r.email),1)])]),s("button",{onClick:j=>z(r.id),class:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity duration-150 p-1 rounded-full hover:bg-red-50"},[o(a(d),{icon:"heroicons:trash",class:"h-5 w-5 cursor-pointer"})],8,xe)]))),128))])])):(m(),K(a(Y),{key:1,title:"Нет участников",icon:"heroicons:user-group",description:"Добавьте участников в команду, чтобы начать совместную работу.",class:"p-8 text-center"}))])])]),o(a(W),{"is-open":y.value,onClose:e[5]||(e[5]=r=>y.value=!1)},{title:l(()=>[s("div",ye,[o(a(d),{icon:"heroicons:user-plus",class:"h-6 w-6 text-indigo-600"}),e[12]||(e[12]=s("span",null,"Добавить участника",-1))])]),content:l(()=>{var r,j;return[s("form",{onSubmit:R(B,["prevent"]),class:"space-y-6"},[o(a(X),{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=b=>u.value=b),label:"Выберите участников",options:C.value,"option-label":"name","option-value":"id",error:(j=(r=M.value)==null?void 0:r.user_ids)==null?void 0:j[0],multiple:"",searchable:"","search-debounce":500,onSearch:Q,placeholder:"Выберите участников"},{option:l(({option:b})=>[s("div",he,[s("div",be,p(E(b.name)),1),s("div",null,[s("p",_e,p(b.name),1),s("p",we,p(b.email),1)])])]),_:1},8,["modelValue","options","error"])],32)]}),footer:l(()=>[s("div",ke,[o(a(w),{variant:"secondary",onClick:e[4]||(e[4]=r=>y.value=!1),class:"px-4 py-2"},{default:l(()=>e[13]||(e[13]=[f(" Отмена ")])),_:1}),o(a(w),{"is-loading":h.value,disabled:h.value||u.value.length===0,onClick:B,class:"px-4 py-2"},{default:l(()=>[h.value?(m(),_(A,{key:0},[o(a(d),{icon:"heroicons:arrow-path",class:"h-4 w-4 animate-spin mr-2"}),e[14]||(e[14]=f(" Добавление... "))],64)):(m(),_(A,{key:1},[o(a(d),{icon:"heroicons:plus",class:"h-4 w-4 mr-2"}),f(" Добавить выбранных ("+p(u.value.length)+") ",1)],64))]),_:1},8,["is-loading","disabled"])])]),_:1},8,["is-open"])])]}),_:1}))}}),Fe=Z(Ue,[["__scopeId","data-v-898d4ebc"]]);export{Fe as default};
