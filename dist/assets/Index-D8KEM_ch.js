import{d as B,k as S,c as M,m as V,g as I,C as N,x as T,a as u,o as d,v as A,l as w,w as p,b as s,e as r,h as v,f as n,s as D,F as $,n as L,t as h,q as F,p as R}from"./index-BCF3V4H9.js";import"./index-Djch6Zjh.js";import{i as H,g as C}from"./install-CjK4hi0Q.js";import{_ as z}from"./EmptyState.vue_vue_type_script_setup_true_lang-rc0N5t01.js";import{I as f}from"./iconify-B7i5wVmN.js";import{_ as O}from"./Button.vue_vue_type_script_setup_true_lang-DUH1P037.js";import"./StacktraceViewer.vue_vue_type_style_index_0_scoped_8568d111_lang-OogGfIpQ.js";import{a as E}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-C3vzuPhL.js";import{u as P}from"./projects-DGv742xl.js";import"./index-waWTbR4Y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W=B({__name:"EventsChart",props:{data:{},slug:{}},setup(b){const y=I(),m=b,l=S(null),c=S(null),_=M(()=>{const e=new Date().getHours(),x=[];for(let i=-4;i<=4;i++){const a=(e+i+24)%24;x.push({hour:`${a.toString().padStart(2,"0")}:00`,count:0})}return x.map(i=>{const a=m.data.find(g=>g.hour===i.hour);return a?{...i,count:a.count}:i})});V(()=>{if(l.value){const t=H(l.value);o(t),t.on("click","series",()=>{y.push(`/projects/${m.slug}/events`)}),c.value=new ResizeObserver(()=>{t.resize()}),c.value.observe(l.value)}}),N(()=>{if(l.value){const t=C(l.value);t&&(t.off("click"),t.dispose()),c.value&&(c.value.disconnect(),c.value=null)}}),T(()=>m.data,()=>{if(l.value){const t=C(l.value);t&&o(t)}});function o(t){const e=Math.max(...m.data.map(a=>a.count)),x=Math.ceil(e*1.2),i={grid:{top:10,right:10,bottom:20,left:40},xAxis:{type:"category",data:_.value.map(a=>a.hour),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{fontSize:10,color:"#6b7280"}},yAxis:{type:"value",max:x,splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{fontSize:10,color:"#6b7280"},min:0},series:[{data:_.value.map(a=>a.count),type:"bar",barWidth:"80%",itemStyle:{color:"#818cf8"},emphasis:{itemStyle:{color:"#4f46e5"}}}],tooltip:{trigger:"axis",formatter:a=>{const g=a[0];return`${g.axisValue}: ${g.value} событий`}}};t.setOption(i)}return(t,e)=>(d(),u("div",{ref_key:"chartRef",ref:l,class:"w-full h-full"},null,512))}}),q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},U={class:"flex justify-between items-center mb-6"},G={class:"bg-white shadow rounded-lg overflow-hidden"},J={key:0,class:"divide-y divide-gray-200"},K={key:2,class:"divide-y divide-gray-200"},Q={class:"flex flex-col space-y-4"},X={class:"flex items-center justify-between"},Y={class:"flex items-center space-x-4"},Z={class:"flex-shrink-0 h-10 w-10 rounded-md bg-indigo-100 flex items-center justify-center"},j={class:"text-sm text-gray-500 mt-1"},ss={class:"flex items-center space-x-4"},es={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ts={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},os={class:"flex items-center space-x-3"},as={class:"p-2 rounded-lg bg-indigo-50 text-indigo-600"},ns={class:"text-xl font-bold text-gray-900"},is={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},rs={class:"flex items-center space-x-3"},ls={class:"p-2 rounded-lg bg-red-50 text-red-600"},ds={class:"text-xl font-bold text-gray-900"},cs={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},us={class:"flex items-center space-x-3"},ms={class:"p-2 rounded-lg bg-purple-50 text-purple-600"},xs={class:"text-xl font-bold text-gray-900"},gs={class:"flex justify-center mb-2"},fs={key:0,class:"h-42"},Rs=B({__name:"Index",setup(b){const y=P(),{isLoading:m,projects:l}=A(y),c=_=>{var t;const o=(t=_.stats)==null?void 0:t.avg_response_time;return o?o<200?"good":"warning":"undefined"};return V(async()=>{await y.fetchProjectsWithStats()}),(_,o)=>{const t=D("RouterLink");return d(),w(E,null,{default:p(()=>[s("div",q,[s("div",U,[o[1]||(o[1]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Проекты",-1)),r(t,{to:"/projects/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:p(()=>[r(n(f),{icon:"heroicons:plus",class:"-ml-1 mr-2 h-5 w-5"}),o[0]||(o[0]=v(" Создать проект "))]),_:1})]),s("div",G,[n(m)?(d(),u("div",J,[(d(),u($,null,L(5,e=>s("div",{key:`project-skeleton-${e}`,class:"px-4 py-4 sm:px-6"},o[2]||(o[2]=[s("div",{class:"flex items-center justify-between animate-pulse"},[s("div",{class:"flex items-center space-x-4"},[s("div",{class:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200"}),s("div",{class:"space-y-2"},[s("div",{class:"h-4 bg-gray-200 rounded w-32"}),s("div",{class:"h-3 bg-gray-100 rounded w-24"})])]),s("div",{class:"h-5 w-5 bg-gray-200 rounded"})],-1)]))),64))])):!n(l).length&&!n(m)?(d(),w(n(z),{key:1,title:"Нет проектов",icon:"heroicons:folder",description:"Создайте свой первый проект."})):(d(),u("div",K,[(d(!0),u($,null,L(n(l),e=>{var x,i,a,g,k;return d(),u("div",{key:e.id,class:"px-4 py-4 sm:px-6"},[s("div",Q,[s("div",X,[s("div",Y,[s("div",Z,[r(n(f),{icon:"heroicons:folder",class:"h-6 w-6 text-indigo-600"})]),s("div",null,[r(t,{to:`/projects/${e.slug}`,class:"text-sm font-medium text-indigo-600 hover:text-indigo-900"},{default:p(()=>[v(h(e.name),1)]),_:2},1032,["to"]),s("p",j,h(e.platform),1)])]),s("div",ss,[r(t,{to:`projects/${e.slug}/settings/general`,class:"text-gray-400 hover:text-gray-500"},{default:p(()=>[r(n(f),{icon:"heroicons:cog-6-tooth",class:"h-5 w-5"})]),_:2},1032,["to"])])]),s("div",es,[s("div",ts,[s("div",os,[s("div",as,[r(n(f),{icon:"heroicons:chart-bar",class:"h-5 w-5"})]),s("div",null,[o[3]||(o[3]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Всего событий ",-1)),s("p",ns,h((x=e==null?void 0:e.stats)==null?void 0:x.total_events.toLocaleString()),1)])])]),s("div",is,[s("div",rs,[s("div",ls,[r(n(f),{icon:"heroicons:exclamation-triangle",class:"h-5 w-5"})]),s("div",null,[o[4]||(o[4]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ошибки (24ч) ",-1)),s("p",ds,[v(h((i=e==null?void 0:e.stats)==null?void 0:i.errors_last_day.toLocaleString())+" ",1),e.stats!==void 0?(d(),u("span",{key:0,class:R(["text-xs font-normal ml-1",((a=e==null?void 0:e.stats)==null?void 0:a.errors_last_day)>0?"text-red-500":"text-green-500"])},h(Math.abs(e.stats.error_rate_change))+"% ",3)):F("",!0)])])])]),s("div",cs,[s("div",us,[s("div",ms,[r(n(f),{icon:"heroicons:clock",class:"h-5 w-5"})]),s("div",null,[o[5]||(o[5]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Время ответа ",-1)),s("p",xs,[v(h((g=e.stats)==null?void 0:g.avg_response_time.toFixed(2))+"ms ",1),s("span",{class:R(["text-xs font-normal ml-1",c(e)==="good"?"text-green-500":"text-yellow-500"])},[r(n(f),{icon:c(e)==="good"?"heroicons:check-badge":"heroicons:exclamation-circle",class:"h-3 w-3 inline"},null,8,["icon"])],2)])])])])]),s("div",gs,[r(n(O),{to:`projects/${e.slug}/events`},{default:p(()=>o[6]||(o[6]=[v(" Посмотреть все события ")])),_:2},1032,["to"])]),(k=e.events_last_day)!=null&&k.length?(d(),u("div",fs,[r(W,{data:e.events_last_day,slug:e.slug},null,8,["data","slug"])])):(d(),w(n(z),{key:1,title:"События отсутствуют",icon:"heroicons:arrow-trending-up",description:"Пока что никаких событий не поступало..."}))])])}),128))]))])])]),_:1})}}});export{Rs as default};
