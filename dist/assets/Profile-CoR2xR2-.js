import{a as K,M as D}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-ByYDymtQ.js";import{I as C}from"./iconify-BqGZZF46.js";import{d as z,k as p,c as G,m as H,l as _,w as d,i as M,o as c,b as e,e as a,t as l,h as f,f as r,a as x,q as $,n as I,s as J,F as j,K as B}from"./index-aDw82BAL.js";import{R as O}from"./types-Cl0W0wgk.js";import{_ as h}from"./InputField.vue_vue_type_script_setup_true_lang-7Xi4tQX-.js";import{_ as P}from"./Button.vue_vue_type_script_setup_true_lang-CFb8t8J1.js";import"./index-BCqgpTI_.js";import{p as R,f as Q,b as W,o as X,s as y,m as Y,_ as Z}from"./TheForm.vue_vue_type_script_setup_true_lang-BawRq2Q_.js";import{_ as b}from"./Badge.vue_vue_type_script_setup_true_lang-DvJnhKVF.js";import{_ as U}from"./EmptyState.vue_vue_type_script_setup_true_lang-CuoVhcgr.js";import{S as k}from"./StatCard-CeepATbu.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DBtfm7ou.js";import"./projects-BQEszSKk.js";const se=R(X({current_password:y(),password:R(y(),Y(8)),password_confirmation:y()}),Q(W([["password"],["password_confirmation"]],g=>g.password===g.password_confirmation,"Пароли не совпадают"),["password_confirmation"])),te={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},oe={class:"flex flex-col sm:flex-row gap-8 mb-8"},ae={class:"flex-shrink-0"},re={class:"h-32 w-32 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white text-5xl font-bold shadow-lg"},ie={class:"flex-1"},ne={class:"flex justify-between items-start"},le={class:"text-2xl font-bold text-gray-900"},de={class:"text-gray-600 mt-1"},ce={class:"mt-2"},ue={class:"grid grid-cols-3 gap-4 mt-6"},pe={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8"},me={class:"divide-y divide-gray-100"},fe={class:"flex items-center space-x-4"},ve={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-medium"},_e={class:"text-sm font-medium text-gray-900"},ge={class:"text-sm text-gray-500"},we={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},xe={class:"divide-y divide-gray-100"},he={class:"flex items-start space-x-4"},ye={class:"flex-shrink-0 pt-1"},be={class:"flex-1 min-w-0"},ke={class:"text-sm font-medium text-gray-900 truncate"},Ve={class:"mt-1 flex items-center space-x-3"},Ce={class:"text-xs text-gray-500"},Me={class:"flex justify-end gap-3"},$e=z({__name:"Profile",setup(g){const i=p({name:"",email:"",role:"",teams:[],assignments:[]}),v=p({teams:0,open_issues:0,resolved_issues:0}),F=p(null),m=p(!1),w=p(!1),n=p({current_password:"",password:"",password_confirmation:""}),L=G(()=>i.value.name?i.value.name.charAt(0).toUpperCase():""),T=o=>o?o.charAt(0).toUpperCase():"",q=o=>({open:"primary",in_progress:"warning",resolved:"success",closed:"secondary"})[o]||"default",N=o=>({error:"danger",warning:"warning",info:"info"})[o]||"default",S=o=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[o]||o,A=async()=>{try{const o=await M.get("/users/profile");i.value=o.user,v.value=o.stats}catch(o){console.error("Error fetching profile:",o)}},E=async()=>{w.value=!0;try{await M.post("/users/profile/password",n.value),m.value=!1,n.value={current_password:"",new_password:"",new_password_confirmation:""},B.success("Пароль успешно обновлен")}catch(o){B.error("Ошибка обновления пароля",{description:o.data.message})}finally{w.value=!1}};return H(async()=>{await A()}),(o,t)=>{const V=J("RouterLink");return c(),_(K,null,{default:d(()=>[e("div",te,[e("div",oe,[e("div",ae,[e("div",re,l(L.value),1)]),e("div",ie,[e("div",ne,[e("div",null,[e("h1",le,l(i.value.name),1),e("p",de,l(i.value.email),1),e("div",ce,[a(r(b),{variant:i.value.role.title===r(O).Maintainer?"primary":"secondary"},{default:d(()=>{var s;return[f(l((s=i.value)==null?void 0:s.role.title),1)]}),_:1},8,["variant"])])]),e("button",{onClick:t[0]||(t[0]=s=>m.value=!0),class:"inline-flex items-center cursor-pointer px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"},[a(r(C),{icon:"heroicons:lock-closed",class:"mr-2 h-4 w-4"}),t[6]||(t[6]=f(" Сменить пароль "))])]),e("div",ue,[a(k,{title:"Команд",value:v.value.teams,icon:"heroicons:user-group",class:"bg-white"},null,8,["value"]),a(k,{title:"Активных задач",value:v.value.open_issues,icon:"heroicons:exclamation-triangle",variant:"warning",class:"bg-white"},null,8,["value"]),a(k,{title:"Решенных задач",value:v.value.resolved_issues,icon:"heroicons:check-badge",variant:"success",class:"bg-white"},null,8,["value"])])])]),e("div",pe,[t[7]||(t[7]=e("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Мои команды")],-1)),e("div",me,[(c(!0),x(j,null,I(i.value.teams,s=>(c(),_(V,{key:s.id,to:`/teams/${s.slug}`,class:"block p-5 hover:bg-gray-50 transition-colors duration-150"},{default:d(()=>[e("div",fe,[e("div",ve,l(T(s.name)),1),e("div",null,[e("p",_e,l(s.name),1),e("p",ge,l(s.members_count)+" участников",1)])])]),_:2},1032,["to"]))),128)),i.value.teams.length?$("",!0):(c(),_(r(U),{key:0,title:"Нет команд",icon:"heroicons:user-group",description:"Вы не состоите ни в одной команде",class:"p-8"}))])]),e("div",we,[t[8]||(t[8]=e("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Мои задачи")],-1)),e("div",xe,[(c(!0),x(j,null,I(i.value.assignments,s=>(c(),x("div",{key:s.id,class:"p-5 hover:bg-gray-50 transition-colors duration-150"},[e("div",he,[e("div",ye,[a(r(b),{variant:q(s.issue.status),text:S(s.issue.status)},null,8,["variant","text"])]),e("div",be,[e("p",ke,[f(l(s.issue.title)+" ",1),a(r(b),{variant:N(s.issue.event.level),text:s.issue.event.level},null,8,["variant","text"])]),e("div",Ve,[e("span",Ce," Проект: "+l(s.issue.project.name),1)])]),a(V,{to:`/issues/${s.issue.id}`,class:"text-gray-400 hover:text-gray-500"},{default:d(()=>[a(r(C),{icon:"heroicons:chevron-right",class:"h-5 w-5"})]),_:2},1032,["to"])])]))),128)),i.value.assignments.length?$("",!0):(c(),_(r(U),{key:0,title:"Нет задач",icon:"heroicons:check-badge",description:"Вам не назначено ни одной задачи",class:"p-8",small:""}))])])]),a(r(D),{"is-open":m.value,onClose:t[5]||(t[5]=s=>m.value=!1),title:"Смена пароля"},{content:d(()=>[a(r(Z),{class:"space-y-3",schema:r(se),data:n.value,submit:E,ref_key:"passwordFormRef",ref:F},{default:d(({errors:s})=>[a(r(h),{modelValue:n.value.current_password,"onUpdate:modelValue":t[1]||(t[1]=u=>n.value.current_password=u),label:"Текущий пароль",type:"password",required:"",icon:"heroicons:lock-closed",id:"current-password",placeholder:"Текущий пароль",error:s==null?void 0:s.current_password},null,8,["modelValue","error"]),a(r(h),{modelValue:n.value.password,"onUpdate:modelValue":t[2]||(t[2]=u=>n.value.password=u),label:"Новый пароль",type:"password",required:"",icon:"heroicons:key",id:"password",placeholder:"••••••••",error:s==null?void 0:s.password},null,8,["modelValue","error"]),a(r(h),{modelValue:n.value.password_confirmation,"onUpdate:modelValue":t[3]||(t[3]=u=>n.value.password_confirmation=u),label:"Подтверждение пароля",type:"password",required:"",icon:"heroicons:key",id:"password-confirmation",placeholder:"••••••••",error:s==null?void 0:s.password_confirmation},null,8,["modelValue","error"]),e("div",Me,[a(r(P),{variant:"secondary",onClick:t[4]||(t[4]=u=>m.value=!1)},{default:d(()=>t[9]||(t[9]=[f(" Отмена ")])),_:1}),a(r(P),{type:"submit","is-loading":w.value},{default:d(()=>t[10]||(t[10]=[f(" Сохранить ")])),_:1},8,["is-loading"])])]),_:1},8,["schema","data"])]),_:1},8,["is-open"])]),_:1})}}}),Ke=ee($e,[["__scopeId","data-v-ec095335"]]);export{Ke as default};
