import{i as L,d as M,c as A,a as m,o as l,p as E,t as h,l as R,f as u,k as C,m as ne,B as pe,C as ee,b as e,e as p,a4 as he,w as j,q as w,F as V,n as U,a5 as le,j as ue,a6 as ie,a7 as de,a8 as xe,h as B,a9 as te,aa as ce,g as be,R as _e,u as we,K as me}from"./index-uO5KFaZX.js";import{u as ae}from"./issues-hTxDDyzg.js";import{c as $e,_ as re,M as ke,a as De}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CyzJyrOO.js";import{I as K}from"./types-Cl0W0wgk.js";import{I as S}from"./iconify-DXTi0Chq.js";import{M as ve}from"./CommentForm.vue_vue_type_style_index_0_scoped_8b816cc4_lang-BVKzazvO.js";import{_ as se}from"./Button.vue_vue_type_script_setup_true_lang-2hyEh9Zz.js";import{S as Ce,_ as Se}from"./JsonViewer.vue_vue_type_script_setup_true_lang-CPdqzrNM.js";import{u as Ie}from"./index-B-oPVFUC.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Z}from"./SelectField.vue_vue_type_script_setup_true_lang-Cu-J8MDV.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-wmwZwCx6.js";import{_ as Me}from"./EmptyState.vue_vue_type_script_setup_true_lang-DYhmhjEG.js";import{f as ge}from"./index-BPW3n-1W.js";import"./projects-Bqc3S0N-.js";import"./platforms-D8ztvdxx.js";const Te={async get(y){return L.get(`/issues/${y}`)},async updateStatus(y,d){await L.patch(`/issues/${y}/status`,{status:d})},async updatePriority(y,d){await L.patch(`/issues/${y}/priority`,{priority:d})},async updateDueDate(y,d){await L.patch(`/issues/${y}/due-date`,{due_date:d})},async addAssignee(y,d,s){await L.post(`/issues/${y}/assignees`,{type:d,id:s})},async removeAssignee(y,d,s){await L.delete(`/issues/${y}/assignees`,{data:{type:d,id:s}})},async addComment(y,d){await L.post(`/issues/${y}/comments`,{text:d})}},Ve=M({__name:"StatusBadge",props:{status:{}},setup(y){const d=y,s=A(()=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[d.status]),r=A(()=>({closed:"bg-red-100 text-red-800",resolved:"bg-green-100 text-green-800",open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800"})[d.status]);return(n,i)=>(l(),m("span",{class:E(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.value])},h(s.value),3))}}),Le=M({__name:"PriorityBadge",props:{priority:{}},setup(y){const d=A(()=>({low:"Низкий",medium:"Средний",high:"Высокий",critical:"Критический"})[y.priority]),s=A(()=>({low:"bg-gray-100 text-gray-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"})[y.priority]);return(r,n)=>(l(),m("span",{class:E(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.value])},h(d.value),3))}}),Ae=M({__name:"PrioritySelect",props:{modelValue:{}},emits:["update:modelValue","change"],setup(y,{emit:d}){const s=d,r=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],n=i=>{s("update:modelValue",i),s("change",i)};return(i,o)=>(l(),R(u(Z),{options:r,"option-label":"label","option-value":"value",modelValue:i.modelValue,placeholder:"Выберите приоритет","onUpdate:modelValue":n},null,8,["modelValue"]))}}),Ue={class:"relative"},Fe={class:"flex items-center"},je=["value","placeholder"],Re={key:0,class:"absolute z-10 mt-1 w-auto bg-white rounded-md shadow-lg p-4 border border-gray-200 min-w-60"},Ee={class:"flex justify-between items-center mb-4"},Pe={class:"text-sm font-medium text-gray-900"},ze={class:"grid grid-cols-7 gap-1 mb-2"},Be={class:"grid grid-cols-7 gap-1"},Ne=["onClick"],Oe=M({__name:"DatePicker",props:{modelValue:{type:String,default:null},placeholder:{type:String,default:"Выберите дату"}},emits:["update:modelValue","change"],setup(y,{emit:d}){const s=y,r=d,n=C(!1),i=C(new Date),o=C(null);s.modelValue&&(o.value=new Date(s.modelValue));const f=t=>t?t.toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"",_=A(()=>f(o.value)),c=A(()=>i.value.getFullYear()),x=A(()=>i.value.getMonth()),I=A(()=>i.value.toLocaleString("default",{month:"long"})),b=A(()=>{const t=c.value,a=x.value,g=new Date(t,a,1),D=new Date(t,a+1,0),P=g.getDay(),J=6-D.getDay(),z=[],H=new Date(t,a,0).getDate();for(let T=P-1;T>=0;T--){const N=H-T;z.push({day:N,date:new Date(t,a-1,N),isCurrentMonth:!1,isToday:k(new Date(t,a-1,N)),isSelected:v(new Date(t,a-1,N))})}const fe=D.getDate();for(let T=1;T<=fe;T++){const N=new Date(t,a,T);z.push({day:T,date:N,isCurrentMonth:!0,isToday:k(N),isSelected:v(N)})}for(let T=1;T<=J;T++)z.push({day:T,date:new Date(t,a+1,T),isCurrentMonth:!1,isToday:k(new Date(t,a+1,T)),isSelected:v(new Date(t,a+1,T))});return z}),k=t=>{const a=new Date;return t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear()},v=t=>o.value?t.getDate()===o.value.getDate()&&t.getMonth()===o.value.getMonth()&&t.getFullYear()===o.value.getFullYear():!1,$=()=>{n.value=!n.value},F=()=>{i.value=new Date(c.value,x.value-1,1)},Q=()=>{i.value=new Date(c.value,x.value+1,1)},X=t=>{if(!t.isCurrentMonth)return;o.value=t.date,i.value=new Date(t.date);const a=G(t.date);r("update:modelValue",a),r("change",a),n.value=!1},oe=()=>{const t=new Date;t.setHours(0,0,0,0),o.value=t,i.value=new Date(t);const a=G(t);r("update:modelValue",a),r("change",a),n.value=!1},G=t=>{if(!t)return null;const a=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),D=String(t.getDate()).padStart(2,"0");return`${a}-${g}-${D}`},W=()=>{o.value=null,r("update:modelValue",null),n.value=!1},Y=t=>{t.target.closest(".relative")||(n.value=!1)},q=t=>{if(!t)return null;try{const a=new Date(t);return isNaN(a.getTime())?(console.error("Invalid date:",t),null):a}catch(a){return console.error("Error parsing date:",a),null}};return ne(()=>{s.modelValue&&(o.value=q(s.modelValue),o.value&&(i.value=new Date(o.value))),document.addEventListener("click",Y)}),pe(()=>{document.removeEventListener("click",Y)}),ee(()=>s.modelValue,t=>{const a=q(t);if(a){const g=new Date(a.getFullYear(),a.getMonth(),a.getDate()),D=o.value?new Date(o.value.getFullYear(),o.value.getMonth(),o.value.getDate()):null;(!D||g.getTime()!==D.getTime())&&(o.value=a,i.value=new Date(a))}else o.value=null},{immediate:!0}),(t,a)=>(l(),m("div",Ue,[e("div",Fe,[e("input",{type:"text",value:_.value,onClick:$,readonly:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:y.placeholder},null,8,je),e("button",{type:"button",onClick:$,class:"absolute right-0 px-3 py-2 text-gray-400 hover:text-gray-500"},[p(u(S),{icon:"mdi:calendar",class:"h-5 w-5"})])]),p(he,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:j(()=>[n.value?(l(),m("div",Re,[e("div",Ee,[e("button",{onClick:F,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[p(u(S),{icon:"mdi:chevron-left",class:"h-5 w-5"})]),e("span",Pe,h(I.value)+" "+h(c.value),1),e("button",{onClick:Q,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[p(u(S),{icon:"mdi:chevron-right",class:"h-5 w-5"})])]),e("div",ze,[(l(),m(V,null,U(["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],g=>e("div",{key:g,class:"text-xs text-center text-gray-500"},h(g),1)),64))]),e("div",Be,[(l(!0),m(V,null,U(b.value,g=>(l(),m("div",{key:g.date,onClick:D=>X(g),class:E(["text-center py-1 text-sm rounded-full",{"text-gray-400":!g.isCurrentMonth,"hover:bg-gray-100 cursor-pointer":g.isCurrentMonth,"bg-indigo-100 text-indigo-700 font-medium":g.isSelected,"bg-indigo-600 text-white font-medium":g.isToday&&g.isSelected}])},h(g.day),11,Ne))),128))]),e("div",{class:"mt-4 flex justify-between"},[e("button",{onClick:oe,type:"button",class:"text-xs text-indigo-600 cursor-pointer hover:text-indigo-900"}," Сегодня "),e("button",{onClick:W,type:"button",class:"text-xs text-gray-500 cursor-pointer hover:text-gray-700"}," Очистить ")])])):w("",!0)]),_:1})]))}}),Ye=["onKeydown"],He={class:"border-b border-gray-200"},Ke={class:"-mb-px flex space-x-8"},qe=["onClick"],Je={class:"relative"},Qe={class:"overflow-hidden rounded-lg shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-indigo-500 transition-all duration-200"},Xe={key:0,class:"absolute z-10 mt-1 w-64 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-gray-300 ring-opacity-5 focus:outline-none sm:text-sm"},Ge=["onClick"],We={class:"flex items-center"},Ze={class:"ml-3 block truncate text-gray-700 font-medium"},et={key:0,class:"px-4 py-2 text-gray-500 text-sm"},tt={class:"absolute inset-x-0 bottom-0 flex justify-between items-center py-2 pl-3 pr-2 bg-gray-50 border-t border-gray-200"},st={class:"flex items-center space-x-2"},nt={class:"prose prose-sm max-w-none p-4 rounded-lg border border-gray-200"},at=["innerHTML"],ot={key:1,class:"text-gray-400 italic"},it={class:"flex justify-end"},rt={key:0,class:"flex items-center"},lt={key:1,class:"flex items-center"},ut=M({__name:"CommentForm",props:{isLoading:{type:Boolean},initialValue:{}},emits:["submit"],setup(y,{emit:d}){const s=y,r=d,n=C("write"),i=C(s.initialValue||""),o=C(null),f=C(!1),_=C([]),c=C(0),x=C(""),I=C(-1),b=[{name:"write",label:"Редактор"},{name:"preview",label:"Превью"}],k=new ve({html:!0,linkify:!0,typographer:!0,highlight:function(t,a){if(a&&te.getLanguage(a))try{return te.highlight(t,{language:a}).value}catch{}return""}}),v=A(()=>i.value.trim()?k.render(i.value):null),$=()=>{i.value.trim()&&(r("submit",i.value.trim()),i.value="")},F=(t,a)=>{if(!o.value)return;const g=o.value.selectionStart,D=o.value.selectionEnd,P=i.value.substring(g,D),J=i.value.substring(0,g),z=i.value.substring(D);i.value=J+t+P+a+z,ce(()=>{if(!o.value)return;o.value.focus();const H=g+t.length;o.value.setSelectionRange(H,P?H+P.length:H)})},Q=()=>{const a=(b.findIndex(g=>g.name===n.value)-1+b.length)%b.length;n.value=b[a].name},X=()=>{const a=(b.findIndex(g=>g.name===n.value)+1)%b.length;n.value=b[a].name},oe=Ie(async t=>{try{_.value=await L.get(`/api/users/search?q=${t}`)}catch(a){console.error("Ошибка при поиске пользователей:",a),_.value=[]}},300),G=()=>{const t=o.value.selectionStart,a=i.value.substring(0,t),g=a.lastIndexOf("@");if(Math.abs(t-g)!==1)if(g>=0&&(g===0||/\s/.test(a[g-1]))){const D=a.substring(g+1);if(!D.trim()||/\s/.test(D))return;I.value=g,x.value=a.substring(g+1),f.value=!0,c.value=0,oe(x.value)}else f.value=!1},W=t=>{if(!o.value)return;const a=o.value,g=I.value,D=a.selectionStart,P=i.value.substring(0,g),J=i.value.substring(D);i.value=P+`@${t.name} `+J,f.value=!1,ce(()=>{a.focus();const z=g+t.name.length+2;a.setSelectionRange(z,z)})},Y=t=>{f.value&&(t.key==="ArrowDown"?(t.preventDefault(),c.value=Math.min(c.value+1,_.value.length-1)):t.key==="ArrowUp"?(t.preventDefault(),c.value=Math.max(c.value-1,0)):t.key==="Enter"?(t.preventDefault(),_.value[c.value]&&W(_.value[c.value])):t.key==="Escape"&&(t.preventDefault(),f.value=!1)),t.altKey&&(t.key==="ArrowLeft"?(t.preventDefault(),Q()):t.key==="ArrowRight"&&(t.preventDefault(),X()))},q=t=>{o.value&&!o.value.contains(t.target)&&(f.value=!1)};return ne(()=>{window.addEventListener("keydown",Y),document.addEventListener("click",q)}),pe(()=>{window.removeEventListener("keydown",Y),document.removeEventListener("click",q)}),ee(()=>s.initialValue,t=>{t&&(i.value=t)}),(t,a)=>(l(),m("div",{class:"space-y-4",onKeydown:[le(ue(Q,["alt","stop"]),["left"]),le(ue(X,["alt","stop"]),["right"])]},[e("div",He,[e("nav",Ke,[(l(),m(V,null,U(b,g=>e("button",{key:g.name,onClick:D=>n.value=g.name,class:E([n.value===g.name?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},h(g.label),11,qe)),64))])]),ie(e("div",Je,[e("div",Qe,[ie(e("textarea",{ref_key:"textareaRef",ref:o,id:"comment","onUpdate:modelValue":a[0]||(a[0]=g=>i.value=g),rows:"8",class:"block w-full focus:outline-none resize-none border-0 bg-transparent py-3 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6 font-mono",placeholder:"Напишите ваш комментарий (поддерживается Markdown)...",onKeydown:Y,onInput:G},null,544),[[xe,i.value]]),f.value?(l(),m("div",Xe,[(l(!0),m(V,null,U(_.value,(g,D)=>(l(),m("div",{key:g.id,onClick:P=>W(g),class:E(["relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-indigo-50",{"bg-indigo-100":c.value===D}])},[e("div",We,[e("span",Ze,h(g.name),1)])],10,Ge))),128)),_.value.length===0?(l(),m("div",et," Пользователи не найдены ")):w("",!0)])):w("",!0),e("div",tt,[e("div",st,[e("button",{type:"button",onClick:a[1]||(a[1]=g=>F("**","**")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Жирный текст"},[p(u(S),{icon:"mdi:format-bold",class:"h-5 w-5"})]),e("button",{type:"button",onClick:a[2]||(a[2]=g=>F("*","*")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Курсив"},[p(u(S),{icon:"mdi:format-italic",class:"h-5 w-5"})]),e("button",{type:"button",onClick:a[3]||(a[3]=g=>F("[","](url)")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Ссылка"},[p(u(S),{icon:"mdi:link-variant",class:"h-5 w-5"})]),e("button",{type:"button",onClick:a[4]||(a[4]=g=>F("```\n","\n```")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Блок кода"},[p(u(S),{icon:"mdi:code-tags",class:"h-5 w-5"})]),e("button",{type:"button",onClick:a[5]||(a[5]=g=>F("- ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Список"},[p(u(S),{icon:"mdi:format-list-bulleted",class:"h-5 w-5"})]),e("button",{type:"button",onClick:a[6]||(a[6]=g=>F("> ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Цитата"},[p(u(S),{icon:"mdi:format-quote-open",class:"h-5 w-5"})])]),a[7]||(a[7]=e("div",{class:"text-xs text-gray-500"}," Поддерживается Markdown. Ctrl+Enter для отправки ",-1))])])],512),[[de,n.value==="write"]]),ie(e("div",nt,[v.value?(l(),m("div",{key:0,innerHTML:v.value},null,8,at)):(l(),m("div",ot," Превью будет отображаться здесь... "))],512),[[de,n.value==="preview"]]),e("div",it,[p(u(se),{type:"button",onClick:$,disabled:t.isLoading||!i.value.trim()},{default:j(()=>[t.isLoading?(l(),m("span",rt,[p(u(S),{icon:"mdi:loading",class:"h-4 w-4 animate-spin mr-2"}),a[8]||(a[8]=B(" Отправка... "))])):(l(),m("span",lt,[p(u(S),{icon:"mdi:send",class:"h-4 w-4 mr-2"}),a[9]||(a[9]=B(" Отправить "))]))]),_:1},8,["disabled"])])],40,Ye))}}),dt=ye(ut,[["__scopeId","data-v-8b816cc4"]]),ct={class:"border-b border-gray-200 pb-4"},mt={class:"flex items-start justify-between"},gt={class:"text-2xl font-bold text-gray-900"},pt={class:"text-gray-500"},vt={class:"mt-2 flex items-center space-x-4"},yt={class:"flex space-x-3"},ft=M({__name:"IssueHeader",props:{issue:{}},setup(y){const d=y,s=be(),r=ae(),n=[{icon:"heroicons:lock-open",iconClass:"text-gray-700",key:"open",label:"Открыть",handler:async()=>{await r.updateIssueStatus(d.issue.id,K.Open)},visible:()=>d.issue.status!==K.Open},{icon:"heroicons:lock-closed",iconClass:"text-gray-700",key:"lock",label:"Закрыть",handler:async()=>{await r.updateIssueStatus(d.issue.id,K.Closed)},visible:()=>d.issue.status!==K.Closed},{icon:"heroicons:trash",iconClass:"text-red-500",key:"delete",label:"Удалить",handler:async()=>{await r.deleteIssue(d.issue.id),await s.push(_e.ISSUE.INDEX)}}];return(i,o)=>(l(),m("div",ct,[e("div",mt,[e("div",null,[e("h1",gt,[B(h(i.issue.title)+" ",1),e("span",pt,"#"+h(i.issue.id),1)]),e("div",vt,[p(u(Ve),{status:i.issue.status},null,8,["status"]),p(u(Le),{priority:i.issue.priority},null,8,["priority"])])]),e("div",yt,[i.issue.status!==u(K).Resolved?(l(),R(u(se),{key:0,variant:"secondary",onClick:o[0]||(o[0]=f=>u(r).updateIssueStatus(i.issue.id,u(K).Resolved))},{default:j(()=>o[1]||(o[1]=[B(" Решить ")])),_:1,__:[1]})):w("",!0),p(u($e),{actions:n})])])]))}}),ht={class:"bg-white shadow rounded-lg overflow-hidden"},xt={class:"px-4 py-5 sm:p-6"},bt={class:"mb-4"},_t={class:"text-sm text-gray-700"},wt={key:0,class:"mb-4"},$t={key:1,class:"mb-4"},kt=M({__name:"IssueDescription",props:{event:{}},setup(y){return(d,s)=>(l(),m("div",ht,[s[3]||(s[3]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Детали ошибки")],-1)),e("div",xt,[e("div",bt,[s[0]||(s[0]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Сообщение",-1)),e("p",_t,h(d.event.message),1)]),d.event.metadata.stacktrace?(l(),m("div",wt,[s[1]||(s[1]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Стектрейс",-1)),p(u(Ce),{stacktrace:d.event.metadata.stacktrace},null,8,["stacktrace"])])):w("",!0),d.event.metadata.context?(l(),m("div",$t,[s[2]||(s[2]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Контекст",-1)),p(u(Se),{data:d.event.metadata.context},null,8,["data"])])):w("",!0)])]))}}),Dt={class:"space-y-4 mb-2"},Ct={class:"flex space-x-3"},St={class:"flex-shrink-0"},It={class:"flex-1 min-w-0"},Mt={class:"flex items-center justify-between"},Tt={class:"flex items-center space-x-2 text-sm"},Vt={class:"font-medium text-gray-900"},Lt={class:"text-gray-500"},At={class:"mt-1 flex items-center text-sm text-gray-700"},Ut={class:"text-gray-500"},Ft=["innerHTML"],jt=M({__name:"IssueComments",props:{comments:{},showParentReferences:{type:Boolean,default:!1}},emits:["submit-reply","deleted"],setup(y,{emit:d}){const s=d,r=we(),n=new ve({html:!0,linkify:!0,typographer:!0,highlight:function(_,c){if(c&&te.getLanguage(c))try{return te.highlight(_,{language:c}).value}catch{}return""}}),i=_=>n.render(_.trim()),o=_=>new Date(_).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),f=async _=>{try{await L.delete(`/comments/${_}`),s("deleted"),me.success("Комментарий успешно удален")}catch(c){me.error("Произошла ошибка при удалении комментария",{description:c.data.message})}};return(_,c)=>(l(),m("div",Dt,[(l(!0),m(V,null,U(_.comments,x=>{var I;return l(),m("div",{key:x.id,class:"relative"},[e("div",Ct,[e("div",St,[p(u(re),{name:x.user.name,size:"sm"},null,8,["name"])]),e("div",It,[e("div",Mt,[e("div",Tt,[e("span",Vt,h(x.user.name),1),e("span",Lt,h(o(x.created_at)),1)]),x.user.id===((I=u(r).currentUser)==null?void 0:I.id)?(l(),R(u(S),{key:0,icon:"heroicons:trash",onClick:b=>f(x.id),class:"w-4 h-4 cursor-pointer text-gray-500 hover:text-gray-700"},null,8,["onClick"])):w("",!0)]),e("div",At,[x.parent&&_.showParentReferences?(l(),m(V,{key:0},[e("span",Ut,"@"+h(x.parent.user.name),1),c[0]||(c[0]=e("span",{class:"text-gray-300 mx-1"},"•",-1))],64)):w("",!0),e("span",{innerHTML:i(x.text)},null,8,Ft)])])])])}),128))]))}}),Rt={class:"bg-white shadow rounded-lg overflow-hidden"},Et={class:"px-4 py-5 sm:p-6"},Pt=M({__name:"IssueCommentsTab",props:{issueId:{},comments:{}},emits:["comment-added","comment-deleted"],setup(y,{emit:d}){const s=y,r=d,n=C(!1),i=async o=>{n.value=!0;try{await Te.addComment(s.issueId,o),r("comment-added")}catch(f){console.error("Error adding comment:",f)}finally{n.value=!1}};return(o,f)=>(l(),m("div",Rt,[f[1]||(f[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Комментарии")],-1)),e("div",Et,[p(jt,{comments:o.comments,onDeleted:f[0]||(f[0]=_=>o.$emit("comment-deleted")),"show-parent-references":""},null,8,["comments"]),p(u(dt),{onSubmit:i,"is-loading":n.value},null,8,["is-loading"])])]))}}),zt={class:"space-y-4"},Bt={class:"bg-white shadow rounded-lg p-4"},Nt={class:"space-y-3"},Ot=M({__name:"IssueSidebar",props:{issue:{}},emits:["priority-changed","due-date-changed"],setup(y,{emit:d}){const s=ae();return(r,n)=>{var i,o;return l(),m("div",zt,[e("div",Bt,[n[8]||(n[8]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Детали",-1)),e("div",Nt,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Приоритет",-1)),p(u(Ae),{modelValue:r.issue.priority,"onUpdate:modelValue":n[0]||(n[0]=f=>r.issue.priority=f),onChange:n[1]||(n[1]=f=>u(s).updateIssue(r.issue.id,{priority:f}))},null,8,["modelValue"])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Дата дедлайна",-1)),p(u(Oe),{modelValue:r.issue.due_date,"onUpdate:modelValue":n[2]||(n[2]=f=>r.issue.due_date=f),onChange:n[3]||(n[3]=f=>u(s).updateIssue(r.issue.id,{due_date:f}))},null,8,["modelValue"])]),n[6]||(n[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Среда",-1)),p(u(O),{variant:"info",text:(i=r.issue.event)==null?void 0:i.environment},null,8,["text"]),n[7]||(n[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Релиз",-1)),p(u(O),{variant:"light",text:((o=r.issue.event)==null?void 0:o.release)==="unknown/unknown"?"Не удалось получить информацию":r.issue.event.release},null,8,["text"])])])])}}}),Yt={class:"border-b border-gray-200"},Ht={class:"-mb-px flex space-x-8"},Kt=["onClick"],qt={class:"flex items-center"},Jt={key:0,class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Qt=M({__name:"IssueTabs",props:{activeTab:{},eventCount:{}},emits:["tab-change"],setup(y,{emit:d}){const s=d,r=[{name:"comments",label:"Комментарии",icon:"heroicons:chat-bubble-oval-left"},{name:"activities",label:"Активность",icon:"mdi:history"}];return(n,i)=>(l(),m("div",Yt,[e("nav",Ht,[(l(),m(V,null,U(r,o=>e("button",{key:o.name,onClick:f=>s("tab-change",o.name),class:E([o.name===n.activeTab?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},[e("span",qt,[p(u(S),{icon:o.icon,class:"mr-2 h-5 w-5"},null,8,["icon"]),B(" "+h(o.label)+" ",1),o.count!==void 0?(l(),m("span",Jt,h(o.count),1)):w("",!0)])],10,Kt)),64))])]))}}),Xt={class:"bg-white shadow rounded-lg p-4 mt-4"},Gt={class:"flex items-center justify-between mb-3"},Wt={class:"space-y-3"},Zt={key:0},es={class:"space-y-2"},ts={class:"flex items-center"},ss={class:"text-sm font-medium text-gray-900"},ns=["onClick"],as={key:1},os={class:"space-y-2"},is={class:"flex items-center"},rs={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center mr-3"},ls={class:"text-sm font-medium text-gray-900"},us=["onClick"],ds={key:2,class:"text-sm text-gray-500"},cs={class:"space-y-4"},ms={key:0},gs={key:1},ps={class:"flex gap-2"},vs=M({__name:"IssueAssignees",props:{assignees:{}},emits:["assignee-added","assignee-removed"],setup(y,{emit:d}){const s=ae(),r=C(!1),n=C("user"),i=C([]),o=C([]),f=C([]),_=C([]),c=()=>{n.value==="user"?s.addAssignee(s.issue.id,"user",i.value):s.addAssignee(s.issue.id,"team",o.value),r.value=!1},x=()=>{i.value=null,o.value=null},I=async k=>{try{f.value=(await L.post("/users/available",{query:{q:k},issue_id:s.issue.id})).users}catch(v){console.error("Error fetching users:",v)}},b=async k=>{try{_.value=(await L.get("/teams/available",{query:{q:k},issue_id:s.issue.id})).teams}catch(v){console.error("Error fetching teams:",v)}};return ne(async()=>{s.issue.id&&(await I(),await b())}),ee(r,k=>{k?n.value==="user"?I():b():x()}),ee(n,k=>{k==="user"?I():b(),x()}),(k,v)=>(l(),m("div",Xt,[e("div",Gt,[v[6]||(v[6]=e("h3",{class:"text-sm font-medium text-gray-900"},"Назначенные",-1)),e("button",{onClick:v[0]||(v[0]=$=>r.value=!0),class:"text-sm text-indigo-600 hover:text-indigo-900 cursor-pointer"}," Добавить ")]),e("div",Wt,[k.assignees.users.length>0?(l(),m("div",Zt,[v[7]||(v[7]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Пользователи",-1)),e("ul",es,[(l(!0),m(V,null,U(k.assignees.users,$=>(l(),m("li",{key:`user-${$.id}`,class:"flex items-center justify-between"},[e("div",ts,[p(u(re),{class:"mr-3",size:"sm",name:$.name},null,8,["name"]),e("span",ss,h($.name),1)]),e("button",{onClick:F=>u(s).removeAssignee(u(s).issue.id,"user",$.id),class:"text-gray-400 hover:text-gray-500"},[p(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,ns)]))),128))])])):w("",!0),k.assignees.teams.length>0?(l(),m("div",as,[v[8]||(v[8]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Команды",-1)),e("ul",os,[(l(!0),m(V,null,U(k.assignees.teams,$=>(l(),m("li",{key:`team-${$.id}`,class:"flex items-center justify-between"},[e("div",is,[e("span",rs,[p(u(S),{icon:"mdi:account-group",class:"h-5 w-5 text-gray-600"})]),e("span",ls,h($.name),1)]),e("button",{onClick:F=>u(s).removeAssignee(u(s).issue.id,"team",$.id),class:"text-gray-400 hover:text-gray-500"},[p(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,us)]))),128))])])):w("",!0),k.assignees.users.length===0&&k.assignees.teams.length===0?(l(),m("p",ds,[p(u(Me),{title:"Назначенные отсутствуют",description:"Добавьте ответственных за эту задачу",icon:"heroicons:user-group"})])):w("",!0)]),p(u(ke),{"is-open":r.value,onClose:v[5]||(v[5]=$=>r.value=!1)},{title:j(()=>v[9]||(v[9]=[B("Добавить ответственного")])),content:j(()=>[e("div",cs,[v[12]||(v[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Тип",-1)),p(u(Z),{options:[{value:"user",label:"Пользователь"},{value:"team",label:"Команда"}],"option-label":"label","option-value":"value",modelValue:n.value,"onUpdate:modelValue":v[1]||(v[1]=$=>n.value=$)},null,8,["modelValue"]),n.value==="user"?(l(),m("div",ms,[v[10]||(v[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выбрать пользователей",-1)),p(u(Z),{onSearch:I,options:f.value,"option-label":"name","option-value":"id",modelValue:i.value,"onUpdate:modelValue":v[2]||(v[2]=$=>i.value=$),multiple:"",searchable:"",placeholder:"Выберите пользователей"},null,8,["options","modelValue"])])):(l(),m("div",gs,[v[11]||(v[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выберите команды",-1)),p(u(Z),{onSearch:b,options:_.value,"option-label":"name","option-value":"id",modelValue:o.value,"onUpdate:modelValue":v[3]||(v[3]=$=>o.value=$),multiple:"",searchable:"",placeholder:"Выберите команды"},null,8,["options","modelValue"])]))])]),footer:j(()=>[e("div",ps,[p(u(se),{variant:"secondary",onClick:v[4]||(v[4]=$=>r.value=!1)},{default:j(()=>v[13]||(v[13]=[B(" Отмена ")])),_:1,__:[13]}),p(u(se),{onClick:c},{default:j(()=>v[14]||(v[14]=[B(" Добавить ")])),_:1,__:[14]})])]),_:1},8,["is-open"])]))}}),ys={class:"bg-white shadow rounded-lg p-4 mt-4"},fs={class:"space-y-3"},hs={class:"flex justify-between"},xs={class:"text-sm text-gray-900"},bs={class:"flex justify-between"},_s={class:"text-sm text-gray-900"},ws={class:"flex justify-between"},$s={class:"text-sm text-gray-900"},ks={class:"flex justify-between"},Ds={class:"text-sm text-gray-900"},Cs={class:"flex justify-between"},Ss={class:"text-sm text-gray-900 text-right font-mono"},Is={class:"flex justify-between"},Ms={class:"flex justify-between"},Ts=M({__name:"IssueMeta",props:{issue:{}},setup(y){const d=A(()=>{var r,n;const s=(r=y.issue)==null?void 0:r.event.type.split("\\");return s.length>1?s[s.length-1]:(n=y.issue)==null?void 0:n.event.type});return(s,r)=>{var n,i,o;return l(),m("div",ys,[r[7]||(r[7]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Все метаданные",-1)),e("div",fs,[e("div",hs,[r[0]||(r[0]=e("span",{class:"text-xs font-medium text-gray-500"},"Создана",-1)),e("span",xs,h(u(ge)((n=s.issue)==null?void 0:n.created_at)),1)]),e("div",bs,[r[1]||(r[1]=e("span",{class:"text-xs font-medium text-gray-500"},"Обновлена",-1)),e("span",_s,h(u(ge)((i=s.issue)==null?void 0:i.updated_at)),1)]),e("div",ws,[r[2]||(r[2]=e("span",{class:"text-xs font-medium text-gray-500"},"Среда",-1)),e("span",$s,h((o=s.issue.event)==null?void 0:o.environment),1)]),e("div",ks,[r[3]||(r[3]=e("span",{class:"text-xs font-medium text-gray-500"},"Релиз",-1)),e("span",Ds,h(s.issue.event.release||"Not specified"),1)]),e("div",Cs,[r[4]||(r[4]=e("span",{class:"text-xs font-medium text-gray-500"},"Айди события",-1)),e("span",Ss,h(s.issue.event.event_id),1)]),e("div",Is,[r[5]||(r[5]=e("span",{class:"text-xs font-medium text-gray-500"},"Тип события",-1)),p(O,{variant:"default"},{default:j(()=>[B(h(d.value),1)]),_:1})]),e("div",Ms,[r[6]||(r[6]=e("span",{class:"text-xs font-medium text-gray-500"},"Уровень события",-1)),s.issue.event.level==="error"?(l(),R(O,{key:0,variant:"danger",text:s.issue.event.level},null,8,["text"])):w("",!0),s.issue.event.level==="warning"?(l(),R(O,{key:1,variant:"warning",text:s.issue.event.level},null,8,["text"])):w("",!0),s.issue.event.level==="info"?(l(),R(O,{key:2,variant:"info",text:s.issue.event.level},null,8,["text"])):w("",!0),s.issue.event.level==="debug"?(l(),R(O,{key:3,variant:"info",text:s.issue.event.level},null,8,["text"])):w("",!0)])])])}}}),Vs={class:"space-y-2"},Ls={key:0,class:"space-y-2"},As={key:0,class:"flex items-start space-x-2"},Us={class:"text-gray-500 capitalize"},Fs={class:"text-sm font-medium"},js={key:1,class:"flex items-center space-x-2"},Rs={key:2,class:"flex items-center space-x-2"},Es={class:"text-sm text-gray-600"},Ps={key:0,class:"flex items-start space-x-2"},zs={class:"text-gray-500 capitalize"},Bs={class:"flex-1"},Ns={class:"flex items-center space-x-2"},Os={class:"text-sm text-gray-600 line-through"},Ys={class:"text-sm font-medium"},Hs=M({__name:"IssueActivityChanges",props:{activity:{}},setup(y){const d=["updated_at","created_at"],s=c=>!d.includes(c),r=c=>({title:"Название",priority:"Приоритет",culprit:"Виновник",due_date:"Дедлайн",status:"Статус"})[c]||c,n=(c,x)=>x==null?"Не установлено":c==="due_date"?f(x):x,i=c=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[c]||c,o=c=>({open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",closed:"bg-purple-100 text-purple-800"})[c]||"bg-gray-100 text-gray-800",f=c=>c?new Date(c).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):null,_=c=>c?new Date(c)<new Date:!1;return(c,x)=>(l(),m("div",Vs,[c.activity.type==="created_issue"?(l(),m("div",Ls,[(l(!0),m(V,null,U(c.activity.changes.after,(I,b)=>(l(),m("div",{key:b,class:"space-y-1"},[s(b)?(l(),m("div",As,[e("span",Us,h(r(b))+":",1),e("span",Fs,h(n(b,I)),1)])):w("",!0)]))),128))])):c.activity.type==="status_changed"?(l(),m("div",js,[x[0]||(x[0]=e("span",{class:"text-gray-500"},"Статус:",-1)),c.activity.changes.before?(l(),m(V,{key:0},[e("span",{class:E(["px-2 py-0.5 rounded text-xs line-through",o(c.activity.changes.before.status)])},h(i(c.activity.changes.before.status)),3),p(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):w("",!0),e("span",{class:E(["px-2 py-0.5 rounded text-xs",o(c.activity.changes.after.status)])},h(i(c.activity.changes.after.status)),3)])):c.activity.type==="due_date_changed"?(l(),m("div",Rs,[x[1]||(x[1]=e("span",{class:"text-gray-500"},"Дедлайн:",-1)),c.activity.changes.before?(l(),m(V,{key:0},[e("span",Es,h(f(c.activity.changes.before.due_date)||"Не установлен"),1),p(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):w("",!0),e("span",{class:E(["text-sm font-medium",{"text-red-600":_(c.activity.changes.after.due_date)}])},h(f(c.activity.changes.after.due_date)||"Не установлен"),3)])):(l(!0),m(V,{key:3},U(c.activity.changes.after,(I,b)=>(l(),m("div",{key:b,class:"space-y-1"},[s(b)&&(!c.activity.changes.before||c.activity.changes.before[b]!==I)?(l(),m("div",Ps,[e("span",zs,h(r(b))+":",1),e("div",Bs,[e("div",Ns,[c.activity.changes.before?(l(),m(V,{key:0},[e("span",Os,h(n(b,c.activity.changes.before[b])),1),p(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):w("",!0),e("span",Ys,h(n(b,I)),1)])])])):w("",!0)]))),128))]))}}),Ks=ye(Hs,[["__scopeId","data-v-e15e07a4"]]),qs={class:"bg-white shadow rounded-lg overflow-hidden"},Js={class:"space-y-4 px-4 py-5"},Qs={class:"flex-shrink-0"},Xs={class:"flex-1 min-w-0"},Gs={class:"flex items-center space-x-2 text-sm"},Ws={class:"font-medium text-gray-900"},Zs={class:"text-gray-500"},en={class:"mt-1 text-sm"},tn={key:0,class:"text-center py-4 text-gray-500"},sn=M({__name:"IssueActivityFeed",props:{activities:{}},setup(y){const d={created_issue:"bg-green-100 text-green-800",updated_issue:"bg-blue-100 text-blue-800",status_changed:"bg-purple-100 text-purple-800",due_date_changed:"bg-yellow-100 text-yellow-800",comment_added:"bg-indigo-100 text-indigo-800"},s=n=>({created_issue:"Создана",updated_issue:"Обновлена",status_changed:"Статус изменён",due_date_changed:"Дедлайн изменён",comment_added:"Комментарий добавлен"})[n]||n,r=n=>new Date(n).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(n,i)=>(l(),m("div",qs,[i[1]||(i[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"История изменений")],-1)),e("div",Js,[(l(!0),m(V,null,U(n.activities,o=>(l(),m("div",{key:o.id,class:"flex items-start space-x-3"},[e("div",Qs,[p(u(re),{name:o.user.name,size:"sm"},null,8,["name"])]),e("div",Xs,[e("div",Gs,[e("span",Ws,h(o.user.name),1),e("span",Zs,h(r(o.created_at)),1),i[0]||(i[0]=e("span",{class:"text-gray-400"},"•",-1)),e("span",{class:E(["text-xs px-2 py-0.5 rounded-full",d[o.type]||"bg-gray-100 text-gray-800"])},h(s(o.type)),3)]),e("div",en,[p(Ks,{activity:o},null,8,["activity"])])])]))),128)),n.activities.length?w("",!0):(l(),m("div",tn," Нет записей об изменениях "))])]))}}),nn={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},an={key:0,class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},on={class:"lg:col-span-2 space-y-6"},rn={class:"lg:col-span-1"},kn=M({__name:"Show",props:{id:{}},setup(y){const d=ae(),s=C("comments"),r=n=>{s.value=n};return ne(async()=>{await d.fetchIssue(y.id)}),(n,i)=>(l(),R(De,null,{default:j(()=>{var o,f;return[e("div",nn,[p(ft,{issue:u(d).issue},null,8,["issue"]),(o=u(d).issue)!=null&&o.id?(l(),m("div",an,[e("div",on,[p(kt,{event:u(d).issue.event},null,8,["event"]),p(Qt,{"active-tab":s.value,onTabChange:r},null,8,["active-tab"]),s.value==="comments"?(l(),R(Pt,{key:0,"issue-id":u(d).issue.id,comments:(f=u(d).issue)==null?void 0:f.comments,onCommentAdded:i[0]||(i[0]=_=>u(d).fetchIssue(u(d).issue.id)),onCommentDeleted:i[1]||(i[1]=_=>u(d).fetchIssue(u(d).issue.id))},null,8,["issue-id","comments"])):s.value==="activities"?(l(),R(sn,{key:1,activities:u(d).issue.activities},null,8,["activities"])):w("",!0)]),e("div",rn,[p(Ot,{issue:u(d).issue},null,8,["issue"]),p(vs,{assignees:u(d).issue.assignees},null,8,["assignees"]),p(Ts,{issue:u(d).issue},null,8,["issue"])])])):w("",!0)])]}),_:1}))}});export{kn as default};
