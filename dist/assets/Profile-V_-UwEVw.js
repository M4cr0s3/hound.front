import{h as U,I as R}from"./client-D6K6htDN.js";import{R as Q}from"./types-CpYKjTMI.js";import{_ as S}from"./EmptyState.vue_vue_type_script_setup_true_lang-BdG-MbLV.js";import{S as h}from"./StatCard-B99VHW3b.js";import{_ as x}from"./Badge.vue_vue_type_script_setup_true_lang-CWRgq3ED.js";import{_ as B}from"./Button.vue_vue_type_script_setup_true_lang-DLJ3rjid.js";import"./StacktraceViewer.vue_vue_type_style_index_0_scoped_7fdb99e3_lang-B8VJLqpg.js";import{_ as y}from"./InputField.vue_vue_type_script_setup_true_lang-BrMCFGzf.js";import{d as W,s as X,i as m,c as Y,k as Z,j as v,w as c,o as u,b as s,e as r,t as d,u as t,g as f,a as b,m as j,l as A,p as ss,F as T,K as L}from"./index-BJM9FpXo.js";import{a as es,M as ts}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CjAASZmf.js";import{p as P,f as os,b as as,o as rs,s as k,m as is,_ as ns}from"./TheForm.vue_vue_type_script_setup_true_lang-BcdpkkpR.js";import{u as ls}from"./users-BNnsnLpB.js";import{_ as ds}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B9uLu0-5.js";import"./projects-CJzepl33.js";const cs=P(rs({current_password:k(),password:P(k(),is(8)),password_confirmation:k()}),os(as([["password"],["password_confirmation"]],g=>g.password===g.password_confirmation,"Пароли не совпадают"),["password_confirmation"])),us={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ps={class:"flex flex-col sm:flex-row gap-8 mb-8"},ms={class:"flex-shrink-0"},fs={class:"h-32 w-32 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white text-5xl font-bold shadow-lg"},_s={class:"flex-1"},vs={class:"flex justify-between items-start"},gs={class:"text-2xl font-bold text-gray-900"},ws={class:"text-gray-600 mt-1"},hs={class:"mt-2"},xs={class:"grid grid-cols-3 gap-4 mt-6"},ys={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8"},bs={class:"divide-y divide-gray-100"},ks={class:"flex items-center space-x-4"},Vs={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-medium"},Cs={class:"text-sm font-medium text-gray-900"},$s={class:"text-sm text-gray-500"},Is={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Us={class:"divide-y divide-gray-100"},Rs={class:"flex items-start space-x-4"},Ss={class:"flex-shrink-0 pt-1"},Bs={class:"flex-1 min-w-0"},js={class:"text-sm font-medium text-gray-900 truncate"},As={class:"mt-1 flex items-center space-x-3"},Ts={class:"text-xs text-gray-500"},Ls={class:"flex justify-end gap-3"},Ps=W({__name:"Profile",setup(g){const E=ls(),{currentUser:n}=X(E),_=m({teams:0,open_issues:0,resolved_issues:0}),F=m(null),p=m(!1),w=m(!1),l=m({current_password:"",password:"",password_confirmation:""}),M={open:"primary",in_progress:"warning",resolved:"success",closed:"secondary"},N={error:"danger",warning:"warning",info:"info",debug:"debug",critical:"critical"},q={open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"},D=Y(()=>n.value.name?n.value.name.charAt(0).toUpperCase():""),G=a=>a?a.charAt(0).toUpperCase():"",K=a=>M[a]||"default",O=a=>N[a]||"default",z=a=>q[a]||a,H=async()=>{try{const a=await U.get("/users/profile");n.value=a.user,_.value=a.stats}catch(a){console.error("Error fetching profile:",a)}},J=async()=>{w.value=!0;try{await U.post("/users/profile/password",l.value),p.value=!1,l.value={current_password:"",password:"",password_confirmation:""},L.success("Пароль успешно обновлен")}catch(a){L.error("Ошибка обновления пароля",{description:a.data.message})}finally{w.value=!1}};return Z(async()=>{await H()}),(a,o)=>{const V=ss("RouterLink");return u(),v(es,null,{default:c(()=>{var C,$,I;return[s("div",us,[s("div",ps,[s("div",ms,[s("div",fs,d(D.value),1)]),s("div",_s,[s("div",vs,[s("div",null,[s("h1",gs,d(t(n).name),1),s("p",ws,d(t(n).email),1),s("div",hs,[r(t(x),{variant:((C=t(n).role)==null?void 0:C.title)===t(Q).Maintainer?"primary":"secondary"},{default:c(()=>{var e;return[f(d((e=t(n).role)==null?void 0:e.title),1)]}),_:1},8,["variant"])])]),s("button",{onClick:o[0]||(o[0]=e=>p.value=!0),class:"inline-flex items-center cursor-pointer px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"},[r(t(R),{icon:"heroicons:lock-closed",class:"mr-2 h-4 w-4"}),o[6]||(o[6]=f(" Сменить пароль "))])]),s("div",xs,[r(h,{title:"Команд",value:_.value.teams,icon:"heroicons:user-group",class:"bg-white"},null,8,["value"]),r(h,{title:"Активных задач",value:_.value.open_issues,icon:"heroicons:exclamation-triangle",variant:"warning",class:"bg-white"},null,8,["value"]),r(h,{title:"Решенных задач",value:_.value.resolved_issues,icon:"heroicons:check-badge",variant:"success",class:"bg-white"},null,8,["value"])])])]),s("div",ys,[o[7]||(o[7]=s("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[s("h2",{class:"text-lg font-semibold text-gray-900"},"Мои команды")],-1)),s("div",bs,[(u(!0),b(T,null,A(t(n).teams,e=>(u(),v(V,{key:e.id,to:`/teams/${e.slug}`,class:"block p-5 hover:bg-gray-50 transition-colors duration-150"},{default:c(()=>{var i;return[s("div",ks,[s("div",Vs,d(G(e.name)),1),s("div",null,[s("p",Cs,d(e.name),1),s("p",$s,d((i=e==null?void 0:e.members)==null?void 0:i.length)+" участников",1)])])]}),_:2},1032,["to"]))),128)),($=t(n).teams)!=null&&$.length?j("",!0):(u(),v(t(S),{key:0,title:"Нет команд",icon:"heroicons:user-group",description:"Вы не состоите ни в одной команде",class:"p-8"}))])]),s("div",Is,[o[8]||(o[8]=s("div",{class:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white"},[s("h2",{class:"text-lg font-semibold text-gray-900"},"Мои задачи")],-1)),s("div",Us,[(u(!0),b(T,null,A(t(n).assignments,e=>{var i;return u(),b("div",{key:e.id,class:"p-5 hover:bg-gray-50 transition-colors duration-150"},[s("div",Rs,[s("div",Ss,[r(t(x),{variant:K(e.issue.status),text:z(e.issue.status)},null,8,["variant","text"])]),s("div",Bs,[s("p",js,[f(d(e.issue.title)+" ",1),r(t(x),{variant:O(e.issue.event.level),text:e.issue.event.level},null,8,["variant","text"])]),s("div",As,[s("span",Ts," Проект: "+d((i=e.issue.project)==null?void 0:i.name),1)])]),r(V,{to:`/issues/${e.issue.id}`,class:"text-gray-400 hover:text-gray-500"},{default:c(()=>[r(t(R),{icon:"heroicons:chevron-right",class:"h-5 w-5"})]),_:2},1032,["to"])])])}),128)),(I=t(n).assignments)!=null&&I.length?j("",!0):(u(),v(t(S),{key:0,title:"Нет задач",icon:"heroicons:check-badge",description:"Вам не назначено ни одной задачи",class:"p-8",small:""}))])])]),r(t(ts),{"is-open":p.value,onClose:o[5]||(o[5]=e=>p.value=!1),title:"Смена пароля"},{content:c(()=>[r(t(ns),{class:"space-y-3",schema:t(cs),data:l.value,submit:J,ref_key:"passwordFormRef",ref:F},{default:c(({errors:e})=>[r(t(y),{modelValue:l.value.current_password,"onUpdate:modelValue":o[1]||(o[1]=i=>l.value.current_password=i),label:"Текущий пароль",type:"password",required:"",icon:"heroicons:lock-closed",id:"current-password",placeholder:"Текущий пароль",error:e==null?void 0:e.current_password},null,8,["modelValue","error"]),r(t(y),{modelValue:l.value.password,"onUpdate:modelValue":o[2]||(o[2]=i=>l.value.password=i),label:"Новый пароль",type:"password",required:"",icon:"heroicons:key",id:"password",placeholder:"••••••••",error:e==null?void 0:e.password},null,8,["modelValue","error"]),r(t(y),{modelValue:l.value.password_confirmation,"onUpdate:modelValue":o[3]||(o[3]=i=>l.value.password_confirmation=i),label:"Подтверждение пароля",type:"password",required:"",icon:"heroicons:key",id:"password-confirmation",placeholder:"••••••••",error:e==null?void 0:e.password_confirmation},null,8,["modelValue","error"]),s("div",Ls,[r(t(B),{variant:"secondary",onClick:o[4]||(o[4]=i=>p.value=!1)},{default:c(()=>o[9]||(o[9]=[f(" Отмена ")])),_:1,__:[9]}),r(t(B),{type:"submit","is-loading":w.value},{default:c(()=>o[10]||(o[10]=[f(" Сохранить ")])),_:1,__:[10]},8,["is-loading"])])]),_:1},8,["schema","data"])]),_:1},8,["is-open"])]}),_:1})}}}),Ys=ds(Ps,[["__scopeId","data-v-a5e7cb21"]]);export{Ys as default};
