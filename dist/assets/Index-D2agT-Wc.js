import"./index-Cx72w7ih.js";import{B as D,d as C,k,c as M,m as z,g as V,C as I,D as T,a as x,o as r,v as A,l as w,w as p,b as s,e as a,h,f as n,s as F,F as b,n as $,t as g,p as L}from"./index-Wh5rQBKa.js";import{i as H,g as R}from"./install-w9194OeT.js";import{a as N}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BqQWdHt-.js";import{I as u}from"./iconify-BfhLP0IP.js";import{u as O}from"./projects-Bm4F-Z5r.js";import{_ as B}from"./EmptyState.vue_vue_type_script_setup_true_lang-C6S-eQDP.js";import{_ as E}from"./Button.vue_vue_type_script_setup_true_lang-D8221Og-.js";import"./index-BCqgpTI_.js";import"./index-zhWDFp7O.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P=async()=>D.get("/projects/stats/day"),U=C({__name:"EventsChart",props:{data:{},slug:{}},setup(S){const f=V(),c=S,i=k(null),d=k(null),t=M(()=>{const _=new Date().getHours(),v=[];for(let l=-4;l<=4;l++){const o=(_+l+24)%24;v.push({hour:`${o.toString().padStart(2,"0")}:00`,count:0})}return v.map(l=>{const o=c.data.find(y=>y.hour===l.hour);return o?{...l,count:o.count}:l})});z(()=>{if(i.value){const e=H(i.value);m(e),e.on("click","series",()=>{f.push(`/projects/${c.slug}/events`)}),d.value=new ResizeObserver(()=>{e.resize()}),d.value.observe(i.value)}}),I(()=>{if(i.value){const e=R(i.value);e&&(e.off("click"),e.dispose()),d.value&&(d.value.disconnect(),d.value=null)}}),T(()=>c.data,()=>{if(i.value){const e=R(i.value);e&&m(e)}});function m(e){const _=Math.max(...c.data.map(o=>o.count)),v=Math.ceil(_*1.2),l={grid:{top:10,right:10,bottom:20,left:40},xAxis:{type:"category",data:t.value.map(o=>o.hour),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{fontSize:10,color:"#6b7280"}},yAxis:{type:"value",max:v,splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{fontSize:10,color:"#6b7280"},min:0},series:[{data:t.value.map(o=>o.count),type:"bar",barWidth:"80%",itemStyle:{color:"#818cf8"},emphasis:{itemStyle:{color:"#4f46e5"}}}],tooltip:{trigger:"axis",formatter:o=>{const y=o[0];return`${y.axisValue}: ${y.value} событий`}}};e.setOption(l)}return(e,_)=>(r(),x("div",{ref_key:"chartRef",ref:i,class:"w-full h-full"},null,512))}}),W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},j={class:"flex justify-between items-center mb-6"},q={class:"bg-white shadow rounded-lg overflow-hidden"},G={key:0,class:"divide-y divide-gray-200"},J={key:2,class:"divide-y divide-gray-200"},K={class:"flex flex-col space-y-4"},Q={class:"flex items-center justify-between"},X={class:"flex items-center space-x-4"},Y={class:"flex-shrink-0 h-10 w-10 rounded-md bg-indigo-100 flex items-center justify-center"},Z={class:"text-sm text-gray-500 mt-1"},ss={class:"flex items-center space-x-4"},es={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ts={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},os={class:"flex items-center space-x-3"},as={class:"p-2 rounded-lg bg-indigo-50 text-indigo-600"},ns={class:"text-xl font-bold text-gray-900"},is={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},rs={class:"flex items-center space-x-3"},ls={class:"p-2 rounded-lg bg-red-50 text-red-600"},ds={class:"text-xl font-bold text-gray-900"},cs={class:"p-4 bg-white rounded-xl border border-gray-100 shadow-xs hover:shadow-sm transition-shadow"},us={class:"flex items-center space-x-3"},xs={class:"p-2 rounded-lg bg-purple-50 text-purple-600"},ms={class:"text-xl font-bold text-gray-900"},gs={class:"flex justify-center mb-2"},fs={class:"h-42"},Rs=C({__name:"Index",setup(S){const f=k([]),{isLoading:c}=A(O()),i=d=>d.stats.avg_response_time<200?"good":"warning";return z(async()=>{f.value=(await P()).data}),(d,t)=>{const m=F("RouterLink");return r(),w(N,null,{default:p(()=>[s("div",W,[s("div",j,[t[1]||(t[1]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Проекты",-1)),a(m,{to:"/projects/create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:p(()=>[a(n(u),{icon:"heroicons:plus",class:"-ml-1 mr-2 h-5 w-5"}),t[0]||(t[0]=h(" Создать проект "))]),_:1})]),s("div",q,[n(c)?(r(),x("div",G,[(r(),x(b,null,$(5,e=>s("div",{key:`project-skeleton-${e}`,class:"px-4 py-4 sm:px-6"},t[2]||(t[2]=[s("div",{class:"flex items-center justify-between animate-pulse"},[s("div",{class:"flex items-center space-x-4"},[s("div",{class:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200"}),s("div",{class:"space-y-2"},[s("div",{class:"h-4 bg-gray-200 rounded w-32"}),s("div",{class:"h-3 bg-gray-100 rounded w-24"})])]),s("div",{class:"h-5 w-5 bg-gray-200 rounded"})],-1)]))),64))])):!f.value.length&&!n(c)?(r(),w(n(B),{key:1,title:"Нет проектов",icon:"heroicons:folder",description:"Создайте свой первый проект."})):(r(),x("div",J,[(r(!0),x(b,null,$(f.value,e=>(r(),x("div",{key:e.id,class:"px-4 py-4 sm:px-6"},[s("div",K,[s("div",Q,[s("div",X,[s("div",Y,[a(n(u),{icon:"heroicons:folder",class:"h-6 w-6 text-indigo-600"})]),s("div",null,[a(m,{to:`/projects/${e.slug}`,class:"text-sm font-medium text-indigo-600 hover:text-indigo-900"},{default:p(()=>[h(g(e.name),1)]),_:2},1032,["to"]),s("p",Z,g(e.platform),1)])]),s("div",ss,[a(m,{to:`projects/${e.slug}/settings/general`,class:"text-gray-400 hover:text-gray-500"},{default:p(()=>[a(n(u),{icon:"heroicons:cog-6-tooth",class:"h-5 w-5"})]),_:2},1032,["to"])])]),s("div",es,[s("div",ts,[s("div",os,[s("div",as,[a(n(u),{icon:"heroicons:chart-bar",class:"h-5 w-5"})]),s("div",null,[t[3]||(t[3]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Всего событий ",-1)),s("p",ns,g(e.stats.total_events.toLocaleString()),1)])])]),s("div",is,[s("div",rs,[s("div",ls,[a(n(u),{icon:"heroicons:exclamation-triangle",class:"h-5 w-5"})]),s("div",null,[t[4]||(t[4]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Ошибки (24ч) ",-1)),s("p",ds,[h(g(e.stats.errors_last_day.toLocaleString())+" ",1),s("span",{class:L(["text-xs font-normal ml-1",e.stats.errors_last_day>0?"text-red-500":"text-green-500"])},g(Math.abs(e.stats.error_rate_change))+"% ",3)])])])]),s("div",cs,[s("div",us,[s("div",xs,[a(n(u),{icon:"heroicons:clock",class:"h-5 w-5"})]),s("div",null,[t[5]||(t[5]=s("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"}," Время ответа ",-1)),s("p",ms,[h(g(e.stats.avg_response_time.toFixed(2))+"ms ",1),s("span",{class:L(["text-xs font-normal ml-1",i(e)==="good"?"text-green-500":"text-yellow-500"])},[a(n(u),{icon:i(e)==="good"?"heroicons:check-badge":"heroicons:exclamation-circle",class:"h-3 w-3 inline"},null,8,["icon"])],2)])])])])]),e.events_last_day.length?(r(),x(b,{key:0},[s("div",gs,[a(n(E),{to:`projects/${e.slug}/events`},{default:p(()=>t[6]||(t[6]=[h(" Посмотреть все события ")])),_:2},1032,["to"])]),s("div",fs,[a(U,{data:e.events_last_day,slug:e.slug},null,8,["data","slug"])])],64)):(r(),w(n(B),{key:1,title:"События отсутствуют",icon:"heroicons:arrow-trending-up",description:"Пока что никаких событий не поступало..."}))])]))),128))]))])])]),_:1})}}});export{Rs as default};
