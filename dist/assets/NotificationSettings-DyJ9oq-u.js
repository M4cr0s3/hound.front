import{i as w,a as d,o,b as t,d as R,c as P,p as q,t as v,q as I,F as b,n as V,e as p,f as i,k as _,A as z,m as H,w as G,j as J,l as h,h as K}from"./index-DyigCoU2.js";import{_ as T}from"./SelectField.vue_vue_type_script_setup_true_lang-BuSvXgHM.js";import{I as A}from"./iconify-DSZAPTcl.js";import{_ as F}from"./InputField.vue_vue_type_script_setup_true_lang-B082PeLO.js";import{_ as O}from"./SubmitButton.vue_vue_type_script_setup_true_lang-8S4uJa_M.js";import{_ as Q}from"./Checkbox.vue_vue_type_script_setup_true_lang-BcagtKTg.js";import"./index-BCqgpTI_.js";import{_ as W}from"./EmptyState.vue_vue_type_script_setup_true_lang-DrmU4baN.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Y}from"./index-bfLnkGmT.js";import"./index-7SYxbFho.js";import"./platforms-D8ztvdxx.js";const f={async create(l,m){await w.post(`/projects/${l}/notification-rules`,m)},async getByProject(l){return await w.get(`/projects/${l}/notification-rules`)},async delete(l){await w.delete(`/notification-rules/${l}`)}},Z={},ee={class:"px-6 py-12"};function te(l,m){return o(),d("div",ee,m[0]||(m[0]=[t("div",{class:"animate-pulse space-y-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-3/4"}),t("div",{class:"h-4 bg-gray-200 rounded"}),t("div",{class:"h-4 bg-gray-200 rounded w-5/6"})],-1)]))}const re=X(Z,[["render",te]]),ae={class:"px-6 py-4 hover:bg-gray-50 transition-colors"},le={class:"flex items-center justify-between"},se={class:"flex items-center space-x-4"},oe={class:"text-sm text-gray-900"},ie={class:"font-medium"},ne={class:"text-gray-500"},ue={class:"flex items-center space-x-2"},de={class:"mt-2 text-xs text-gray-500"},me=R({__name:"NotificationRuleCard",props:{rule:{}},emits:["updated","deleted"],setup(l,{emit:m}){const c=l,g=m,y=P(()=>({error:"bg-red-100 text-red-800",warning:"bg-yellow-100 text-yellow-800",info:"bg-blue-100 text-blue-800"})[c.rule.event_type]||"bg-gray-100 text-gray-800"),n=P(()=>({count:"Количество",rate_limit:"Превышение лимита"})[c.rule.trigger_type]||c.rule.trigger_type),a=()=>{g("updated")},x=s=>{g("deleted",s)};return(s,u)=>(o(),d("li",ae,[t("div",le,[t("div",se,[t("span",{class:q(["px-2 py-1 text-xs font-medium rounded-full",y.value])},v(s.rule.event_type),3),t("div",oe,[t("span",ie,v(n.value),1),s.rule.trigger_type==="rate_limit"?(o(),d(b,{key:0},[u[1]||(u[1]=t("span",{class:"text-gray-500 mx-1"},"•",-1)),t("span",ne,"Когда более "+v(s.rule.trigger_params.threshold)+" событий за "+v(s.rule.trigger_params.time_window)+" минут",1)],64)):I("",!0)])]),t("div",ue,[(o(!0),d(b,null,V(s.rule.channels,e=>(o(),d("span",{key:e,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},v(e),1))),128)),t("button",{onClick:a,class:"p-1 text-gray-400 hover:text-gray-500","aria-label":"Edit rule"},[p(i(A),{icon:"heroicons-outline:pencil",class:"h-4 w-4 cursor-pointer"})]),t("button",{onClick:u[0]||(u[0]=e=>x(s.rule.id)),class:"p-1 text-gray-400 hover:text-red-500","aria-label":"Delete rule"},[p(i(A),{icon:"heroicons-outline:trash",class:"h-4 w-4 cursor-pointer"})])])]),t("div",de," Последнее обновление "+v(new Date(s.rule.updated_at).toLocaleString()),1)]))}}),ge={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},pe={key:0,class:"text-red-500 text-sm mt-1"},ce={class:"mt-6"},ye={class:"bg-white rounded-lg border border-gray-200 mt-4"},ve={key:2,class:"divide-y divide-gray-200"},Be=R({__name:"NotificationSettings",props:{slug:{}},setup(l){const m=[{value:"email",label:"Email"},{value:"telegram",label:"Telegram"}],c=_(!1),g=_(!1),y=_([]),n=_({}),a=z({event_type:"",trigger_type:"",trigger_params:{threshold:10,time_window:60},channels:[]});async function x(){try{c.value=!0,await f.create(l.slug,a),y.value=await f.getByProject(l.slug),Y(a)}catch(u){n.value=u.data.errors}finally{c.value=!1}}async function s(u){try{g.value=!0,await f.delete(u),y.value=await f.getByProject(l.slug)}catch(e){n.value=e.data.errors}finally{g.value=!1}}return H(async()=>{g.value=!0,y.value=await f.getByProject(l.slug),g.value=!1}),(u,e)=>{var $,k,j,C,S,B,N,L,D,U,E;return o(),d("div",ge,[e[8]||(e[8]=t("div",{class:"flex justify-between items-center mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Настройки нотификации")],-1)),t("form",{class:"space-y-6",onSubmit:J(x,["prevent"])},[p(i(T),{description:"Выберите тип события, на которое будет отправляться уведомления",label:"Тип события",modelValue:a.event_type,"onUpdate:modelValue":e[0]||(e[0]=r=>a.event_type=r),error:(k=($=n.value)==null?void 0:$.event_type)==null?void 0:k.toString(),options:["error","warning","info"]},null,8,["modelValue","error"]),p(i(T),{description:"Выберите тип триггера, когда уведомление должно срабатывать. Например, когда переходит определенное количество за какое-либо временное окно",label:"Тип уведомления","option-label":"label","option-value":"value",modelValue:a.trigger_type,"onUpdate:modelValue":e[1]||(e[1]=r=>a.trigger_type=r),error:(C=(j=n.value)==null?void 0:j.trigger_type)==null?void 0:C.toString(),options:[{value:"count",label:"Количество"},{value:"rate_limit",label:"Превышение лимита"}]},null,8,["modelValue","error"]),p(i(F),{id:"trigger-params-threshold",label:"Порог",placeholder:"10",name:"trigger_params[threshold]",type:"number",modelValue:a.trigger_params.threshold,"onUpdate:modelValue":e[2]||(e[2]=r=>a.trigger_params.threshold=r),error:(B=(S=n.value)==null?void 0:S.trigger_params)==null?void 0:B.threshold},null,8,["modelValue","error"]),p(i(F),{id:"trigger-params-time-window",label:"Временное окно",name:"trigger_params[time_window]",type:"number",modelValue:a.trigger_params.time_window,"onUpdate:modelValue":e[3]||(e[3]=r=>a.trigger_params.time_window=r),error:(L=(N=n.value)==null?void 0:N.trigger_params)==null?void 0:L.time_window},null,8,["modelValue","error"]),(o(),d(b,null,V(m,r=>p(i(Q),{id:r.value,modelValue:a.channels,"onUpdate:modelValue":e[4]||(e[4]=M=>a.channels=M),value:r.value,name:"channels[]",key:r.value,label:r.label},null,8,["id","modelValue","value","label"])),64)),(D=n.value)!=null&&D.channels?(o(),d("div",pe,v((E=(U=n.value)==null?void 0:U.channels)==null?void 0:E.toString()),1)):I("",!0),t("div",ce,[p(i(O),{loading:c.value,class:"cursor-pointer"},{default:G(()=>e[6]||(e[6]=[K("Добавить")])),_:1},8,["loading"])])],32),t("div",ye,[e[7]||(e[7]=t("div",{class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},[t("h2",{class:"text-lg font-medium text-gray-900"}," Правила нотификации ")],-1)),g.value?(o(),h(i(re),{key:0})):y.value.length?(o(),d("ul",ve,[(o(!0),d(b,null,V(y.value,r=>(o(),h(i(me),{key:r.id,rule:r,onUpdated:e[5]||(e[5]=()=>i(f).getByProject(u.slug)),onDeleted:s},null,8,["rule"]))),128))])):(o(),h(i(W),{key:1,icon:"heroicons:bell",title:"Нет правил нотификации",description:"В данный момент никаких правил нотификации не создано."}))])])}}});export{Be as default};
