import{i as x,a as u,o,b as t,d as A,c as P,p as q,t as v,q as I,F as f,n as V,e as p,f as n,k as w,af as z,B as H,m as G,w as J,j as K,l as h,h as O}from"./index-B605mWSS.js";import{_ as Q}from"./EmptyState.vue_vue_type_script_setup_true_lang-6tWArOav.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as R}from"./iconify-e9sR0ZFq.js";import"./StacktraceViewer.vue_vue_type_style_index_0_scoped_8568d111_lang-OogGfIpQ.js";import{_ as X}from"./Checkbox.vue_vue_type_script_setup_true_lang-C-Fsjec1.js";import{_ as T}from"./InputField.vue_vue_type_script_setup_true_lang-DBN7DNb5.js";import{_ as F}from"./SelectField.vue_vue_type_script_setup_true_lang-Dsjyj-fN.js";import{_ as Y}from"./SubmitButton.vue_vue_type_script_setup_true_lang-B2bSyM0g.js";import{r as Z}from"./index-BPW3n-1W.js";import"./index-p83CCQy-.js";import"./platforms-D8ztvdxx.js";const _={async create(l,m){await x.post(`/projects/${l}/notification-rules`,m)},async getByProject(l){return await x.get(`/projects/${l}/notification-rules`)},async delete(l){await x.delete(`/notification-rules/${l}`)}},ee={},te={class:"px-6 py-12"};function re(l,m){return o(),u("div",te,m[0]||(m[0]=[t("div",{class:"animate-pulse space-y-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-3/4"}),t("div",{class:"h-4 bg-gray-200 rounded"}),t("div",{class:"h-4 bg-gray-200 rounded w-5/6"})],-1)]))}const ae=W(ee,[["render",re]]),le={class:"px-6 py-4 hover:bg-gray-50 transition-colors"},se={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-4"},ne={class:"text-sm text-gray-900"},ie={class:"font-medium"},de={class:"text-gray-500"},ue={class:"flex items-center space-x-2"},me={class:"mt-2 text-xs text-gray-500"},ge=A({__name:"NotificationRuleCard",props:{rule:{}},emits:["updated","deleted"],setup(l,{emit:m}){const c=l,g=m,y=P(()=>({error:"bg-red-100 text-red-800",warning:"bg-yellow-100 text-yellow-800",info:"bg-blue-100 text-blue-800"})[c.rule.event_type]||"bg-gray-100 text-gray-800"),i=P(()=>({count:"Количество",rate_limit:"Превышение лимита"})[c.rule.trigger_type]||c.rule.trigger_type),a=()=>{g("updated")},b=s=>{g("deleted",s)};return(s,d)=>(o(),u("li",le,[t("div",se,[t("div",oe,[t("span",{class:q(["px-2 py-1 text-xs font-medium rounded-full",y.value])},v(s.rule.event_type),3),t("div",ne,[t("span",ie,v(i.value),1),s.rule.trigger_type==="rate_limit"?(o(),u(f,{key:0},[d[1]||(d[1]=t("span",{class:"text-gray-500 mx-1"},"•",-1)),t("span",de,"Когда более "+v(s.rule.trigger_params.threshold)+" событий за "+v(s.rule.trigger_params.time_window)+" минут",1)],64)):I("",!0)])]),t("div",ue,[(o(!0),u(f,null,V(s.rule.channels,e=>(o(),u("span",{key:e,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},v(e),1))),128)),t("button",{onClick:a,class:"p-1 text-gray-400 hover:text-gray-500","aria-label":"Edit rule"},[p(n(R),{icon:"heroicons-outline:pencil",class:"h-4 w-4 cursor-pointer"})]),t("button",{onClick:d[0]||(d[0]=e=>b(s.rule.id)),class:"p-1 text-gray-400 hover:text-red-500","aria-label":"Delete rule"},[p(n(R),{icon:"heroicons-outline:trash",class:"h-4 w-4 cursor-pointer"})])])]),t("div",me," Последнее обновление "+v(new Date(s.rule.updated_at).toLocaleString()),1)]))}}),pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},ce={key:0,class:"text-red-500 text-sm mt-1"},ye={class:"mt-6"},ve={class:"bg-white rounded-lg border border-gray-200 mt-4"},_e={key:2,class:"divide-y divide-gray-200"},Ne=A({__name:"NotificationSettings",props:{slug:{}},setup(l){const m=[{value:"email",label:"Email"},{value:"telegram",label:"Telegram"}],c=w(!1),g=w(!1),y=w([]),i=z({event_type:"",trigger_type:"",trigger_params:{threshold:10,time_window:60},channels:[]}),a=H({event_type:"warning",trigger_type:"count",trigger_params:{threshold:10,time_window:60},channels:[]});async function b(){try{c.value=!0,await _.create(l.slug,a),y.value=await _.getByProject(l.slug),Z(a)}catch(d){i.value=d.data.errors}finally{c.value=!1}}async function s(d){try{g.value=!0,await _.delete(d),y.value=await _.getByProject(l.slug)}catch(e){i.value=e.data.errors}finally{g.value=!1}}return G(async()=>{g.value=!0,y.value=await _.getByProject(l.slug),g.value=!1}),(d,e)=>{var $,k,j,B,C,S,N,L,D,U,E;return o(),u("div",pe,[e[8]||(e[8]=t("div",{class:"flex justify-between items-center mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Настройки нотификации")],-1)),t("form",{class:"space-y-6",onSubmit:K(b,["prevent"])},[p(n(F),{description:"Выберите тип события, на которое будет отправляться уведомления",label:"Тип события",modelValue:a.event_type,"onUpdate:modelValue":e[0]||(e[0]=r=>a.event_type=r),error:(k=($=i.value)==null?void 0:$.event_type)==null?void 0:k.toString(),options:["error","warning","info"]},null,8,["modelValue","error"]),p(n(F),{description:"Выберите тип триггера, когда уведомление должно срабатывать. Например, когда переходит определенное количество за какое-либо временное окно",label:"Тип уведомления","option-label":"label","option-value":"value",modelValue:a.trigger_type,"onUpdate:modelValue":e[1]||(e[1]=r=>a.trigger_type=r),error:(B=(j=i.value)==null?void 0:j.trigger_type)==null?void 0:B.toString(),options:[{value:"count",label:"Количество"},{value:"rate_limit",label:"Превышение лимита"}]},null,8,["modelValue","error"]),p(n(T),{id:"trigger-params-threshold",label:"Порог",placeholder:"10",name:"trigger_params[threshold]",type:"number",modelValue:a.trigger_params.threshold,"onUpdate:modelValue":e[2]||(e[2]=r=>a.trigger_params.threshold=r),error:(S=(C=i.value)==null?void 0:C.trigger_params)==null?void 0:S.threshold},null,8,["modelValue","error"]),p(n(T),{id:"trigger-params-time-window",label:"Временное окно",name:"trigger_params[time_window]",type:"number",modelValue:a.trigger_params.time_window,"onUpdate:modelValue":e[3]||(e[3]=r=>a.trigger_params.time_window=r),error:(L=(N=i.value)==null?void 0:N.trigger_params)==null?void 0:L.time_window},null,8,["modelValue","error"]),(o(),u(f,null,V(m,r=>p(n(X),{id:r.value,modelValue:a.channels,"onUpdate:modelValue":e[4]||(e[4]=M=>a.channels=M),value:r.value,name:"channels[]",key:r.value,label:r.label},null,8,["id","modelValue","value","label"])),64)),(D=i.value)!=null&&D.channels?(o(),u("div",ce,v((E=(U=i.value)==null?void 0:U.channels)==null?void 0:E.toString()),1)):I("",!0),t("div",ye,[p(n(Y),{loading:c.value,class:"cursor-pointer"},{default:J(()=>e[6]||(e[6]=[O("Добавить")])),_:1},8,["loading"])])],32),t("div",ve,[e[7]||(e[7]=t("div",{class:"px-6 py-4 border-b border-gray-200 flex items-center justify-between"},[t("h2",{class:"text-lg font-medium text-gray-900"}," Правила нотификации ")],-1)),g.value?(o(),h(n(ae),{key:0})):y.value.length?(o(),u("ul",_e,[(o(!0),u(f,null,V(y.value,r=>(o(),h(n(ge),{key:r.id,rule:r,onUpdated:e[5]||(e[5]=()=>n(_).getByProject(d.slug)),onDeleted:s},null,8,["rule"]))),128))])):(o(),h(n(Q),{key:1,icon:"heroicons:bell",title:"Нет правил нотификации",description:"В данный момент никаких правил нотификации не создано."}))])])}}});export{Ne as default};
