import{_ as re,M as he,c as xe,a as be}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CjAASZmf.js";import{h as U,I as S}from"./client-D6K6htDN.js";import{M as ge}from"./StacktraceViewer.vue_vue_type_style_index_0_scoped_7fdb99e3_lang-B8VJLqpg.js";import{d as I,i as T,c as F,k as ne,A as ve,q as ee,a as c,o as l,a3 as le,h as ue,b as e,a4 as ie,F as L,l as R,n as P,t as x,a5 as de,m as $,a6 as _e,e as g,u,w as j,g as N,a7 as te,a8 as ce,a9 as we,j as E,K as me,f as $e,R as ke,s as De}from"./index-BJM9FpXo.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ce}from"./EmptyState.vue_vue_type_script_setup_true_lang-BdG-MbLV.js";import{_ as se}from"./Button.vue_vue_type_script_setup_true_lang-DLJ3rjid.js";import{_ as Z}from"./SelectField.vue_vue_type_script_setup_true_lang-l9nXAe77.js";import{u as ae}from"./issues-C0m3fSIl.js";import{u as Se}from"./users-BNnsnLpB.js";import{u as Te}from"./index-B9uLu0-5.js";import{S as Ie,_ as Me}from"./StacktraceViewer-Dzlzqh_U.js";import{a as q}from"./types-CpYKjTMI.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-CWRgq3ED.js";import{f as pe}from"./index-CaLwU_wJ.js";import"./projects-CJzepl33.js";import"./platforms-D8ztvdxx.js";const Ve={async get(f){return U.get(`/issues/${f}`)},async updateStatus(f,p){await U.patch(`/issues/${f}/status`,{status:p})},async updatePriority(f,p){await U.patch(`/issues/${f}/priority`,{priority:p})},async updateDueDate(f,p){await U.patch(`/issues/${f}/due-date`,{due_date:p})},async addAssignee(f,p,a){await U.post(`/issues/${f}/assignees`,{type:p,id:a})},async removeAssignee(f,p,a){await U.delete(`/issues/${f}/assignees`,{data:{type:p,id:a}})},async addComment(f,p){await U.post(`/issues/${f}/comments`,{text:p})}},Le=["onKeydown"],Ae={class:"border-b border-gray-200"},Ue={class:"-mb-px flex space-x-8"},Fe=["onClick"],Re={class:"relative"},je={class:"overflow-hidden rounded-lg shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-indigo-500 transition-all duration-200"},Ee={key:0,class:"absolute z-10 mt-1 w-64 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-gray-300 ring-opacity-5 focus:outline-none sm:text-sm"},Pe=["onClick"],ze={class:"flex items-center"},Ne={class:"ml-3 block truncate text-gray-700 font-medium"},Be={key:0,class:"px-4 py-2 text-gray-500 text-sm"},Oe={class:"absolute inset-x-0 bottom-0 flex justify-between items-center py-2 pl-3 pr-2 bg-gray-50 border-t border-gray-200"},Ye={class:"flex items-center space-x-2"},He={class:"prose prose-sm max-w-none p-4 rounded-lg border border-gray-200"},Ke=["innerHTML"],qe={key:1,class:"text-gray-400 italic"},Je={class:"flex justify-end"},Qe={key:0,class:"flex items-center"},Xe={key:1,class:"flex items-center"},Ge=I({__name:"CommentForm",props:{isLoading:{type:Boolean},initialValue:{}},emits:["submit"],setup(f,{emit:p}){const a=f,n=p,s=T("write"),r=T(a.initialValue||""),i=T(null),y=T(!1),b=T([]),d=T(0),h=T(""),M=T(-1),C=[{name:"write",label:"Редактор"},{name:"preview",label:"Превью"}],w=new ge({html:!0,linkify:!0,typographer:!0,highlight:function(t,o){if(o&&te.getLanguage(o))try{return te.highlight(t,{language:o}).value}catch{}return""}}),v=F(()=>r.value.trim()?w.render(r.value):null),_=()=>{r.value.trim()&&(n("submit",r.value.trim()),r.value="")},k=(t,o)=>{if(!i.value)return;const m=i.value.selectionStart,D=i.value.selectionEnd,A=r.value.substring(m,D),Q=r.value.substring(0,m),z=r.value.substring(D);r.value=Q+t+A+o+z,ce(()=>{if(!i.value)return;i.value.focus();const K=m+t.length;i.value.setSelectionRange(K,A?K+A.length:K)})},Y=()=>{const o=(C.findIndex(m=>m.name===s.value)-1+C.length)%C.length;s.value=C[o].name},X=()=>{const o=(C.findIndex(m=>m.name===s.value)+1)%C.length;s.value=C[o].name},oe=Te(async t=>{try{b.value=await U.get(`/api/users/search?q=${t}`)}catch(o){console.error("Ошибка при поиске пользователей:",o),b.value=[]}},300),G=()=>{var D;const t=(D=i.value)==null?void 0:D.selectionStart,o=r.value.substring(0,t),m=o.lastIndexOf("@");if(!(t&&Math.abs(t-m)===1))if(m>=0&&(m===0||/\s/.test(o[m-1]))){const A=o.substring(m+1);if(!A.trim()||/\s/.test(A))return;M.value=m,h.value=o.substring(m+1),y.value=!0,d.value=0,oe(h.value)}else y.value=!1},W=t=>{if(!i.value)return;const o=i.value,m=M.value,D=o.selectionStart,A=r.value.substring(0,m),Q=r.value.substring(D);r.value=A+`@${t.name} `+Q,y.value=!1,ce(()=>{o.focus();const z=m+t.name.length+2;o.setSelectionRange(z,z)})},H=t=>{y.value&&(t.key==="ArrowDown"?(t.preventDefault(),d.value=Math.min(d.value+1,b.value.length-1)):t.key==="ArrowUp"?(t.preventDefault(),d.value=Math.max(d.value-1,0)):t.key==="Enter"?(t.preventDefault(),b.value[d.value]&&W(b.value[d.value])):t.key==="Escape"&&(t.preventDefault(),y.value=!1)),t.altKey&&(t.key==="ArrowLeft"?(t.preventDefault(),Y()):t.key==="ArrowRight"&&(t.preventDefault(),X()))},J=t=>{i.value&&!i.value.contains(t.target)&&(y.value=!1)};return ne(()=>{window.addEventListener("keydown",H),document.addEventListener("click",J)}),ve(()=>{window.removeEventListener("keydown",H),document.removeEventListener("click",J)}),ee(()=>a.initialValue,t=>{t&&(r.value=t)}),(t,o)=>(l(),c("div",{class:"space-y-4",onKeydown:[le(ue(Y,["alt","stop"]),["left"]),le(ue(X,["alt","stop"]),["right"])]},[e("div",Ae,[e("nav",Ue,[(l(),c(L,null,R(C,m=>e("button",{key:m.name,onClick:D=>s.value=m.name,class:P([s.value===m.name?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},x(m.label),11,Fe)),64))])]),ie(e("div",Re,[e("div",je,[ie(e("textarea",{ref_key:"textareaRef",ref:i,id:"comment","onUpdate:modelValue":o[0]||(o[0]=m=>r.value=m),rows:"8",class:"block w-full focus:outline-none resize-none border-0 bg-transparent py-3 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6 font-mono",placeholder:"Напишите ваш комментарий (поддерживается Markdown)...",onKeydown:H,onInput:G},null,544),[[_e,r.value]]),y.value?(l(),c("div",Ee,[(l(!0),c(L,null,R(b.value,(m,D)=>(l(),c("div",{key:D,onClick:A=>W(m),class:P(["relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-indigo-50",{"bg-indigo-100":d.value===D}])},[e("div",ze,[e("span",Ne,x(m.name),1)])],10,Pe))),128)),b.value.length===0?(l(),c("div",Be," Пользователи не найдены ")):$("",!0)])):$("",!0),e("div",Oe,[e("div",Ye,[e("button",{type:"button",onClick:o[1]||(o[1]=m=>k("**","**")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Жирный текст"},[g(u(S),{icon:"mdi:format-bold",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[2]||(o[2]=m=>k("*","*")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Курсив"},[g(u(S),{icon:"mdi:format-italic",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[3]||(o[3]=m=>k("[","](url)")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Ссылка"},[g(u(S),{icon:"mdi:link-variant",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[4]||(o[4]=m=>k("```\n","\n```")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Блок кода"},[g(u(S),{icon:"mdi:code-tags",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[5]||(o[5]=m=>k("- ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Список"},[g(u(S),{icon:"mdi:format-list-bulleted",class:"h-5 w-5"})]),e("button",{type:"button",onClick:o[6]||(o[6]=m=>k("> ","")),class:"rounded p-1 text-gray-400 hover:text-gray-500 hover:bg-gray-100",title:"Цитата"},[g(u(S),{icon:"mdi:format-quote-open",class:"h-5 w-5"})])]),o[7]||(o[7]=e("div",{class:"text-xs text-gray-500"}," Поддерживается Markdown. Ctrl+Enter для отправки ",-1))])])],512),[[de,s.value==="write"]]),ie(e("div",He,[v.value?(l(),c("div",{key:0,innerHTML:v.value},null,8,Ke)):(l(),c("div",qe," Превью будет отображаться здесь... "))],512),[[de,s.value==="preview"]]),e("div",Je,[g(u(se),{type:"button",onClick:_,disabled:t.isLoading||!r.value.trim()},{default:j(()=>[t.isLoading?(l(),c("span",Qe,[g(u(S),{icon:"mdi:loading",class:"h-4 w-4 animate-spin mr-2"}),o[8]||(o[8]=N(" Отправка... "))])):(l(),c("span",Xe,[g(u(S),{icon:"mdi:send",class:"h-4 w-4 mr-2"}),o[9]||(o[9]=N(" Отправить "))]))]),_:1},8,["disabled"])])],40,Le))}}),We=ye(Ge,[["__scopeId","data-v-9eb93a2f"]]),Ze={class:"relative"},et={class:"flex items-center"},tt=["value","placeholder"],st={key:0,class:"absolute z-10 mt-1 w-auto bg-white rounded-md shadow-lg p-4 border border-gray-200 min-w-60"},nt={class:"flex justify-between items-center mb-4"},at={class:"text-sm font-medium text-gray-900"},ot={class:"grid grid-cols-7 gap-1 mb-2"},it={class:"grid grid-cols-7 gap-1"},rt=["onClick"],lt=I({__name:"DatePicker",props:{modelValue:{},placeholder:{}},emits:["update:modelValue","change"],setup(f,{emit:p}){const a=f,n=p,s=T(!1),r=T(new Date),i=T(null);a.modelValue&&(i.value=new Date(a.modelValue));const y=t=>t?t.toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"",b=F(()=>y(i.value)),d=F(()=>r.value.getFullYear()),h=F(()=>r.value.getMonth()),M=F(()=>r.value.toLocaleString("default",{month:"long"})),C=F(()=>{const t=d.value,o=h.value,m=new Date(t,o,1),D=new Date(t,o+1,0),A=m.getDay(),Q=6-D.getDay(),z=[],K=new Date(t,o,0).getDate();for(let V=A-1;V>=0;V--){const B=K-V;z.push({day:B,date:new Date(t,o-1,B),isCurrentMonth:!1,isToday:w(new Date(t,o-1,B)),isSelected:v(new Date(t,o-1,B))})}const fe=D.getDate();for(let V=1;V<=fe;V++){const B=new Date(t,o,V);z.push({day:V,date:B,isCurrentMonth:!0,isToday:w(B),isSelected:v(B)})}for(let V=1;V<=Q;V++)z.push({day:V,date:new Date(t,o+1,V),isCurrentMonth:!1,isToday:w(new Date(t,o+1,V)),isSelected:v(new Date(t,o+1,V))});return z}),w=t=>{const o=new Date;return t.getDate()===o.getDate()&&t.getMonth()===o.getMonth()&&t.getFullYear()===o.getFullYear()},v=t=>i.value?t.getDate()===i.value.getDate()&&t.getMonth()===i.value.getMonth()&&t.getFullYear()===i.value.getFullYear():!1,_=()=>{s.value=!s.value},k=()=>{r.value=new Date(d.value,h.value-1,1)},Y=()=>{r.value=new Date(d.value,h.value+1,1)},X=t=>{if(!t.isCurrentMonth)return;i.value=t.date,r.value=new Date(t.date);const o=G(t.date);n("update:modelValue",o),n("change",o),s.value=!1},oe=()=>{const t=new Date;t.setHours(0,0,0,0),i.value=t,r.value=new Date(t);const o=G(t);n("update:modelValue",o),n("change",o),s.value=!1},G=t=>{if(!t)return null;const o=t.getFullYear(),m=String(t.getMonth()+1).padStart(2,"0"),D=String(t.getDate()).padStart(2,"0");return`${o}-${m}-${D}`},W=()=>{i.value=null,n("update:modelValue",null),s.value=!1},H=t=>{t.target.closest(".relative")||(s.value=!1)},J=t=>{if(!t)return null;try{const o=new Date(t);return isNaN(o.getTime())?(console.error("Invalid date:",t),null):o}catch(o){return console.error("Error parsing date:",o),null}};return ne(()=>{a.modelValue&&(i.value=J(a.modelValue),i.value&&(r.value=new Date(i.value))),document.addEventListener("click",H)}),ve(()=>{document.removeEventListener("click",H)}),ee(()=>a.modelValue,t=>{const o=J(t);if(o){const m=new Date(o.getFullYear(),o.getMonth(),o.getDate()),D=i.value?new Date(i.value.getFullYear(),i.value.getMonth(),i.value.getDate()):null;(!D||m.getTime()!==D.getTime())&&(i.value=o,r.value=new Date(o))}else i.value=null},{immediate:!0}),(t,o)=>(l(),c("div",Ze,[e("div",et,[e("input",{type:"text",value:b.value,onClick:_,readonly:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:t.placeholder},null,8,tt),e("button",{type:"button",onClick:_,class:"absolute right-0 px-3 py-2 text-gray-400 hover:text-gray-500"},[g(u(S),{icon:"mdi:calendar",class:"h-5 w-5"})])]),g(we,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:j(()=>[s.value?(l(),c("div",st,[e("div",nt,[e("button",{onClick:k,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[g(u(S),{icon:"mdi:chevron-left",class:"h-5 w-5"})]),e("span",at,x(M.value)+" "+x(d.value),1),e("button",{onClick:Y,type:"button",class:"p-1 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100"},[g(u(S),{icon:"mdi:chevron-right",class:"h-5 w-5"})])]),e("div",ot,[(l(),c(L,null,R(["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],m=>e("div",{key:m,class:"text-xs text-center text-gray-500"},x(m),1)),64))]),e("div",it,[(l(!0),c(L,null,R(C.value,m=>(l(),c("div",{key:m.day,onClick:D=>X(m),class:P(["text-center py-1 text-sm rounded-full",{"text-gray-400":!m.isCurrentMonth,"hover:bg-gray-100 cursor-pointer":m.isCurrentMonth,"bg-indigo-100 text-indigo-700 font-medium":m.isSelected,"bg-indigo-600 text-white font-medium":m.isToday&&m.isSelected}])},x(m.day),11,rt))),128))]),e("div",{class:"mt-4 flex justify-between"},[e("button",{onClick:oe,type:"button",class:"text-xs text-indigo-600 cursor-pointer hover:text-indigo-900"}," Сегодня "),e("button",{onClick:W,type:"button",class:"text-xs text-gray-500 cursor-pointer hover:text-gray-700"}," Очистить ")])])):$("",!0)]),_:1})]))}}),ut=I({__name:"PriorityBadge",props:{priority:{}},setup(f){const p=F(()=>({low:"Низкий",medium:"Средний",high:"Высокий",critical:"Критический"})[f.priority]),a=F(()=>({low:"bg-gray-100 text-gray-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"})[f.priority]);return(n,s)=>(l(),c("span",{class:P(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",a.value])},x(p.value),3))}}),dt=I({__name:"PrioritySelect",props:{modelValue:{}},emits:["update:modelValue","change"],setup(f,{emit:p}){const a=p,n=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],s=r=>{a("update:modelValue",r),a("change",r)};return(r,i)=>(l(),E(u(Z),{options:n,"option-label":"label","option-value":"value",modelValue:r.modelValue,placeholder:"Выберите приоритет","onUpdate:modelValue":s},null,8,["modelValue"]))}}),ct=I({__name:"StatusBadge",props:{status:{}},setup(f){const p=f,a=F(()=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[p.status]),n=F(()=>({closed:"bg-red-100 text-red-800",resolved:"bg-green-100 text-green-800",open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800"})[p.status]);return(s,r)=>(l(),c("span",{class:P(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",n.value])},x(a.value),3))}}),mt={class:"space-y-2"},pt={key:0,class:"space-y-2"},gt={key:0,class:"flex items-start space-x-2"},vt={class:"text-gray-500 capitalize"},yt={class:"text-sm font-medium"},ft={key:1,class:"flex items-center space-x-2"},ht={key:2,class:"flex items-center space-x-2"},xt={class:"text-sm text-gray-600"},bt={key:0,class:"flex items-start space-x-2"},_t={class:"text-gray-500 capitalize"},wt={class:"flex-1"},$t={class:"flex items-center space-x-2"},kt={class:"text-sm text-gray-600 line-through"},Dt={class:"text-sm font-medium"},Ct=I({__name:"IssueActivityChanges",props:{activity:{}},setup(f){const p=["updated_at","created_at"],a=d=>!p.includes(d),n=d=>({title:"Название",priority:"Приоритет",culprit:"Виновник",due_date:"Дедлайн",status:"Статус"})[d]||d,s=(d,h)=>h==null?"Не установлено":d==="due_date"?y(h):h,r=d=>({open:"Открыта",in_progress:"В работе",resolved:"Решена",closed:"Закрыта"})[d]||d,i=d=>({open:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",closed:"bg-purple-100 text-purple-800"})[d]||"bg-gray-100 text-gray-800",y=d=>d?new Date(d).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric"}):null,b=d=>d?new Date(d)<new Date:!1;return(d,h)=>{var M,C,w,v;return l(),c("div",mt,[d.activity.type==="created_issue"?(l(),c("div",pt,[(l(!0),c(L,null,R(d.activity.changes.after,(_,k,Y)=>(l(),c("div",{key:Y,class:"space-y-1"},[a(k)?(l(),c("div",gt,[e("span",vt,x(n(k))+":",1),e("span",yt,x(s(k,_)),1)])):$("",!0)]))),128))])):d.activity.type==="status_changed"?(l(),c("div",ft,[h[0]||(h[0]=e("span",{class:"text-gray-500"},"Статус:",-1)),d.activity.changes.before?(l(),c(L,{key:0},[e("span",{class:P(["px-2 py-0.5 rounded text-xs line-through",i(d.activity.changes.before.status)])},x(r(d.activity.changes.before.status)),3),g(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):$("",!0),e("span",{class:P(["px-2 py-0.5 rounded text-xs",i((M=d.activity.changes.after)==null?void 0:M.status)])},x(r((C=d.activity.changes.after)==null?void 0:C.status)),3)])):d.activity.type==="due_date_changed"?(l(),c("div",ht,[h[1]||(h[1]=e("span",{class:"text-gray-500"},"Дедлайн:",-1)),d.activity.changes.before?(l(),c(L,{key:0},[e("span",xt,x(y(d.activity.changes.before.due_date)||"Не установлен"),1),g(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):$("",!0),e("span",{class:P(["text-sm font-medium",{"text-red-600":b((w=d.activity.changes.after)==null?void 0:w.due_date)}])},x(y((v=d.activity.changes.after)==null?void 0:v.due_date)||"Не установлен"),3)])):(l(!0),c(L,{key:3},R(d.activity.changes.after,(_,k)=>(l(),c("div",{key:k,class:"space-y-1"},[a(k)&&(!d.activity.changes.before||d.activity.changes.before[k]!==_)?(l(),c("div",bt,[e("span",_t,x(n(k))+":",1),e("div",wt,[e("div",$t,[d.activity.changes.before?(l(),c(L,{key:0},[e("span",kt,x(s(k,d.activity.changes.before[k])),1),g(u(S),{icon:"heroicons-outline:arrow-right",class:"h-4 w-4 text-gray-400"})],64)):$("",!0),e("span",Dt,x(s(k,_)),1)])])])):$("",!0)]))),128))])}}}),St=ye(Ct,[["__scopeId","data-v-40e85b6f"]]),Tt={class:"bg-white shadow rounded-lg overflow-hidden"},It={class:"space-y-4 px-4 py-5"},Mt={class:"flex-shrink-0"},Vt={class:"flex-1 min-w-0"},Lt={class:"flex items-center space-x-2 text-sm"},At={class:"font-medium text-gray-900"},Ut={class:"text-gray-500"},Ft={class:"mt-1 text-sm"},Rt={key:0,class:"text-center py-4 text-gray-500"},jt=I({__name:"IssueActivityFeed",props:{activities:{}},setup(f){const p={created_issue:"bg-green-100 text-green-800",updated_issue:"bg-blue-100 text-blue-800",status_changed:"bg-purple-100 text-purple-800",due_date_changed:"bg-yellow-100 text-yellow-800",comment_added:"bg-indigo-100 text-indigo-800"},a=s=>({created_issue:"Создана",updated_issue:"Обновлена",status_changed:"Статус изменён",due_date_changed:"Дедлайн изменён",comment_added:"Комментарий добавлен"})[s]||s,n=s=>new Date(s).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(s,r)=>(l(),c("div",Tt,[r[1]||(r[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"История изменений")],-1)),e("div",It,[(l(!0),c(L,null,R(s.activities,i=>(l(),c("div",{key:i.id,class:"flex items-start space-x-3"},[e("div",Mt,[g(u(re),{name:i.user.name,size:"sm"},null,8,["name"])]),e("div",Vt,[e("div",Lt,[e("span",At,x(i.user.name),1),e("span",Ut,x(n(i.created_at)),1),r[0]||(r[0]=e("span",{class:"text-gray-400"},"•",-1)),e("span",{class:P(["text-xs px-2 py-0.5 rounded-full",p[i.type]||"bg-gray-100 text-gray-800"])},x(a(i.type)),3)]),e("div",Ft,[g(St,{activity:i},null,8,["activity"])])])]))),128)),s.activities.length?$("",!0):(l(),c("div",Rt," Нет записей об изменениях "))])]))}}),Et={class:"bg-white shadow rounded-lg p-4 mt-4"},Pt={class:"flex items-center justify-between mb-3"},zt={class:"space-y-3"},Nt={key:0},Bt={class:"space-y-2"},Ot={class:"flex items-center"},Yt={class:"text-sm font-medium text-gray-900"},Ht=["onClick"],Kt={key:1},qt={class:"space-y-2"},Jt={class:"flex items-center"},Qt={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center mr-3"},Xt={class:"text-sm font-medium text-gray-900"},Gt=["onClick"],Wt={key:2,class:"text-sm text-gray-500"},Zt={class:"space-y-4"},es={key:0},ts={key:1},ss={class:"flex gap-2"},ns=I({__name:"IssueAssignees",props:{assignees:{}},emits:["assignee-added","assignee-removed"],setup(f,{emit:p}){const a=ae(),n=T(!1),s=T("user"),r=T([]),i=T([]),y=T([]),b=T([]),d=()=>{s.value==="user"?a.addAssignee(a.issue.id,"user",r.value):a.addAssignee(a.issue.id,"team",i.value),n.value=!1},h=()=>{r.value=[],i.value=[]},M=async w=>{try{y.value=(await U.post("/users/available",{query:{q:w},issue_id:a.issue.id})).users}catch(v){console.error("Error fetching users:",v)}},C=async w=>{try{b.value=(await U.get("/teams/available",{query:{q:w,issue_id:a.issue.id}})).teams}catch(v){console.error("Error fetching teams:",v)}};return ne(async()=>{a.issue.id&&(await M(),await C())}),ee(n,w=>{w?s.value==="user"?M():C():h()}),ee(s,w=>{w==="user"?M():C(),h()}),(w,v)=>(l(),c("div",Et,[e("div",Pt,[v[6]||(v[6]=e("h3",{class:"text-sm font-medium text-gray-900"},"Назначенные",-1)),e("button",{onClick:v[0]||(v[0]=_=>n.value=!0),class:"text-sm text-indigo-600 hover:text-indigo-900 cursor-pointer"}," Добавить ")]),e("div",zt,[w.assignees.users.length>0?(l(),c("div",Nt,[v[7]||(v[7]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Пользователи",-1)),e("ul",Bt,[(l(!0),c(L,null,R(w.assignees.users,_=>(l(),c("li",{key:`user-${_.id}`,class:"flex items-center justify-between"},[e("div",Ot,[g(u(re),{class:"mr-3",size:"sm",name:_.name},null,8,["name"]),e("span",Yt,x(_.name),1)]),e("button",{onClick:k=>u(a).removeAssignee(u(a).issue.id,"user",_.id),class:"text-gray-400 hover:text-gray-500"},[g(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,Ht)]))),128))])])):$("",!0),w.assignees.teams.length>0?(l(),c("div",Kt,[v[8]||(v[8]=e("h4",{class:"text-xs font-medium text-gray-500 mb-2"},"Команды",-1)),e("ul",qt,[(l(!0),c(L,null,R(w.assignees.teams,_=>(l(),c("li",{key:`team-${_.id}`,class:"flex items-center justify-between"},[e("div",Jt,[e("span",Qt,[g(u(S),{icon:"mdi:account-group",class:"h-5 w-5 text-gray-600"})]),e("span",Xt,x(_.name),1)]),e("button",{onClick:k=>u(a).removeAssignee(u(a).issue.id,"team",_.id),class:"text-gray-400 hover:text-gray-500"},[g(u(S),{icon:"mdi:close",class:"h-5 w-5 cursor-pointer"})],8,Gt)]))),128))])])):$("",!0),w.assignees.users.length===0&&w.assignees.teams.length===0?(l(),c("p",Wt,[g(u(Ce),{title:"Назначенные отсутствуют",description:"Добавьте ответственных за эту задачу",icon:"heroicons:user-group"})])):$("",!0)]),g(u(he),{"is-open":n.value,onClose:v[5]||(v[5]=_=>n.value=!1)},{title:j(()=>v[9]||(v[9]=[N("Добавить ответственного")])),content:j(()=>[e("div",Zt,[v[12]||(v[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Тип",-1)),g(u(Z),{options:[{value:"user",label:"Пользователь"},{value:"team",label:"Команда"}],"option-label":"label","option-value":"value",modelValue:s.value,"onUpdate:modelValue":v[1]||(v[1]=_=>s.value=_)},null,8,["modelValue"]),s.value==="user"?(l(),c("div",es,[v[10]||(v[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выбрать пользователей",-1)),g(u(Z),{onSearch:M,options:y.value,"option-label":"name","option-value":"id",modelValue:r.value,"onUpdate:modelValue":v[2]||(v[2]=_=>r.value=_),multiple:"",searchable:"",placeholder:"Выберите пользователей"},null,8,["options","modelValue"])])):(l(),c("div",ts,[v[11]||(v[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Выберите команды",-1)),g(u(Z),{onSearch:C,options:b.value,"option-label":"name","option-value":"id",modelValue:i.value,"onUpdate:modelValue":v[3]||(v[3]=_=>i.value=_),multiple:"",searchable:"",placeholder:"Выберите команды"},null,8,["options","modelValue"])]))])]),footer:j(()=>[e("div",ss,[g(u(se),{variant:"secondary",onClick:v[4]||(v[4]=_=>n.value=!1)},{default:j(()=>v[13]||(v[13]=[N(" Отмена ")])),_:1,__:[13]}),g(u(se),{onClick:d},{default:j(()=>v[14]||(v[14]=[N(" Добавить ")])),_:1,__:[14]})])]),_:1},8,["is-open"])]))}}),as={class:"space-y-4 mb-2"},os={class:"flex space-x-3"},is={class:"flex-shrink-0"},rs={class:"flex-1 min-w-0"},ls={class:"flex items-center justify-between"},us={class:"flex items-center space-x-2 text-sm"},ds={class:"font-medium text-gray-900"},cs={class:"text-gray-500"},ms={class:"mt-1 flex items-center text-sm text-gray-700"},ps={class:"text-gray-500"},gs=["innerHTML"],vs=I({__name:"IssueComments",props:{comments:{},showParentReferences:{type:Boolean,default:!1}},emits:["submit-reply","deleted"],setup(f,{emit:p}){const a=p,n=Se(),s=new ge({html:!0,linkify:!0,typographer:!0,highlight:function(b,d){if(d&&te.getLanguage(d))try{return te.highlight(b,{language:d}).value}catch{}return""}}),r=b=>s.render(b.trim()),i=b=>new Date(b).toLocaleString("ru-RU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),y=async b=>{try{await U.delete(`/comments/${b}`),a("deleted"),me.success("Комментарий успешно удален")}catch(d){me.error("Произошла ошибка при удалении комментария",{description:d.data.message})}};return(b,d)=>(l(),c("div",as,[(l(!0),c(L,null,R(b.comments,h=>{var M;return l(),c("div",{key:h.id,class:"relative"},[e("div",os,[e("div",is,[g(u(re),{name:h.user.name,size:"sm"},null,8,["name"])]),e("div",rs,[e("div",ls,[e("div",us,[e("span",ds,x(h.user.name),1),e("span",cs,x(i(h.created_at)),1)]),h.user.id===((M=u(n).currentUser)==null?void 0:M.id)?(l(),E(u(S),{key:0,icon:"heroicons:trash",onClick:C=>y(h.id),class:"w-4 h-4 cursor-pointer text-gray-500 hover:text-gray-700"},null,8,["onClick"])):$("",!0)]),e("div",ms,[h.parent&&b.showParentReferences?(l(),c(L,{key:0},[e("span",ps,"@"+x(h.parent.user.name),1),d[0]||(d[0]=e("span",{class:"text-gray-300 mx-1"},"•",-1))],64)):$("",!0),e("span",{innerHTML:r(h.text)},null,8,gs)])])])])}),128))]))}}),ys={class:"bg-white shadow rounded-lg overflow-hidden"},fs={class:"px-4 py-5 sm:p-6"},hs=I({__name:"IssueCommentsTab",props:{issueId:{},comments:{}},emits:["comment-added","comment-deleted"],setup(f,{emit:p}){const a=f,n=p,s=T(!1),r=async i=>{s.value=!0;try{await Ve.addComment(a.issueId,i),n("comment-added")}catch(y){console.error("Error adding comment:",y)}finally{s.value=!1}};return(i,y)=>(l(),c("div",ys,[y[1]||(y[1]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Комментарии")],-1)),e("div",fs,[g(vs,{comments:i.comments,onDeleted:y[0]||(y[0]=b=>i.$emit("comment-deleted")),"show-parent-references":""},null,8,["comments"]),g(u(We),{onSubmit:r,"is-loading":s.value},null,8,["is-loading"])])]))}}),xs={class:"bg-white shadow rounded-lg overflow-hidden"},bs={class:"px-4 py-5 sm:p-6"},_s={class:"mb-4"},ws={class:"text-sm text-gray-700"},$s={key:0,class:"mb-4"},ks={key:1,class:"mb-4"},Ds=I({__name:"IssueDescription",props:{event:{}},setup(f){return(p,a)=>(l(),c("div",xs,[a[3]||(a[3]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Детали ошибки")],-1)),e("div",bs,[e("div",_s,[a[0]||(a[0]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Сообщение",-1)),e("p",ws,x(p.event.message),1)]),p.event.metadata.stacktrace?(l(),c("div",$s,[a[1]||(a[1]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Стектрейс",-1)),g(u(Ie),{stacktrace:p.event.metadata.stacktrace},null,8,["stacktrace"])])):$("",!0),p.event.metadata.context?(l(),c("div",ks,[a[2]||(a[2]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Контекст",-1)),g(u(Me),{data:p.event.metadata.context},null,8,["data"])])):$("",!0)])]))}}),Cs={class:"border-b border-gray-200 pb-4"},Ss={class:"flex items-start justify-between"},Ts={class:"text-2xl font-bold text-gray-900"},Is={class:"text-gray-500"},Ms={class:"mt-2 flex items-center space-x-4"},Vs={class:"flex space-x-3"},Ls=I({__name:"IssueHeader",props:{issue:{}},setup(f){const p=f,a=$e(),n=ae(),s=[{icon:"heroicons:lock-open",iconClass:"text-gray-700",key:"open",label:"Открыть",handler:async()=>{await n.updateIssueStatus(p.issue.id,q.Open)},visible:()=>p.issue.status!==q.Open},{icon:"heroicons:lock-closed",iconClass:"text-gray-700",key:"lock",label:"Закрыть",handler:async()=>{await n.updateIssueStatus(p.issue.id,q.Closed)},visible:()=>p.issue.status!==q.Closed},{icon:"heroicons:trash",iconClass:"text-red-500",key:"delete",label:"Удалить",handler:async()=>{await n.deleteIssue(p.issue.id),await a.push(ke.ISSUE.INDEX)}}];return(r,i)=>(l(),c("div",Cs,[e("div",Ss,[e("div",null,[e("h1",Ts,[N(x(r.issue.title)+" ",1),e("span",Is,"#"+x(r.issue.id),1)]),e("div",Ms,[g(u(ct),{status:r.issue.status},null,8,["status"]),g(u(ut),{priority:r.issue.priority},null,8,["priority"])])]),e("div",Vs,[r.issue.status!==u(q).Resolved?(l(),E(u(se),{key:0,variant:"secondary",onClick:i[0]||(i[0]=y=>u(n).updateIssueStatus(r.issue.id,u(q).Resolved))},{default:j(()=>i[1]||(i[1]=[N(" Решить ")])),_:1,__:[1]})):$("",!0),g(u(xe),{actions:s})])])]))}}),As={class:"bg-white shadow rounded-lg p-4 mt-4"},Us={class:"space-y-3"},Fs={class:"flex justify-between"},Rs={class:"text-sm text-gray-900"},js={class:"flex justify-between"},Es={class:"text-sm text-gray-900"},Ps={class:"flex justify-between"},zs={class:"text-sm text-gray-900"},Ns={class:"flex justify-between"},Bs={class:"text-sm text-gray-900"},Os={class:"flex justify-between"},Ys={class:"text-sm text-gray-900 text-right font-mono"},Hs={class:"flex justify-between"},Ks={class:"flex justify-between"},qs=I({__name:"IssueMeta",props:{issue:{}},setup(f){const p=F(()=>{var n,s;const a=(n=f.issue)==null?void 0:n.event.type.split("\\");return a.length>1?a[a.length-1]:(s=f.issue)==null?void 0:s.event.type});return(a,n)=>{var s,r,i;return l(),c("div",As,[n[7]||(n[7]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Все метаданные",-1)),e("div",Us,[e("div",Fs,[n[0]||(n[0]=e("span",{class:"text-xs font-medium text-gray-500"},"Создана",-1)),e("span",Rs,x(u(pe)((s=a.issue)==null?void 0:s.created_at)),1)]),e("div",js,[n[1]||(n[1]=e("span",{class:"text-xs font-medium text-gray-500"},"Обновлена",-1)),e("span",Es,x(u(pe)((r=a.issue)==null?void 0:r.updated_at)),1)]),e("div",Ps,[n[2]||(n[2]=e("span",{class:"text-xs font-medium text-gray-500"},"Среда",-1)),e("span",zs,x((i=a.issue.event)==null?void 0:i.environment),1)]),e("div",Ns,[n[3]||(n[3]=e("span",{class:"text-xs font-medium text-gray-500"},"Релиз",-1)),e("span",Bs,x(a.issue.event.release||"Not specified"),1)]),e("div",Os,[n[4]||(n[4]=e("span",{class:"text-xs font-medium text-gray-500"},"Айди события",-1)),e("span",Ys,x(a.issue.event.event_id),1)]),e("div",Hs,[n[5]||(n[5]=e("span",{class:"text-xs font-medium text-gray-500"},"Тип события",-1)),g(O,{variant:"default"},{default:j(()=>[N(x(p.value),1)]),_:1})]),e("div",Ks,[n[6]||(n[6]=e("span",{class:"text-xs font-medium text-gray-500"},"Уровень события",-1)),a.issue.event.level==="error"?(l(),E(O,{key:0,variant:"danger",text:a.issue.event.level},null,8,["text"])):$("",!0),a.issue.event.level==="warning"?(l(),E(O,{key:1,variant:"warning",text:a.issue.event.level},null,8,["text"])):$("",!0),a.issue.event.level==="info"?(l(),E(O,{key:2,variant:"info",text:a.issue.event.level},null,8,["text"])):$("",!0),a.issue.event.level==="debug"?(l(),E(O,{key:3,variant:"info",text:a.issue.event.level},null,8,["text"])):$("",!0)])])])}}}),Js={class:"space-y-4"},Qs={class:"bg-white shadow rounded-lg p-4"},Xs={class:"space-y-3"},Gs=I({__name:"IssueSidebar",props:{issue:{}},emits:["priority-changed","due-date-changed"],setup(f,{emit:p}){const a=ae();return(n,s)=>{var r,i;return l(),c("div",Js,[e("div",Qs,[s[8]||(s[8]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Детали",-1)),e("div",Xs,[e("div",null,[s[4]||(s[4]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Приоритет",-1)),g(u(dt),{modelValue:n.issue.priority,"onUpdate:modelValue":s[0]||(s[0]=y=>n.issue.priority=y),onChange:s[1]||(s[1]=y=>u(a).updateIssue(n.issue.id,{priority:y}))},null,8,["modelValue"])]),e("div",null,[s[5]||(s[5]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Дата дедлайна",-1)),g(u(lt),{modelValue:n.issue.due_date,"onUpdate:modelValue":s[2]||(s[2]=y=>n.issue.due_date=y),onChange:s[3]||(s[3]=y=>u(a).updateIssue(n.issue.id,{due_date:y}))},null,8,["modelValue"])]),s[6]||(s[6]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Среда",-1)),g(u(O),{variant:"info",text:(r=n.issue.event)==null?void 0:r.environment},null,8,["text"]),s[7]||(s[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Релиз",-1)),g(u(O),{variant:"light",text:((i=n.issue.event)==null?void 0:i.release)==="unknown/unknown"?"Не удалось получить информацию":n.issue.event.release},null,8,["text"])])])])}}}),Ws={class:"border-b border-gray-200"},Zs={class:"-mb-px flex space-x-8"},en=["onClick"],tn={class:"flex items-center"},sn=I({__name:"IssueTabs",props:{activeTab:{},eventCount:{}},emits:["tab-change"],setup(f,{emit:p}){const a=p,n=[{name:"comments",label:"Комментарии",icon:"heroicons:chat-bubble-oval-left"},{name:"activities",label:"Активность",icon:"mdi:history"}];return(s,r)=>(l(),c("div",Ws,[e("nav",Zs,[(l(),c(L,null,R(n,i=>e("button",{key:i.name,onClick:y=>a("tab-change",i.name),class:P([i.name===s.activeTab?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm cursor-pointer"])},[e("span",tn,[g(u(S),{icon:i.icon,class:"mr-2 h-5 w-5"},null,8,["icon"]),N(" "+x(i.label),1)])],10,en)),64))])]))}}),nn={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},an={key:0,class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},on={class:"lg:col-span-2 space-y-6"},rn={class:"lg:col-span-1"},Dn=I({__name:"Show",props:{id:{}},setup(f){const p=ae(),{fetchIssue:a}=p,{issue:n}=De(p),s=T("comments"),r=i=>{s.value=i};return ne(async()=>{await a(+f.id),console.log(n)}),(i,y)=>(l(),E(be,null,{default:j(()=>{var b,d;return[e("div",nn,[g(Ls,{issue:u(n)},null,8,["issue"]),(b=u(n))!=null&&b.id?(l(),c("div",an,[e("div",on,[g(Ds,{event:u(n).event},null,8,["event"]),g(sn,{"active-tab":s.value,onTabChange:r},null,8,["active-tab"]),s.value==="comments"?(l(),E(hs,{key:0,"issue-id":u(n).id,comments:(d=u(n))==null?void 0:d.comments,onCommentAdded:y[0]||(y[0]=h=>u(a)(u(n).id)),onCommentDeleted:y[1]||(y[1]=h=>u(a)(u(n).id))},null,8,["issue-id","comments"])):s.value==="activities"?(l(),E(jt,{key:1,activities:u(n).activities},null,8,["activities"])):$("",!0)]),e("div",rn,[g(Gs,{issue:u(n)},null,8,["issue"]),g(ns,{assignees:u(n).assignees},null,8,["assignees"]),g(qs,{issue:u(n)},null,8,["issue"])])])):$("",!0)])]}),_:1}))}});export{Dn as default};
