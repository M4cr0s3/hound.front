import{ab as M,k as _,i as A,d as O,c as L,m as P,l as I,w as p,o,a as i,q as d,f as e,b as t,a6 as b,e as l,p as V,t as r,F as E,n as B,h as f,a7 as k,s as q}from"./index-Dr8GC7C8.js";import{I as m}from"./iconify-nGeM3Ss7.js";import{d as z,a as K}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-B3Mng-G2.js";import"./index-BCqgpTI_.js";import{_ as G,S as H}from"./JsonViewer.vue_vue_type_script_setup_true_lang-CLFKuvfl.js";import{_ as w}from"./Badge.vue_vue_type_script_setup_true_lang-BnALEO-N.js";import{_ as J}from"./EmptyState.vue_vue_type_script_setup_true_lang-pS1QUvbm.js";import{b as D,c as Q,d as U,f as N,g as W,e as X}from"./index-bfLnkGmT.js";import{P as Y}from"./platforms-D8ztvdxx.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Cqf0SSGI.js";import"./projects-CkGr_SGu.js";const ee=M("events",()=>{const g=_([]),x=_({id:0,name:"",description:"",type:"",level:"info",metadata:{},event_id:"",count:0,message:"",release:"",project_id:0,environment:"",project:{}}),s=_(!1);return{events:g,event:x,fetchEvent:async h=>{s.value=!0;try{x.value=await A.get(`/events/${h}`)}finally{s.value=!1}}}}),te={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},se={class:"flex items-center mb-6"},ae={class:"inline-flex items-center space-x-1 md:space-x-2"},ne={class:"flex items-center"},oe={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6"},ie={class:"flex items-center gap-3"},le={class:"text-xl font-semibold text-gray-900 line-clamp-2"},re={class:"flex items-center gap-2 mt-1"},de={class:"text-xs text-gray-500"},ce={key:0,class:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full"},me={class:"mb-6"},ve={class:"flex space-x-4 border-b border-gray-200"},xe=["onClick"],ue={key:0,class:"absolute inset-x-0 bottom-0 h-0.5 bg-indigo-600"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},fe={class:"bg-white rounded-lg shadow overflow-hidden"},_e={class:"px-6 py-4 space-y-4"},ge={key:0,class:"flex items-start"},he={class:"text-sm text-gray-900 font-mono break-all"},ye={key:1,class:"flex items-start"},be={key:2,class:"flex items-start"},ke={class:"text-sm text-gray-900"},we={key:3,class:"flex items-start"},Ce={class:"text-sm text-gray-900"},Se={class:"bg-white rounded-lg shadow overflow-hidden"},je={class:"px-6 py-4"},$e={class:"flex items-center"},Le={class:"flex-shrink-0 h-10 w-10 flex items-center justify-center p-3 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl shadow-md"},Ie={class:"ml-4"},Ve={class:"text-sm font-medium text-gray-900"},Ee={class:"text-sm text-gray-500"},Be={key:0,class:"bg-white rounded-lg shadow overflow-hidden mb-6"},De={class:"px-6 py-4"},Ne={key:0},Re={key:0,class:"bg-white rounded-lg shadow overflow-hidden mb-6"},Te={class:"divide-y divide-gray-200"},Fe={class:"flex items-center justify-between"},Me={class:"flex items-center gap-2"},Ae={class:"text-sm font-medium text-gray-900"},Oe={class:"text-sm text-gray-500 mt-1"},Pe=O({__name:"Show",props:{id:{}},setup(g){const x=g,s=ee(),c=_("details");z();const h=[{id:"details",name:"Детали"},{id:"stacktrace",name:"Stacktrace"},{id:"issues",name:"Проблемы"}],R=L(()=>{const y=s.event.metadata||{},a=["file","line","stacktrace"];return Object.keys(y).some(v=>!a.includes(v))}),T=L(()=>{const{file:y,line:a,stacktrace:v,...u}=s.event.metadata||{};return u});function F(){console.log("Create issue from event",s.event)}return P(async()=>{await s.fetchEvent(+x.id)}),(y,a)=>{const v=q("RouterLink");return o(),I(K,null,{default:p(()=>{var u,C,S,j,$;return[(u=e(s))!=null&&u.event?(o(),i("div",te,[t("nav",se,[t("ol",ae,[t("li",null,[t("div",ne,[l(e(m),{icon:"mdi:chevron-right",class:"h-4 w-4 text-gray-400"}),a[0]||(a[0]=t("span",{class:"ml-1 text-sm font-medium text-gray-500 md:ml-2"},"Детали события",-1))])])])]),t("div",oe,[t("div",ie,[t("div",{class:V(["p-2 rounded-lg",`bg-${e(D)(e(s).event.level)}-100 text-${e(D)(e(s).event.level)}-600`])},[l(e(m),{icon:e(Q)(e(s).event.level),class:"h-5 w-5"},null,8,["icon"])],2),t("div",null,[t("h1",le,r(e(s).event.message),1),t("div",re,[l(e(w),{variant:e(U)(e(s).event.level),text:e(s).event.level,class:"text-xs"},null,8,["variant","text"]),t("span",de,r(e(N)(e(s).event.created_at)),1),e(s).event.count>1?(o(),i("span",ce," Повторений: "+r(e(s).event.count),1)):d("",!0)])])])]),t("div",me,[t("nav",ve,[(o(),i(E,null,B(h,n=>t("button",{key:n.id,onClick:qe=>c.value=n.id,class:V(["px-4 py-2 text-sm font-medium relative cursor-pointer",{"text-indigo-600":c.value===n.id,"text-gray-500 hover:text-gray-700":c.value!==n.id}])},[f(r(n.name)+" ",1),c.value===n.id?(o(),i("span",ue)):d("",!0)],10,xe)),64))])]),b(t("div",null,[t("div",pe,[t("div",fe,[a[5]||(a[5]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-sm font-medium text-gray-900"},"Основная информация")],-1)),t("div",_e,[(C=e(s).event.metadata)!=null&&C.file?(o(),i("div",ge,[a[1]||(a[1]=t("span",{class:"text-sm text-gray-500 w-32 flex-shrink-0"},"Файл:",-1)),t("span",he,r(e(s).event.metadata.file)+":"+r(e(s).event.metadata.line||"?"),1)])):d("",!0),e(s).event.type?(o(),i("div",ye,[a[2]||(a[2]=t("span",{class:"text-sm text-gray-500 w-32 flex-shrink-0"},"Тип:",-1)),l(e(w),{text:e(s).event.type,class:"text-xs",variant:"default"},null,8,["text"])])):d("",!0),e(s).event.environment?(o(),i("div",be,[a[3]||(a[3]=t("span",{class:"text-sm text-gray-500 w-32 flex-shrink-0"},"Окружение:",-1)),t("span",ke,r(e(s).event.environment),1)])):d("",!0),e(s).event.release?(o(),i("div",we,[a[4]||(a[4]=t("span",{class:"text-sm text-gray-500 w-32 flex-shrink-0"},"Релиз:",-1)),t("span",Ce,r(e(s).event.release),1)])):d("",!0)])]),t("div",Se,[a[7]||(a[7]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-sm font-medium text-gray-900"},"Проект")],-1)),t("div",je,[t("div",$e,[t("div",Le,[l(e(m),{icon:(S=e(Y).find(n=>n.name===e(s).event.project.platform))==null?void 0:S.icon,class:"h-5 w-5"},null,8,["icon"])]),t("div",Ie,[t("h4",Ve,r(e(s).event.project.name),1),t("p",Ee,r(e(s).event.project.slug),1),l(v,{to:`/projects/${(j=e(s).event)==null?void 0:j.project.slug}`,class:"mt-1 inline-flex items-center text-xs text-indigo-600 hover:text-indigo-800"},{default:p(()=>[a[6]||(a[6]=f(" Перейти в проект ")),l(e(m),{icon:"mdi:chevron-right",class:"h-4 w-4"})]),_:1},8,["to"])])])])])]),R.value?(o(),i("div",Be,[a[8]||(a[8]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-sm font-medium text-gray-900"},"Контекст события")],-1)),t("div",De,[l(e(G),{class:"text-sm",data:T.value},null,8,["data"])])])):d("",!0)],512),[[k,c.value==="details"]]),e(s).event.metadata.stacktrace?b((o(),i("div",Ne,[l(e(H),{stacktrace:e(s).event.metadata.stacktrace,class:"mb-6"},null,8,["stacktrace"])],512)),[[k,c.value==="stacktrace"&&(($=e(s).event)==null?void 0:$.metadata.stacktrace)]]):d("",!0),b(t("div",null,[e(s).event.issues&&e(s).event.issues.length>0?(o(),i("div",Re,[a[10]||(a[10]=t("div",{class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},[t("h3",{class:"text-sm font-medium text-gray-900"},"Связанные проблемы")],-1)),t("div",Te,[(o(!0),i(E,null,B(e(s).event.issues,n=>(o(),i("div",{key:n.id,class:"px-6 py-4 hover:bg-gray-50"},[t("div",Fe,[t("div",null,[t("div",Me,[t("h4",Ae,r(n.title),1),l(e(w),{variant:e(X)(n.status),text:e(W)(n.status),class:"text-xs"},null,8,["variant","text"])]),t("p",Oe," Создана "+r(e(N)(n.created_at)),1)]),l(v,{to:`/issues/${n.id}`,class:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800"},{default:p(()=>[a[9]||(a[9]=f(" Подробнее ")),l(e(m),{icon:"mdi:chevron-right",class:"h-4 w-4"})]),_:2},1032,["to"])])]))),128))])])):(o(),I(e(J),{key:1,title:"Нет связанных задач",description:"Это событие еще не связано ни с одной задачей.",icon:"mdi:alert-circle-outline"},{default:p(()=>[t("button",{onClick:F,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none"},[l(e(m),{icon:"mdi:plus",class:"h-5 w-5 mr-2"}),a[11]||(a[11]=f(" Создать проблему "))])]),_:1}))],512),[[k,c.value==="issues"]])])):d("",!0)]}),_:1})}}}),tt=Z(Pe,[["__scopeId","data-v-0dd814b5"]]);export{tt as default};
